This is the FULL SOURCE CODE for the NWWW (Knowledge Crossroads) project.
PLEASE IGNORE the directory path .gemini/antigravity... as it is just the temporary location where this file was generated.

This file is a merged representation of the entire codebase, combined into a single document by Repomix.

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)


================================================================
Directory Structure
================================================================
prisma/
  migrations/
    20260215155057_init/
      migration.sql
    20260218000229_add_rate_limit/
      migration.sql
    migration_lock.toml
  dev.db
  schema.prisma
  seed.ts
public/
  file.svg
  globe.svg
  next.svg
  nwww_logo_w.png
  nwww_logo.png
  vercel.svg
  window.svg
scripts/
  hide-mock-data.ts
src/
  app/
    [boardId]/
      [threadId]/
        page.module.css
        page.tsx
      archive/
        page.tsx
      loading.tsx
      page.module.css
      page.tsx
    admin/
      page.module.css
      page.tsx
    api/
      auth/
        [...nextauth]/
          route.ts
      og/
        route.tsx
      report/
        route.ts
      thread/
        generate/
          route.ts
        summarize/
          route.ts
    auth/
      error/
        page.tsx
      signin/
        page.module.css
        page.tsx
    privacy/
      page.tsx
    search/
      page.module.css
      page.tsx
    tos/
      page.tsx
    actions.ts
    apple-icon.png
    globals.css
    icon.png
    layout.module.css
    layout.tsx
    LegalLayout.module.css
    page.module.css
    page.tsx
    spark-actions.ts
  components/
    AdminAnalytics.module.css
    AdminAnalytics.tsx
    AIInsights.module.css
    AIInsights.tsx
    BoardIcon.tsx
    BoardList.module.css
    BoardList.tsx
    BoardStatusManager.module.css
    BoardStatusManager.tsx
    DiscoverSection.module.css
    DiscoverSection.tsx
    ErrorBoundary.tsx
    MobileHeader.module.css
    MobileHeader.tsx
    NewThreadForm.module.css
    NewThreadForm.tsx
    PostBar.module.css
    PostBar.tsx
    PostContent.module.css
    PostContent.tsx
    PostForm.module.css
    PostForm.tsx
    PostList.module.css
    PostList.tsx
    Providers.tsx
    ReportBoard.module.css
    ReportBoard.tsx
    ReportButton.module.css
    ReportButton.tsx
    SourceCard.tsx
    SparkAdmin.module.css
    SparkAdmin.tsx
    SparkGenerator.module.css
    SparkGenerator.tsx
    ThemeToggle.module.css
    ThemeToggle.tsx
    ThreadCard.module.css
    ThreadCard.tsx
    ThreadInteractiveView.tsx
    ThreadList.module.css
    ThreadList.tsx
    ThreadSummarizer.module.css
    ThreadSummarizer.tsx
    TopSparkCTA.module.css
    TopSparkCTA.tsx
  data/
    db-actions.ts
    mockBBS.ts
  lib/
    auth.ts
    prisma.ts
    rate-limit.ts
  utils/
    time.ts
  middleware.ts
.gitignore
check-prisma-models.js
CLAUDE.md
eslint.config.mjs
next.config.ts
package.json
README.md
test-debug.ts
tsconfig.json

================================================================
Files
================================================================

================
File: prisma/migrations/20260215155057_init/migration.sql
================
-- CreateTable
CREATE TABLE "Board" (
    "id" TEXT NOT NULL PRIMARY KEY,
    "name" TEXT NOT NULL,
    "description" TEXT NOT NULL,
    "category" TEXT NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL
);

-- CreateTable
CREATE TABLE "Thread" (
    "id" TEXT NOT NULL PRIMARY KEY,
    "title" TEXT NOT NULL,
    "views" INTEGER NOT NULL DEFAULT 0,
    "postCount" INTEGER NOT NULL DEFAULT 0,
    "momentum" INTEGER NOT NULL DEFAULT 0,
    "status" TEXT NOT NULL DEFAULT 'active',
    "lastUpdated" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "isAiGenerated" BOOLEAN NOT NULL DEFAULT false,
    "sourceUrl" TEXT,
    "sourceTitle" TEXT,
    "sourcePlatform" TEXT,
    "aiAnalysis" TEXT,
    "tags" TEXT NOT NULL DEFAULT '[]',
    "boardId" TEXT NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    CONSTRAINT "Thread_boardId_fkey" FOREIGN KEY ("boardId") REFERENCES "Board" ("id") ON DELETE RESTRICT ON UPDATE CASCADE
);

-- CreateTable
CREATE TABLE "Post" (
    "id" TEXT NOT NULL PRIMARY KEY,
    "content" TEXT NOT NULL,
    "author" TEXT NOT NULL DEFAULT 'åç„¡ã—ã•ã‚“',
    "userId" TEXT,
    "tripcode" TEXT,
    "isAiGenerated" BOOLEAN NOT NULL DEFAULT false,
    "likes" INTEGER NOT NULL DEFAULT 0,
    "threadId" TEXT NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    CONSTRAINT "Post_threadId_fkey" FOREIGN KEY ("threadId") REFERENCES "Thread" ("id") ON DELETE RESTRICT ON UPDATE CASCADE
);

================
File: prisma/migrations/20260218000229_add_rate_limit/migration.sql
================
-- CreateTable
CREATE TABLE "Report" (
    "id" TEXT NOT NULL PRIMARY KEY,
    "reason" TEXT NOT NULL,
    "detail" TEXT,
    "reporterIp" TEXT,
    "status" TEXT NOT NULL DEFAULT 'pending',
    "postId" TEXT NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    CONSTRAINT "Report_postId_fkey" FOREIGN KEY ("postId") REFERENCES "Post" ("id") ON DELETE RESTRICT ON UPDATE CASCADE
);

-- CreateTable
CREATE TABLE "RateLimit" (
    "key" TEXT NOT NULL PRIMARY KEY,
    "count" INTEGER NOT NULL DEFAULT 0,
    "lastHit" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- RedefineTables
PRAGMA foreign_keys=OFF;
CREATE TABLE "new_Post" (
    "id" TEXT NOT NULL PRIMARY KEY,
    "content" TEXT NOT NULL,
    "author" TEXT NOT NULL DEFAULT 'åç„¡ã—ã•ã‚“',
    "userId" TEXT,
    "tripcode" TEXT,
    "isAiGenerated" BOOLEAN NOT NULL DEFAULT false,
    "likes" INTEGER NOT NULL DEFAULT 0,
    "status" TEXT NOT NULL DEFAULT 'active',
    "threadId" TEXT NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    CONSTRAINT "Post_threadId_fkey" FOREIGN KEY ("threadId") REFERENCES "Thread" ("id") ON DELETE RESTRICT ON UPDATE CASCADE
);
INSERT INTO "new_Post" ("author", "content", "createdAt", "id", "isAiGenerated", "likes", "threadId", "tripcode", "updatedAt", "userId") SELECT "author", "content", "createdAt", "id", "isAiGenerated", "likes", "threadId", "tripcode", "updatedAt", "userId" FROM "Post";
DROP TABLE "Post";
ALTER TABLE "new_Post" RENAME TO "Post";
PRAGMA foreign_key_check;
PRAGMA foreign_keys=ON;

================
File: prisma/migrations/migration_lock.toml
================
# Please do not edit this file manually
# It should be added in your version-control system (i.e. Git)
provider = "sqlite"

================
File: public/file.svg
================
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>

================
File: public/globe.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>

================
File: public/next.svg
================
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>

================
File: public/vercel.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>

================
File: public/window.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>

================
File: scripts/hide-mock-data.ts
================
import { PrismaClient } from '@prisma/client';
import { MOCK_BOARDS } from '../src/data/mockBBS';

const prisma = new PrismaClient();

async function main() {
    console.log('ğŸ”’ Hiding mock data...');

    const mockThreadIds: string[] = [];

    // Collect all mock thread IDs
    MOCK_BOARDS.forEach(board => {
        board.threads.forEach(thread => {
            mockThreadIds.push(thread.id);
        });
    });

    console.log(`Found ${mockThreadIds.length} mock threads to hide.`);

    // Update status to 'deleted'
    // using updateMany for efficiency
    const result = await prisma.thread.updateMany({
        where: {
            id: {
                in: mockThreadIds
            }
        },
        data: {
            status: 'deleted'
        }
    });

    console.log(`âœ… Successfully updated ${result.count} threads to status 'deleted'.`);
    console.log('To restore them, run a script to set status back to "active".');
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });

================
File: src/app/[boardId]/[threadId]/page.module.css
================
.container {
    background: var(--color-bg-surface);
    padding: var(--spacing-lg);
    border-radius: 0;
    border: 1px solid var(--color-border);
    box-shadow: none;
}

.nav {
    margin-bottom: var(--spacing-md);
}

.backLink {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.9rem;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    border-radius: 0;
    border: 1px solid transparent;
    transition: all 0.2s;
}

.backLink:hover {
    background: var(--color-bg-base);
    color: var(--color-text-primary);
    border-color: var(--color-border);
}

.header {
    border-bottom: 1px solid var(--color-border);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.title {
    font-size: 1.75rem;
    color: var(--color-text-primary);
    font-weight: 800;
    margin-bottom: var(--spacing-xs);
    letter-spacing: -0.02em;
}

.meta {
    font-size: 0.85rem;
    color: var(--color-text-muted);
    font-family: var(--font-mono);
    display: flex;
    gap: var(--spacing-md);
}

.postList {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
}

.post {
    padding-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.post:last-child {
    border-bottom: none;
}

.postHeader {
    font-size: 0.9rem;
    margin-bottom: var(--spacing-sm);
    color: var(--color-text-secondary);
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
}

.postIndex {
    font-weight: bold;
    color: var(--color-text-primary);
    min-width: 24px;
}

.author {
    color: var(--color-text-primary);
    /* Use primary for readability, or specific color if needed */
    font-weight: 700;
}

.date,
.id {
    color: var(--color-text-muted);
    font-size: 0.85rem;
    font-family: var(--font-mono);
}

.postContent {
    font-size: 1rem;
    line-height: 1.7;
    color: var(--color-text-primary);
    padding-left: 0;
    /* Align left for modern look, or indent for traditional */
    /* padding-left: var(--spacing-md); Traditional style */
}

.postContent p {
    margin-bottom: 0.5em;
}

.footer {
    margin-top: var(--spacing-xl);
    padding-top: var(--spacing-lg);
    border-top: 1px dashed var(--color-border);
}

.empty {
    text-align: center;
    color: var(--color-text-muted);
    padding: var(--spacing-lg);
}

/* â”€â”€â”€ Mobile Responsive â”€â”€â”€ */
@media (max-width: 768px) {
    .container {
        padding: var(--spacing-md);
    }

    .title {
        font-size: 1.25rem;
    }

    .meta {
        flex-wrap: wrap;
        gap: var(--spacing-sm);
    }

    .postHeader {
        font-size: 0.8rem;
    }

    .postContent {
        font-size: 0.9rem;
    }
}

================
File: src/app/[boardId]/archive/page.tsx
================
import Link from 'next/link';
import { notFound } from 'next/navigation';
import { getBoard, getArchivedThreads } from '@/data/db-actions';
import { ArrowLeft, Clock, Eye, MessageCircle, Archive } from 'lucide-react';
import styles from '../page.module.css'; // Reuse BoardPage styles

interface PageProps {
    params: Promise<{
        boardId: string;
    }>;
}

export default async function ArchivePage({ params }: PageProps) {
    const { boardId } = await params;
    const board = await getBoard(boardId);
    const threads = await getArchivedThreads(boardId);

    if (!board) {
        notFound();
    }

    return (
        <div className={styles.pageContainer}>
            {/* Sticky Header */}
            <header className={styles.stickyHeader}>
                <div className={styles.headerInner}>
                    <div className={styles.headerLeft}>
                        <Link href={`/${boardId}`} className={styles.backButton}>
                            <ArrowLeft size={16} />
                        </Link>
                        <div className={styles.boardInfo}>
                            <h2 className={styles.boardTitle}>
                                <span style={{ opacity: 0.7, marginRight: '0.5rem' }}>{board.name}</span>
                                ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
                            </h2>
                        </div>
                    </div>
                </div>
            </header>

            {/* Content Area */}
            <main className={styles.contentArea}>
                <div className={styles.listHeader}>
                    <span className={styles.categoryBadge} style={{ backgroundColor: 'var(--muted)', color: 'var(--muted-foreground)' }}>Archived</span>
                    <p style={{ fontSize: '0.8rem', color: 'var(--muted-foreground)', marginLeft: '1rem' }}>
                        ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã•ã‚ŒãŸã‚¹ãƒ¬ãƒƒãƒ‰ã§ã™
                    </p>
                </div>

                <div className={styles.threadList}>
                    {threads.length === 0 ? (
                        <div style={{ padding: '2rem', textAlign: 'center', color: 'var(--muted-foreground)' }}>
                            <Archive size={48} style={{ margin: '0 auto 1rem', opacity: 0.5 }} />
                            <p>éå»ãƒ­ã‚°ã¯ã‚ã‚Šã¾ã›ã‚“</p>
                        </div>
                    ) : (
                        threads.map((thread) => (
                            <Link href={`/${boardId}/${thread.id}`} key={thread.id} className={styles.cardLink}>
                                <article className={styles.threadCard} style={{ opacity: 0.8 }}>
                                    <div className={styles.cardHeader}>
                                        <h3 className={styles.threadTitle}>{thread.title}</h3>
                                    </div>
                                    <div className={styles.cardFooter}>
                                        <div className={styles.metaData}>
                                            <span className={styles.timestamp}>
                                                <Clock size={14} />
                                                {new Date(thread.lastUpdated).toLocaleString('en-US', { hour12: true })}
                                            </span>
                                            <div className={styles.stats}>
                                                <span className={styles.statItem}>
                                                    <Eye size={14} />
                                                    {thread.views}
                                                </span>
                                                <span className={styles.statItem}>
                                                    <MessageCircle size={14} />
                                                    {thread.postCount}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </article>
                            </Link>
                        ))
                    )}
                </div>
            </main>
        </div>
    );
}

================
File: src/app/[boardId]/loading.tsx
================
import styles from './page.module.css';
import { ArrowLeft } from 'lucide-react';
import Link from 'next/link';

export default function Loading() {
    return (
        <div className={styles.pageContainer}>
            {/* Sticky Header Skeleton */}
            <header className={styles.stickyHeader}>
                <div className={styles.headerInner}>
                    <div className={styles.headerLeft}>
                        <Link href="/" className={styles.backButton}>
                            <ArrowLeft size={16} />
                        </Link>
                        <div className={styles.boardInfo}>
                            <div className={styles.skeleton} style={{ width: '150px', height: '24px', marginBottom: '8px', background: 'var(--border)' }}></div>
                            <div className={styles.skeleton} style={{ width: '300px', height: '14px', background: 'var(--border)' }}></div>
                        </div>
                    </div>
                </div>
            </header>

            {/* Content Area Skeleton */}
            <main className={styles.contentArea}>
                <div className={styles.listHeader}>
                    <div className={styles.skeleton} style={{ width: '100px', height: '20px', background: 'var(--border)' }}></div>
                    <div className={styles.skeleton} style={{ width: '120px', height: '36px', borderRadius: '20px', background: 'var(--border)' }}></div>
                </div>

                <div className={styles.threadList}>
                    {[1, 2, 3, 4, 5, 6].map((i) => (
                        <article key={i} className={styles.threadCard} style={{ opacity: 0.7 }}>
                            <div className={styles.cardHeader}>
                                <div className={styles.skeleton} style={{ width: '70%', height: '20px', marginBottom: '12px', background: 'var(--border)' }}></div>
                            </div>
                            <div className={styles.cardFooter}>
                                <div className={styles.skeleton} style={{ width: '40%', height: '14px', background: 'var(--border)' }}></div>
                            </div>
                        </article>
                    ))}
                </div>
            </main>
        </div>
    );
}

================
File: src/app/admin/page.module.css
================
.container {
    padding: 2rem;
    max-width: 1000px;
    margin: 0 auto;
}

.nav {
    margin-bottom: 2rem;
}

.backLink {
    color: var(--color-primary);
    text-decoration: none;
    font-size: 0.9rem;
}

.header {
    margin-bottom: 3rem;
}

.adminBadge {
    display: inline-block;
    background: #ef4444;
    color: white;
    padding: 0.2rem 0.6rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
}

.header h1 {
    font-size: 2rem;
    font-weight: 800;
}

================
File: src/app/api/og/route.tsx
================
import { ImageResponse } from 'next/og';

export const runtime = 'edge';

// Font loading helper - using a stable subsetted WOFF font for Edge efficiency
async function loadFont() {
    const url = 'https://cdn.jsdelivr.net/npm/@fontsource/noto-sans-jp@5.0.18/files/noto-sans-jp-japanese-700-normal.woff';
    const response = await fetch(url);
    if (!response.ok) {
        throw new Error(`Failed to load font: ${response.status}`);
    }
    return await response.arrayBuffer();
}

export async function GET(request: Request) {
    try {
        const { searchParams } = new URL(request.url);

        // Get parameters
        const title = searchParams.get('title') || 'NWWW - The New World Wide Web';
        const boardName = searchParams.get('boardName') || '';

        // Load font
        const fontData = await loadFont();

        return new ImageResponse(
            (
                <div
                    style={{
                        height: '100%',
                        width: '100%',
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        justifyContent: 'center',
                        backgroundColor: '#0a0a0b',
                        backgroundImage: 'radial-gradient(circle at 25% 25%, #1a1a1c 0%, transparent 50%), radial-gradient(circle at 75% 75%, #111113 0%, transparent 50%)',
                        padding: '40px 80px',
                        fontFamily: '"Noto Sans JP"',
                    }}
                >
                    {/* Border highlight */}
                    <div
                        style={{
                            position: 'absolute',
                            top: 20,
                            left: 20,
                            right: 20,
                            bottom: 20,
                            border: '1px solid rgba(255, 255, 255, 0.1)',
                            borderRadius: '20px',
                        }}
                    />

                    {/* Main Content */}
                    <div
                        style={{
                            display: 'flex',
                            flexDirection: 'column',
                            alignItems: 'center',
                            textAlign: 'center',
                            width: '100%',
                        }}
                    >
                        {/* Title - Large and Bold */}
                        <div
                            style={{
                                fontSize: '64px',
                                fontWeight: 700,
                                color: '#ffffff',
                                marginBottom: '32px',
                                lineHeight: 1.3,
                                wordBreak: 'break-word',
                                display: 'flex',
                                justifyContent: 'center',
                                alignItems: 'center',
                            }}
                        >
                            {title}
                        </div>

                        {/* Board Name - Subtle and Styled */}
                        {boardName && (
                            <div
                                style={{
                                    fontSize: '28px',
                                    fontWeight: 700,
                                    color: 'rgba(255, 255, 255, 0.75)',
                                    backgroundColor: 'rgba(255, 255, 255, 0.08)',
                                    padding: '12px 36px',
                                    borderRadius: '50px',
                                    border: '1px solid rgba(255, 255, 255, 0.2)',
                                    display: 'flex',
                                }}
                            >
                                {boardName}
                            </div>
                        )}
                    </div>

                    {/* Logo in bottom right */}
                    <div
                        style={{
                            position: 'absolute',
                            bottom: 52,
                            right: 75,
                            display: 'flex',
                        }}
                    >
                        <img
                            src={`${new URL(request.url).origin}/nwww_logo_w.png`}
                            width="100"
                            alt="NWWW"
                        />
                    </div>
                </div>
            ),
            {
                width: 1200,
                height: 630,
                fonts: [
                    {
                        name: 'Noto Sans JP',
                        data: fontData,
                        style: 'normal',
                        weight: 700,
                    },
                ],
            }
        );
    } catch (error: any) {
        console.error('OG Generation Error:', error.message);
        return new Response(`Failed to generate the image: ${error.message}`, {
            status: 500,
        });
    }
}

================
File: src/app/api/report/route.ts
================
import { NextResponse } from 'next/server';
import prisma from '@/lib/prisma';
import crypto from 'crypto';

export async function POST(req: Request) {
    try {
        const { postId, reason, detail } = await req.json();

        if (!postId || !reason) {
            return NextResponse.json({ error: 'postId and reason are required' }, { status: 400 });
        }

        // Simple IP hashing for identifying reporters without storing raw IP (privacy)
        const ip = req.headers.get('x-forwarded-for') || 'unknown';
        const reporterIp = crypto.createHash('sha256').update(ip).digest('hex');

        // Check if this IP has reported this post recently (simple rate limiting)
        const recentReport = await prisma.report.findFirst({
            where: {
                postId,
                reporterIp,
                createdAt: {
                    gt: new Date(Date.now() - 1000 * 60 * 60) // within 1 hour
                }
            }
        });

        if (recentReport) {
            return NextResponse.json({ error: 'æ—¢ã«é€šå ±æ¸ˆã¿ã§ã™' }, { status: 429 });
        }

        const report = await prisma.report.create({
            data: {
                postId,
                reason,
                detail,
                reporterIp,
            }
        });

        return NextResponse.json({ success: true, reportId: report.id });
    } catch (error: any) {
        console.error('Report API Error:', error);
        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
    }
}

================
File: src/app/api/thread/summarize/route.ts
================
import { NextResponse } from 'next/server';
import { GoogleGenerativeAI } from '@google/generative-ai';
import prisma from '@/lib/prisma';

export async function POST(req: Request) {
    try {
        const { threadId } = await req.json();

        if (!threadId) {
            return NextResponse.json({ error: 'threadId is required' }, { status: 400 });
        }

        if (!process.env.GEMINI_API_KEY) {
            return NextResponse.json({ error: 'GEMINI_API_KEY missing' }, { status: 500 });
        }

        // Fetch thread with all posts
        const thread = await prisma.thread.findUnique({
            where: { id: threadId },
            include: {
                posts: {
                    orderBy: { createdAt: 'asc' },
                },
            },
        });

        if (!thread) {
            return NextResponse.json({ error: 'Thread not found' }, { status: 404 });
        }

        if (thread.posts.length < 20) {
            return NextResponse.json({ error: 'Not enough posts (min 20)' }, { status: 400 });
        }

        // Build conversation text from posts (latest 100 posts max)
        const postsToAnalyze = thread.posts.slice(-100);
        const conversation = postsToAnalyze.map((p, i) =>
            `>>${i + 1} ${p.author}: ${p.content}`
        ).join('\n');

        const prompt = `
ã‚ãªãŸã¯ã‚¹ãƒ¬ãƒƒãƒ‰è¦ç´„AIã§ã™ã€‚
ä»¥ä¸‹ã®æ²ç¤ºæ¿ã‚¹ãƒ¬ãƒƒãƒ‰ã®ãƒ¬ã‚¹ã‚’åˆ†æã—ã€è­°è«–ã®è¦ç‚¹ã‚’ **3è¡Œã®ç®‡æ¡æ›¸ã** ã§è¦ç´„ã—ã¦ãã ã•ã„ã€‚

## å³æ ¼ãªåˆ¶ç´„
- å¿…ãš **3è¡Œ** ã«ã™ã‚‹ã“ã¨ã€‚
- **å„è¡Œã¯å…¨è§’10æ–‡å­—ä»¥å†…** ã«å³æ ¼ã«åã‚ã‚‹ã“ã¨ã€‚
- ä½“è¨€æ­¢ã‚ã‚„çŸ­ã„ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚
- å„è¡Œã¯ã€Œãƒ»ã€ã§å§‹ã‚ã‚‹ã“ã¨ã€‚

## å‡ºåŠ›ä¾‹
ãƒ»AIè¦åˆ¶ã®æ˜¯é
ãƒ»è‘—ä½œæ¨©æ³•ã®é™ç•Œ
ãƒ»æŠ€è¡“ç™ºå±•ã®é˜»å®³

## ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¿ã‚¤ãƒˆãƒ«
${thread.title}

## ã‚¹ãƒ¬ãƒƒãƒ‰å†…å®¹ (${postsToAnalyze.length}ä»¶ã®ãƒ¬ã‚¹)
${conversation.slice(0, 8000)}

ä¸Šè¨˜ã®åˆ¶ç´„ã«å¾“ã„ã€3è¡Œã®è¦ç´„ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚JSONä¸è¦ã€‚
`;

        const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);
        const modelsToTry = ['gemini-2.0-flash', 'gemini-1.5-flash-001', 'gemini-1.5-flash'];

        let summaryText = '';
        let lastError: Error | null = null;

        for (const modelName of modelsToTry) {
            try {
                const model = genAI.getGenerativeModel({ model: modelName });
                let attempts = 0;
                while (attempts < 2) {
                    try {
                        const result = await model.generateContent(prompt);
                        summaryText = result.response.text().trim();
                        break;
                    } catch (e: any) {
                        attempts++;
                        if (attempts >= 2) throw e;
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                }
                if (summaryText) break;
            } catch (error) {
                lastError = error as Error;
                await new Promise(resolve => setTimeout(resolve, 1000));
                continue;
            }
        }

        if (!summaryText) {
            return NextResponse.json(
                { error: 'AI summarization failed', details: String(lastError) },
                { status: 500 }
            );
        }

        // Update the thread's aiAnalysis in DB
        await prisma.thread.update({
            where: { id: threadId },
            data: { aiAnalysis: summaryText },
        });

        return NextResponse.json({ success: true, summary: summaryText });

    } catch (error) {
        console.error('Summarize API Error:', error);
        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
    }
}

================
File: src/app/auth/error/page.tsx
================
'use client';

import Link from 'next/link';

export default function ErrorPage() {
    return (
        <div style={{
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            minHeight: '100vh',
            textAlign: 'center',
            backgroundColor: '#030303',
            color: '#fff',
            fontFamily: 'sans-serif'
        }}>
            <h1 style={{ color: '#ef4444' }}>èªè¨¼ã‚¨ãƒ©ãƒ¼</h1>
            <p>ç®¡ç†è€…æ¨©é™ãŒãªã„ã‹ã€ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>
            <Link href="/auth/signin" style={{ color: '#fff', marginTop: '1rem' }}>å†è©¦è¡Œã™ã‚‹</Link>
        </div>
    );
}

================
File: src/app/privacy/page.tsx
================
import React from 'react';
import Link from 'next/link';
import styles from '../LegalLayout.module.css';

export default function PrivacyPage() {
    return (
        <div className={styles.container}>
            <Link href="/" className={styles.backLink}>â† æˆ»ã‚‹</Link>
            <h1 className={styles.title}>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</h1>

            <div className={styles.section}>
                <p className={styles.content}>
                    NWWWï¼ˆä»¥ä¸‹ã€Œæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã€ï¼‰ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’å°Šé‡ã—ã€å€‹äººæƒ…å ±ã®ä¿è­·ã«åŠªã‚ã¾ã™ã€‚æœ¬ã‚µãƒ¼ãƒ“ã‚¹ãŒåé›†ã™ã‚‹æƒ…å ±ã¨ãã®å–ã‚Šæ‰±ã„ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®é€šã‚Šå®šã‚ã¾ã™ã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>1. åé›†ã™ã‚‹æƒ…å ±</span>
                <p className={styles.content}>
                    æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ä»¥ä¸‹ã®æƒ…å ±ã‚’åé›†ãƒ»å–å¾—ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚{"\n"}
                    1. **ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°**: IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ç¨®é¡ã€ã‚¢ã‚¯ã‚»ã‚¹æ—¥æ™‚ã€‚{"\n"}
                    2. **æŠ•ç¨¿æƒ…å ±**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæœ¬ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã«æŠ•ç¨¿ã—ãŸå†…å®¹ã€‚{"\n"}
                    3. **CookieãŠã‚ˆã³ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: é–²è¦§å±¥æ­´ã®è¨˜éŒ²ï¼ˆDiscoveræ©Ÿèƒ½ç­‰ã«ä½¿ç”¨ï¼‰ã‚„ãƒ†ãƒ¼ãƒè¨­å®šã®ä¿å­˜ã«ä½¿ç”¨ã—ã¾ã™ã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>2. åˆ©ç”¨ç›®çš„</span>
                <p className={styles.content}>
                    åé›†ã—ãŸæƒ…å ±ã¯ã€ä»¥ä¸‹ã®ç›®çš„ã§åˆ©ç”¨ã—ã¾ã™ã€‚{"\n"}
                    1. **ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ã¨é‹å–¶**: æŠ•ç¨¿ã®è¡¨ç¤ºã€AIã«ã‚ˆã‚‹è¦ç´„ã‚„æ¿é¸å®šã®å®Ÿè¡Œã€‚{"\n"}
                    2. **ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚¹ãƒ‘ãƒ å¯¾ç­–ã€è’ã‚‰ã—è¡Œç‚ºã®åˆ¶é™ã€‚{"\n"}
                    3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Š**: é–²è¦§å±¥æ­´ã«åŸºã¥ã„ãŸã‚¹ãƒ¬ãƒƒãƒ‰ã®ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ã€‚{"\n"}
                    4. **å®‰å…¨ã®ç¢ºä¿**: è¦ç´„é•åã®èª¿æŸ»ã€æ³•çš„è¦è«‹ã¸ã®å¯¾å¿œã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>3. æƒ…å ±ã®ä¿ç®¡ã¨ä¿è­·</span>
                <p className={styles.content}>
                    1. **IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å–ã‚Šæ‰±ã„**: æŠ•ç¨¿æ™‚ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ãƒãƒƒã‚·ãƒ¥åŒ–ç­‰ã®å‡¦ç†ã‚’è¡Œã„ã€æŠ•ç¨¿è€…ã®è­˜åˆ¥ã«åˆ©ç”¨ã—ã¾ã™ã€‚ç”Ÿã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ç®¡ç†ç›®çš„ä»¥å¤–ã§å…¬é–‹ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚{"\n"}
                    2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€åé›†ã—ãŸæƒ…å ±ã®æ¼æ´©ã€ç´›å¤±ã€ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²æ­¢ã™ã‚‹ãŸã‚ã«ã€é©åˆ‡ãªæŠ€è¡“çš„å¯¾ç­–ã‚’è¬›ã˜ã¾ã™ã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>4. ç¬¬ä¸‰è€…ã¸ã®æä¾›</span>
                <p className={styles.content}>
                    æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€æ¬¡ã®å ´åˆã‚’é™¤ãã€åé›†ã—ãŸæƒ…å ±ã‚’ç¬¬ä¸‰è€…ã«é–‹ç¤ºã¾ãŸã¯æä¾›ã—ã¾ã›ã‚“ã€‚{"\n"}
                    1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŒæ„ãŒã‚ã‚‹å ´åˆã€‚{"\n"}
                    2. æ³•ä»¤ã«åŸºã¥ãã€è£åˆ¤æ‰€ã€è­¦å¯Ÿç­‰ã®å…¬çš„æ©Ÿé–¢ã‹ã‚‰é–‹ç¤ºã‚’æ±‚ã‚ã‚‰ã‚ŒãŸå ´åˆã€‚{"\n"}
                    3. äººã®ç”Ÿå‘½ã€èº«ä½“ã¾ãŸã¯è²¡ç”£ã®ä¿è­·ã®ãŸã‚ã«å¿…è¦ãŒã‚ã‚Šã€æœ¬äººã®åŒæ„ã‚’å¾—ã‚‹ã“ã¨ãŒå›°é›£ãªå ´åˆã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>5. å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ä½¿ç”¨</span>
                <p className={styles.content}>
                    æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€Googleç­‰ã®æä¾›ã™ã‚‹åˆ†æãƒ„ãƒ¼ãƒ«ã‚„åºƒå‘Šã‚µãƒ¼ãƒ“ã‚¹ã€AIãƒ¢ãƒ‡ãƒ«ï¼ˆGoogle Geminiç­‰ï¼‰ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ˆã‚‹æƒ…å ±ã®å–ã‚Šæ‰±ã„ã¯ã€å„ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«å¾“ã„ã¾ã™ã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>6. ãƒãƒªã‚·ãƒ¼ã®å¤‰æ›´</span>
                <p className={styles.content}>
                    æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€æ³•ä»¤ã®æ”¹æ­£ã‚„é‹å–¶ä¸Šã®å¿…è¦ã«å¿œã˜ã¦ã€æœ¬ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚å¤‰æ›´å¾Œã®ãƒãƒªã‚·ãƒ¼ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã«æ²è¼‰ã•ã‚ŒãŸæ™‚ç‚¹ã‹ã‚‰é©ç”¨ã•ã‚Œã¾ã™ã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>7. ãŠå•ã„åˆã‚ã›</span>
                <p className={styles.content}>
                    æƒ…å ±ã®å–ã‚Šæ‰±ã„ã«é–¢ã™ã‚‹ã”è³ªå•ç­‰ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®ãŠå•ã„åˆã‚ã›çª“å£ï¼ˆæº–å‚™ä¸­ï¼‰ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚
                </p>
            </div>

            <div className={styles.footer}>
                2026å¹´2æœˆ18æ—¥ åˆ¶å®š
            </div>
        </div>
    );
}

================
File: src/app/tos/page.tsx
================
import React from 'react';
import Link from 'next/link';
import styles from '../LegalLayout.module.css';

export default function TosPage() {
    return (
        <div className={styles.container}>
            <Link href="/" className={styles.backLink}>â† æˆ»ã‚‹</Link>
            <h1 className={styles.title}>åˆ©ç”¨è¦ç´„</h1>

            <div className={styles.section}>
                <p className={styles.content}>
                    NWWWï¼ˆä»¥ä¸‹ã€Œæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã€ï¼‰ã‚’ã”åˆ©ç”¨ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚æœ¬åˆ©ç”¨è¦ç´„ï¼ˆä»¥ä¸‹ã€Œæœ¬è¦ç´„ã€ï¼‰ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆä»¥ä¸‹ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ï¼‰ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æœ¬è¦ç´„ã®ã™ã¹ã¦ã®å†…å®¹ã«åŒæ„ã—ãŸã‚‚ã®ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>1. å®šç¾©</span>
                <p className={styles.content}>
                    ãƒ»ã€Œæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã€ã¨ã¯ã€NWWWãŒæä¾›ã™ã‚‹æ²ç¤ºæ¿ãŠã‚ˆã³é–¢é€£ã‚µãƒ¼ãƒ“ã‚¹ã‚’æŒ‡ã—ã¾ã™ã€‚{"\n"}
                    ãƒ»ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã¨ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã¾ãŸã¯åˆ©ç”¨ã™ã‚‹ã™ã¹ã¦ã®å€‹äººã¾ãŸã¯æ³•äººã‚’æŒ‡ã—ã¾ã™ã€‚{"\n"}
                    ãƒ»ã€ŒæŠ•ç¨¿ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€ã¨ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæœ¬ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã«æŠ•ç¨¿ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã€ç”»åƒã€ãƒªãƒ³ã‚¯ç­‰ã‚’æŒ‡ã—ã¾ã™ã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>2. ç¦æ­¢äº‹é …</span>
                <p className={styles.content}>
                    ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã«ã‚ãŸã‚Šã€ä»¥ä¸‹ã®è¡Œç‚ºã‚’è¡Œã£ã¦ã¯ãªã‚Šã¾ã›ã‚“ã€‚{"\n"}
                    1. æ³•ä»¤ã¾ãŸã¯å…¬åºè‰¯ä¿—ã«åã™ã‚‹è¡Œç‚ºã€‚{"\n"}
                    2. ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ç¬¬ä¸‰è€…ã€ã¾ãŸã¯æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åèª‰ãƒ»ä¿¡ç”¨ã‚’æ¯€æã—ã€ã¾ãŸã¯ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¾µå®³ã™ã‚‹è¡Œç‚ºã€‚{"\n"}
                    3. æ°åã€ä½æ‰€ã€é›»è©±ç•ªå·ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãªã©ã€ç‰¹å®šã®å€‹äººã‚’è­˜åˆ¥ã§ãã‚‹æƒ…å ±ï¼ˆå€‹äººæƒ…å ±ï¼‰ã‚’æœ¬äººã®åŒæ„ãªãæŠ•ç¨¿ã™ã‚‹è¡Œç‚ºã€‚{"\n"}
                    4. ç‰¹å®šã®å€‹äººã€å›£ä½“ã€äººç¨®ã€å®—æ•™ç­‰ã«å¯¾ã™ã‚‹å·®åˆ¥ã€èª¹è¬—ä¸­å‚·ã€ã¾ãŸã¯ãƒ˜ã‚¤ãƒˆã‚¹ãƒ”ãƒ¼ãƒã«è©²å½“ã™ã‚‹è¡Œç‚ºã€‚{"\n"}
                    5. ã‚¹ãƒ‘ãƒ æŠ•ç¨¿ã€å¤§é‡ã®é€£æŠ•ã€ã¾ãŸã¯æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®é‹å–¶ã‚’å¦¨å®³ã™ã‚‹è¡Œç‚ºã€‚{"\n"}
                    6. é•æ³•ãªè–¬ç‰©ã€æ­¦å™¨ã€å…ç«¥ãƒãƒ«ãƒç­‰ã®æä¾›ã‚„å®£ä¼ã€ã¾ãŸã¯ã“ã‚Œã‚‰ã‚’åŠ©é•·ã™ã‚‹è¡Œç‚ºã€‚{"\n"}
                    7. ãã®ä»–ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ãŒä¸é©å½“ã¨åˆ¤æ–­ã™ã‚‹è¡Œç‚ºã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>3. æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®æ¨©åˆ©ã¨ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</span>
                <p className={styles.content}>
                    1. **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ¨©åˆ©**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ•ç¨¿ã—ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¸°å±ã—ã¾ã™ã€‚ãŸã ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«å¯¾ã—ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æœ¬ã‚µãƒ¼ãƒ“ã‚¹å†…ã§ç„¡å„Ÿã§ä½¿ç”¨ï¼ˆè¤‡è£½ã€è¡¨ç¤ºã€æ”¹å¤‰ç­‰ï¼‰ã™ã‚‹æ¨©åˆ©ã‚’è¨±è«¾ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚{"\n"}
                    2. **å‰Šé™¤æ¨©é™**: æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€æŠ•ç¨¿ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒç¦æ­¢äº‹é …ã«æŠµè§¦ã™ã‚‹å ´åˆã€ã¾ãŸã¯é‹å–¶ä¸Šã®ç†ç”±ã«ã‚ˆã‚Šå¿…è¦ã¨åˆ¤æ–­ã—ãŸå ´åˆã€äº‹å‰é€šçŸ¥ãªãã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å‰Šé™¤ï¼ˆã¾ãŸã¯ã€Œã‚ã¼ãƒ¼ã‚“ã€è¡¨ç¤ºã«ã‚ˆã‚‹éè¡¨ç¤ºåŒ–ï¼‰ã—ã€ã‚ã‚‹ã„ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚{"\n"}
                    3. **AIã«ã‚ˆã‚‹åˆ†æ**: æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€æŠ•ç¨¿å†…å®¹ã‚’AIã‚’ä½¿ç”¨ã—ã¦åˆ†æãƒ»è¦ç´„ãƒ»åˆ†é¡ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã“ã‚Œã«åŒæ„ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>4. å…è²¬äº‹é …</span>
                <p className={styles.content}>
                    1. **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è²¬ä»»**: æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦æŠ•ç¨¿ã•ã‚ŒãŸå†…å®¹ã®æ­£ç¢ºæ€§ã€é©æ³•æ€§ã€å¦¥å½“æ€§ã«ã¤ã„ã¦ä¸€åˆ‡ä¿è¨¼ã—ã¾ã›ã‚“ã€‚æŠ•ç¨¿ã«é–¢ã™ã‚‹è²¬ä»»ã¯ã™ã¹ã¦æŠ•ç¨¿ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè² ã†ã‚‚ã®ã¨ã—ã¾ã™ã€‚{"\n"}
                    2. **æå®³è³ å„Ÿ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã«ã‚ˆã‚Šç¬¬ä¸‰è€…ã¨ã®é–“ã§ç´›äº‰ãŒç”Ÿã˜ãŸå ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã®è²¬ä»»ã¨è²»ç”¨ã§è§£æ±ºã™ã‚‹ã‚‚ã®ã¨ã—ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚{"\n"}
                    3. **ã‚µãƒ¼ãƒ“ã‚¹ã®åœæ­¢**: æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚„ãƒˆãƒ©ãƒ–ãƒ«ç­‰ã®ç†ç”±ã«ã‚ˆã‚Šã€äºˆå‘Šãªãã‚µãƒ¼ãƒ“ã‚¹ã®ä¸€éƒ¨ã¾ãŸã¯å…¨éƒ¨ã‚’åœæ­¢ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>5. è¦ç´„ã®å¤‰æ›´</span>
                <p className={styles.content}>
                    æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€å¿…è¦ã¨åˆ¤æ–­ã—ãŸå ´åˆã«ã¯ã„ã¤ã§ã‚‚æœ¬è¦ç´„ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚å¤‰æ›´å¾Œã®è¦ç´„ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã«è¡¨ç¤ºã•ã‚ŒãŸæ™‚ç‚¹ã‹ã‚‰åŠ¹åŠ›ã‚’ç”Ÿã˜ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚
                </p>
            </div>

            <div className={styles.section}>
                <span className={styles.sectionTitle}>6. æº–æ‹ æ³•ãŠã‚ˆã³è£åˆ¤ç®¡è½„</span>
                <p className={styles.content}>
                    æœ¬è¦ç´„ã¯æ—¥æœ¬æ³•ã«æº–æ‹ ã—ã¾ã™ã€‚æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã—ã¦ç´›äº‰ãŒç”Ÿã˜ãŸå ´åˆã¯ã€æ±äº¬åœ°æ–¹è£åˆ¤æ‰€ã‚’ç¬¬ä¸€å¯©ã®å°‚å±çš„åˆæ„ç®¡è½„è£åˆ¤æ‰€ã¨ã—ã¾ã™ã€‚
                </p>
            </div>

            <div className={styles.footer}>
                2026å¹´2æœˆ18æ—¥ åˆ¶å®š
            </div>
        </div>
    );
}

================
File: src/app/LegalLayout.module.css
================
.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 40px 20px;
    line-height: 1.8;
    color: var(--foreground);
}

.title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 40px;
    border-bottom: 2px solid var(--border);
    padding-bottom: 10px;
}

.section {
    margin-bottom: 40px;
}

.sectionTitle {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 16px;
    display: block;
}

.content {
    font-size: 1rem;
    white-space: pre-wrap;
}

.footer {
    margin-top: 60px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
    font-size: 0.9rem;
    color: var(--color-text-muted);
}

.backLink {
    display: inline-block;
    margin-bottom: 20px;
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 500;
}

.backLink:hover {
    text-decoration: underline;
}

================
File: src/components/AdminAnalytics.module.css
================
.container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    padding: 0 0 2rem 0;
}

.title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #333;
    padding-left: 0.5rem;
    border-left: 4px solid #000;
}

[data-theme='dark'] .title {
    color: #ddd;
    border-left-color: #fff;
}

/* Grid Layout */
.grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}

@media (max-width: 768px) {
    .grid {
        grid-template-columns: 1fr;
    }
}

.card {
    background: #fff;
    border: 1px solid #eee;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
}

[data-theme='dark'] .card {
    background: #1a1a1a;
    border-color: #333;
}

.card h3 {
    font-size: 0.85rem;
    color: #666;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.bigNumber {
    font-size: 2.5rem;
    font-weight: 800;
    line-height: 1;
    margin-bottom: 0.25rem;
    color: #111;
}

[data-theme='dark'] .bigNumber {
    color: #fff;
}

.subtext {
    font-size: 0.85rem;
    color: #888;
}

/* Charts Row */
.chartsRow {
    display: grid;
    grid-template-columns: 2fr 1.5fr;
    gap: 1rem;
}

@media (max-width: 768px) {
    .chartsRow {
        grid-template-columns: 1fr;
    }
}

/* CSS Bar Chart */
.barChart {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    height: 200px;
    gap: 0.5rem;
    padding-top: 1rem;
}

.barWrapper {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100%;
    justify-content: flex-end;
}

.bar {
    width: 60%;
    background: #000;
    min-height: 4px;
    border-radius: 4px 4px 0 0;
    transition: height 0.3s ease;
    opacity: 0.8;
}

.bar:hover {
    opacity: 1;
}

[data-theme='dark'] .bar {
    background: #fff;
}

.barValue {
    font-size: 0.75rem;
    color: #666;
    margin-bottom: 4px;
}

.barLabel {
    margin-top: 0.5rem;
    font-size: 0.75rem;
    color: #888;
}

/* Ranking List */
.rankingList {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.rankingItem {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid #f0f0f0;
}

[data-theme='dark'] .rankingItem {
    border-bottom-color: #333;
}

.rankingItem:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.rank {
    font-weight: 700;
    color: #aaa;
    width: 24px;
}

.rankingItem:nth-child(1) .rank {
    color: #dfae0c;
}

.rankingItem:nth-child(2) .rank {
    color: #9c9c9c;
}

.rankingItem:nth-child(3) .rank {
    color: #ad7845;
}

.info {
    flex: 1;
    min-width: 0;
}

.threadTitle {
    font-weight: 600;
    font-size: 0.95rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 0.1rem;
}

.meta {
    font-size: 0.8rem;
    color: #999;
}

================
File: src/components/AdminAnalytics.tsx
================
'use client';

import styles from './AdminAnalytics.module.css';

interface DailyStat {
    date: string;
    count: number;
}

interface ThreadStat {
    id: string;
    title: string;
    momentum: number;
    views: number;
    board: { name: string };
}

interface AnalyticsProps {
    totalThreads: number;
    totalPosts: number;
    totalActiveThreads: number;
    dailyChartData: DailyStat[];
    aiRatio: {
        threads: number;
        posts: number;
    };
    topMoverThreads: ThreadStat[];
}

export default function AdminAnalytics({ stats }: { stats: AnalyticsProps }) {
    const maxDaily = Math.max(...stats.dailyChartData.map(d => d.count), 10);

    return (
        <div className={styles.container}>
            <h2 className={styles.title}>Community Pulse</h2>

            {/* 1. Overview Cards */}
            <div className={styles.grid}>
                <div className={styles.card}>
                    <h3>Total Posts</h3>
                    <p className={styles.bigNumber}>{stats.totalPosts.toLocaleString()}</p>
                    <div className={styles.subtext}>
                        AI Generated: {stats.aiRatio.posts} ({Math.round((stats.aiRatio.posts / stats.totalPosts) * 100)}%)
                    </div>
                </div>
                <div className={styles.card}>
                    <h3>Active Threads</h3>
                    <p className={styles.bigNumber}>{stats.totalActiveThreads.toLocaleString()}</p>
                    <div className={styles.subtext}>
                        /{stats.totalThreads.toLocaleString()} Total
                    </div>
                </div>
                <div className={styles.card}>
                    <h3>Est. DAU</h3>
                    <p className={styles.bigNumber}>-</p>
                    <div className={styles.subtext}>See Vercel Analytics</div>
                </div>
            </div>

            {/* 2. Charts & Rankings */}
            <div className={styles.chartsRow}>
                {/* 7-Day Post Volume (CSS Bar Chart) */}
                <div className={`${styles.card} ${styles.chartCard}`}>
                    <h3>Post Volume (Last 7 Days)</h3>
                    <div className={styles.barChart}>
                        {stats.dailyChartData.map((d) => {
                            const height = Math.max((d.count / maxDaily) * 100, 4); // Min 4% height
                            return (
                                <div key={d.date} className={styles.barWrapper}>
                                    <div className={styles.barValue}>{d.count}</div>
                                    <div
                                        className={styles.bar}
                                        style={{ height: `${height}%` }}
                                    />
                                    <div className={styles.barLabel}>{d.date.slice(5)}</div>
                                </div>
                            );
                        })}
                    </div>
                </div>

                {/* Momentum Ranking */}
                <div className={`${styles.card} ${styles.rankingCard}`}>
                    <h3>ğŸ”¥ Top Momentum Threads</h3>
                    <ul className={styles.rankingList}>
                        {stats.topMoverThreads.map((t, index) => (
                            <li key={t.id} className={styles.rankingItem}>
                                <span className={styles.rank}>#{index + 1}</span>
                                <div className={styles.info}>
                                    <div className={styles.threadTitle}>{t.title}</div>
                                    <div className={styles.meta}>
                                        {t.board.name} | âš¡{t.momentum} | ğŸ‘€{t.views}
                                    </div>
                                </div>
                            </li>
                        ))}
                    </ul>
                </div>
            </div>
        </div>
    );
}

================
File: src/components/AIInsights.module.css
================
.container {
    background: var(--color-bg-surface);
    border: 1px solid var(--color-border);
    border-radius: 0;
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-md);
}

.header {
    display: flex;
    align-items: center;
    margin-bottom: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
    padding-bottom: var(--spacing-xs);
}

.title {
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--color-text-primary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.section {
    margin-bottom: var(--spacing-md);
}

.section:last-child {
    margin-bottom: 0;
}

.subtitle {
    font-size: 0.8rem;
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.tagList {
    list-style: none;
    padding: 0;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.tag {
    font-size: 0.8rem;
    background: var(--color-bg-base);
    color: var(--color-text-secondary);
    padding: 2px 8px;
    border: 1px solid var(--color-border);
    transition: all 0.2s ease;
    cursor: pointer;
}

.tag:hover {
    border-color: var(--color-text-primary);
    color: var(--color-text-primary);
    background: var(--color-bg-surface);
}

.text {
    font-size: 0.9rem;
    line-height: 1.6;
    color: var(--color-text-primary);
}

================
File: src/components/AIInsights.tsx
================
import styles from './AIInsights.module.css';

export default function AIInsights() {
    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <h3 className={styles.title}>AI Insight</h3>
            </div>
            <div className={styles.content}>
                <div className={styles.section}>
                    <h4 className={styles.subtitle}>Hot Topics</h4>
                    <ul className={styles.tagList}>
                        <li className={styles.tag}>#LLMé€²åŒ–è«–</li>
                        <li className={styles.tag}>#AIè‘—ä½œæ¨©</li>
                        <li className={styles.tag}>#GPUä¸è¶³</li>
                    </ul>
                </div>
                <div className={styles.section}>
                    <h4 className={styles.subtitle}>Discussion Analysis</h4>
                    <p className={styles.text}>
                        ç¾åœ¨ã€ã€ŒæŠ€è¡“çš„ç‰¹ç•°ç‚¹ã€ã«é–¢ã™ã‚‹è­°è«–ãŒæ´»ç™ºåŒ–ã—ã¦ã„ã¾ã™ã€‚è‚¯å®šæ´¾ã¨æ…é‡æ´¾ã®æ„è¦‹ãŒæ‹®æŠ—ã—ã¦ãŠã‚Šã€æ–°ãŸãªå“²å­¦çš„è¦–ç‚¹ãŒæ±‚ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚
                    </p>
                </div>
            </div>
        </div>
    );
}

================
File: src/components/BoardIcon.tsx
================
import {
    Coffee, Newspaper, Briefcase, Banknote, Heart,
    Home, Cpu, Video, Film, Palette, GraduationCap,
    Ghost, Trophy, Shapes
} from 'lucide-react';

interface BoardIconProps {
    category?: string;
    className?: string;
    size?: number;
}

export default function BoardIcon({ category, className, size = 20 }: BoardIconProps) {
    if (!category) return <Shapes className={className} size={size} />;

    switch (category) {
        case 'ãƒ©ã‚¦ãƒ³ã‚¸': return <Coffee className={className} size={size} />;
        case 'ç¤¾ä¼šãƒ»ãƒ‹ãƒ¥ãƒ¼ã‚¹': return <Newspaper className={className} size={size} />;
        case 'ã‚­ãƒ£ãƒªã‚¢ãƒ»ãƒ“ã‚¸ãƒã‚¹': return <Briefcase className={className} size={size} />;
        case 'ãƒãƒãƒ¼ãƒ»è³‡ç”£å½¢æˆ': return <Banknote className={className} size={size} />;
        case 'ã‚¦ã‚§ãƒ«ãƒ“ãƒ¼ã‚¤ãƒ³ã‚°': return <Heart className={className} size={size} />;
        case 'ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«': return <Home className={className} size={size} />;
        case 'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼': return <Cpu className={className} size={size} />;
        case 'å‹•ç”»ãƒ»ã‚½ãƒ¼ã‚·ãƒ£ãƒ«': return <Video className={className} size={size} />;
        case 'ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡': return <Film className={className} size={size} />;
        case 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–': return <Palette className={className} size={size} />;
        case 'å­¦å•': return <GraduationCap className={className} size={size} />;
        case 'ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ»ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«': return <Ghost className={className} size={size} />;
        case 'ã‚¹ãƒãƒ¼ãƒ„ãƒ»ã‚®ãƒ£ãƒ³ãƒ–ãƒ«': return <Trophy className={className} size={size} />;
        default: return <Shapes className={className} size={size} />;
    }
}

================
File: src/components/BoardList.module.css
================
.boardList {
    /* Transparent bg for cleaner look in sidebar */
    background: transparent;
    padding: 0;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.title {
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--color-text-primary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.count {
    font-size: 0.75rem;
    color: var(--color-text-muted);
}

.scrollArea {
    /* Layout handled by parent */
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
}

.categorySection {
    /* Group spacing */
    margin-bottom: var(--spacing-md);
}

/* Category Title Spec */
.categoryTitle {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--muted-foreground);
    margin-bottom: 12px;
    padding-left: 0;
    display: flex;
    align-items: center;
    gap: 8px;
}

.list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.item {
    margin: 0;
}

/* Link Spec */
.link {
    display: flex;
    align-items: center;
    padding: 8px;
    /* 8px vertical/horizontal */
    border-radius: 6px;
    font-size: 14px;
    text-decoration: none;
    transition: all 200ms ease;
    gap: 12px;
    /* icon and text gap */

    /* Default State */
    color: var(--sidebar-foreground);
    opacity: 0.8;
}

.icon {
    color: var(--muted-foreground);
    transition: color 200ms;
}

/* Hover State */
.link:hover {
    background-color: var(--sidebar-accent);
    color: var(--sidebar-foreground);
    opacity: 1;
}

.link:hover .icon {
    color: var(--sidebar-foreground);
    opacity: 0.6;
}

.boardName {
    display: block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 1.2;
}

.description {
    display: none;
}

================
File: src/components/BoardList.tsx
================
import Link from 'next/link';
import { Hash } from 'lucide-react';
import { Board } from '@/data/mockBBS';
import BoardIcon from './BoardIcon'; // Import Icon
import styles from './BoardList.module.css';

interface BoardListProps {
    boards: Board[];
}

export default function BoardList({ boards }: BoardListProps) {
    // ... (grouping logic remains)
    const categories = boards.reduce((acc, board) => {
        const category = board.category || 'Other';
        if (!acc[category]) {
            acc[category] = [];
        }
        acc[category].push(board);
        return acc;
    }, {} as Record<string, Board[]>);

    return (
        <nav className={styles.boardList}>
            {/* ... header ... */}
            <div className={styles.header}>
                <h2 className={styles.title}>æ¿ä¸€è¦§</h2>
                <span className={styles.count}>{boards.length} Boards</span>
            </div>

            <div className={styles.scrollArea}>
                {Object.entries(categories).map(([category, categoryBoards]) => (
                    <div key={category} className={styles.categorySection}>
                        <h3 className={styles.categoryTitle} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                            <BoardIcon category={category} size={18} />
                            {category}
                        </h3>
                        <ul className={styles.list}>
                            {categoryBoards.map((board) => (
                                <li key={board.id} className={styles.item}>
                                    <Link href={`/${board.id}`} className={styles.link}>
                                        <Hash className={styles.icon} size={14} style={{ opacity: 0.5 }} />
                                        <span className={styles.boardName}>{board.name}</span>
                                    </Link>
                                </li>
                            ))}
                        </ul>
                    </div>
                ))}
            </div>
        </nav>
    );
}

================
File: src/components/BoardStatusManager.module.css
================
.container {
    margin-top: 2rem;
    padding: 1.5rem;
    background: var(--card);
    border-radius: 1rem;
    border: 1px solid rgba(var(--foreground-rgb), 0.1);
}

.header {
    margin-bottom: 1.5rem;
}

.header h2 {
    font-size: 1.25rem;
    font-weight: 700;
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
}

.card {
    padding: 1.25rem;
    border-radius: 0.75rem;
    background: var(--background);
    border: 1px solid rgba(var(--foreground-rgb), 0.1);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    gap: 1rem;
    transition: all 0.2s;
}

.locked {
    opacity: 0.6;
    background: var(--accent);
}

.info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.category {
    font-size: 0.75rem;
    color: var(--muted-foreground);
    text-transform: uppercase;
}

.name {
    font-size: 1rem;
    font-weight: 600;
}

.id {
    font-size: 0.75rem;
    color: var(--muted-foreground);
}

.actions {
    display: flex;
    justify-content: flex-end;
}

.unlockBtn,
.lockBtn {
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
}

.unlockBtn {
    background: var(--foreground);
    color: var(--background);
}

.lockBtn {
    background: transparent;
    border: 1px solid rgba(var(--foreground-rgb), 0.2);
    color: var(--foreground);
}

.unlockBtn:hover,
.lockBtn:hover {
    opacity: 0.8;
}

.unlockBtn:disabled,
.lockBtn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

================
File: src/components/DiscoverSection.module.css
================
.list {
    max-width: 80rem;
    margin: 0 auto;
    padding: 0 32px;
}

.empty {
    padding: 0 32px;
    color: var(--muted-foreground);
    font-size: 0.875rem;
}

@media (max-width: 768px) {
    .list {
        padding: 0 24px;
    }

    .empty {
        padding: 0 24px;
    }
}

================
File: src/components/ErrorBoundary.tsx
================
'use client';

import React, { Component, ReactNode } from 'react';

interface ErrorBoundaryProps {
    children: ReactNode;
    fallback: ReactNode;
}

interface ErrorBoundaryState {
    hasError: boolean;
}

export class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {
    constructor(props: ErrorBoundaryProps) {
        super(props);
        this.state = { hasError: false };
    }

    static getDerivedStateFromError(): ErrorBoundaryState {
        return { hasError: true };
    }

    componentDidCatch(error: Error) {
        console.warn('[SourceCard] Tweet embed failed, using fallback:', error.message);
    }

    render() {
        if (this.state.hasError) {
            return this.props.fallback;
        }
        return this.props.children;
    }
}

================
File: src/components/PostBar.module.css
================
/* FAB Trigger */
.fab {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 40;
    width: 3.5rem;
    height: 3.5rem;
    padding: 0;
    background-color: var(--foreground);
    color: var(--background);
    border-radius: 9999px;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease-in-out;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

.fab:hover {
    transform: scale(1.1);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
}

/* Overlay */
.overlay {
    position: fixed;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.4);
    z-index: 45;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease-in-out;
    backdrop-filter: blur(2px);
}

.overlay.visible {
    opacity: 1;
    pointer-events: auto;
}

/* Panel Container */
.panel {
    position: fixed;
    background-color: var(--card);
    z-index: 50;
    display: flex;
    flex-direction: column;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

/* Mobile: Bottom Sheet */
@media (max-width: 767px) {
    .panel {
        bottom: 0;
        left: 0;
        right: 0;
        height: 80vh;
        border-top-left-radius: 1rem;
        border-top-right-radius: 1rem;
        border-top: 1px solid rgba(var(--border-rgb), 0.1);
        transform: translateY(100%);
    }

    .panel.open {
        transform: translateY(0);
    }
}

/* Desktop: Side Panel */
@media (min-width: 768px) {
    .panel {
        top: 0;
        right: 0;
        bottom: 0;
        width: 400px;
        border-left: 1px solid rgba(var(--border-rgb), 0.1);
        transform: translateX(100%);
    }

    .panel.open {
        transform: translateX(0);
    }
}

/* Header */
.header {
    flex-shrink: 0;
    padding: 1rem 1.5rem;
    background-color: rgba(var(--accent-rgb), 0.3);
    border-bottom: 1px solid rgba(var(--border-rgb), 0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.title {
    font-weight: 600;
    font-size: 1rem;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.closeButton {
    padding: 0.5rem;
    border-radius: 9999px;
    background: transparent;
    border: none;
    cursor: pointer;
    color: var(--muted-foreground);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.closeButton:hover {
    background-color: var(--accent);
    color: var(--foreground);
}

/* Content Area */
.content {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

/* Form Elements */
.inputGroup {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.label {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--foreground);
}

.nameInputContainer {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.checkboxLabel {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: var(--foreground);
    cursor: pointer;
    user-select: none;
}

.checkboxLabel input[type="checkbox"] {
    cursor: pointer;
    width: 1rem;
    height: 1rem;
    accent-color: var(--foreground);
}

.input,
.textarea {
    width: 100%;
    padding: 0.75rem 1rem;
    background-color: var(--background);
    border: 1px solid #cbd5e1;
    border-radius: 0.5rem;
    font-family: inherit;
    font-size: 0.95rem;
    color: var(--foreground);
    transition: all 0.2s;
}

.input:focus,
.textarea:focus {
    outline: none;
    border-color: var(--foreground);
    box-shadow: 0 0 0 2px rgba(var(--ring-rgb), 0.1);
}

.textarea {
    min-height: 160px;
    resize: none;
    line-height: 1.6;
}

/* Anchors */
.anchors {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.anchorChip {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    background-color: var(--accent);
    color: var(--accent-foreground);
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.removeAnchor {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0;
    display: flex;
    align-items: center;
    color: inherit;
    opacity: 0.6;
}

.removeAnchor:hover {
    opacity: 1;
}

/* Footer */
.footer {
    flex-shrink: 0;
    padding: 1rem 1.5rem;
    background-color: rgba(var(--accent-rgb), 0.1);
    border-top: 1px solid rgba(var(--border-rgb), 0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.helpText {
    font-size: 0.75rem;
    color: var(--muted-foreground);
}

.submitButton {
    padding: 0.75rem 2rem;
    background-color: var(--foreground);
    color: var(--background);
    border-radius: 9999px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.submitButton:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.submitButton:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

/* Success Toast */
.toast {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 60;
    background-color: #22c55e;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
    animation: slideUpFade 0.3s ease-out;
}

@keyframes slideUpFade {
    from {
        opacity: 0;
        transform: translate(-50%, 1rem);
    }

    to {
        opacity: 1;
        transform: translate(-50%, 0);
    }
}

================
File: src/components/PostBar.tsx
================
'use client';

import { useState, useRef, useEffect } from 'react';
import { submitPost } from '@/app/actions';
import { Edit3, X, Reply, CheckCircle2, Send } from 'lucide-react';
import styles from './PostBar.module.css';

interface PostBarProps {
    boardId: string;
    threadId: string;
    replyTarget?: number | null;
    onReplyHandled?: () => void;
    isOpen: boolean;
    onClose: () => void;
    onOpen: () => void;
}

export default function PostBar({
    boardId,
    threadId,
    replyTarget,
    onReplyHandled,
    isOpen,
    onClose,
    onOpen
}: PostBarProps) {
    const [content, setContent] = useState('');
    const [author, setAuthor] = useState('');
    const [isAnonymous, setIsAnonymous] = useState(true);
    const [isSubmitting, setIsSubmitting] = useState(false);
    const [showSuccess, setShowSuccess] = useState(false);
    const textareaRef = useRef<HTMLTextAreaElement>(null);

    // Close on ESC
    useEffect(() => {
        const handleEscape = (e: KeyboardEvent) => {
            if (e.key === "Escape" && isOpen) {
                onClose();
            }
        };
        window.addEventListener("keydown", handleEscape);
        return () => window.removeEventListener("keydown", handleEscape);
    }, [isOpen, onClose]);

    // Focus textarea when expanded
    useEffect(() => {
        if (isOpen && textareaRef.current) {
            // Small delay to allow transition to start/finish
            setTimeout(() => textareaRef.current?.focus(), 100);
        }
    }, [isOpen]);

    // Handle Reply Target
    useEffect(() => {
        if (replyTarget) {
            // Ensure bar is open
            if (!isOpen) onOpen();

            // Append anchor if not already present or just append
            const anchor = `>>${replyTarget}\n`;
            setContent(prev => {
                // Determine if we need a newline before
                const prefix = prev.length > 0 && !prev.endsWith('\n') ? '\n' : '';
                return prev + prefix + anchor;
            });

            // Signal that we've handled it
            if (onReplyHandled) {
                onReplyHandled();
            }
        }
    }, [replyTarget, onReplyHandled, isOpen, onOpen]);

    // Handle Success Toast timer
    useEffect(() => {
        if (showSuccess) {
            const timer = setTimeout(() => setShowSuccess(false), 3000);
            return () => clearTimeout(timer);
        }
    }, [showSuccess]);

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        if (!content.trim()) return;

        setIsSubmitting(true);

        const formData = new FormData();
        formData.append('boardId', boardId);
        formData.append('threadId', threadId);
        formData.append('content', content);

        const submitAuthor = isAnonymous ? 'åç„¡ã—ã•ã‚“@ãƒ‹ãƒ¥ã€œ' : author;
        formData.append('author', submitAuthor);

        const result = await submitPost(formData);

        if (result.success) {
            setContent('');
            setAuthor('');
            onClose();
            setShowSuccess(true);
            window.location.reload();
        } else {
            alert('æ›¸ãè¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }

        setIsSubmitting(false);
    };

    return (
        <>
            {/* Success Toast */}
            {showSuccess && (
                <div className={styles.toast}>
                    <CheckCircle2 size={16} />
                    æ›¸ãè¾¼ã¿ã¾ã—ãŸ
                </div>
            )}

            {/* Overlay */}
            <div
                className={`${styles.overlay} ${isOpen ? styles.visible : ''}`}
                onClick={onClose}
            />

            {/* Floating Action Button (Visible when collapsed) */}
            {!isOpen && (
                <button
                    onClick={onOpen}
                    className={styles.fab}
                    title="æ›¸ãè¾¼ã‚€"
                >
                    <Edit3 size={24} />
                </button>
            )}

            {/* Panel */}
            <div className={`${styles.panel} ${isOpen ? styles.open : ''}`}>
                <div className={styles.header}>
                    <h3 className={styles.title}>
                        <Edit3 size={18} />
                        æ›¸ãè¾¼ã‚€
                    </h3>
                    <button
                        className={styles.closeButton}
                        onClick={onClose}
                        title="é–‰ã˜ã‚‹"
                    >
                        <X size={20} />
                    </button>
                </div>

                <div className={styles.content}>
                    <form onSubmit={handleSubmit} id="post-form" style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem', flex: 1 }}>
                        {/* Author Input */}
                        <div className={styles.inputGroup}>
                            <label className={styles.label}>åå‰</label>
                            <div className={styles.nameInputContainer}>
                                <label className={styles.checkboxLabel}>
                                    <input
                                        type="checkbox"
                                        checked={isAnonymous}
                                        onChange={(e) => setIsAnonymous(e.target.checked)}
                                    />
                                    åŒ¿åã§æŠ•ç¨¿ã™ã‚‹
                                </label>
                                {!isAnonymous && (
                                    <input
                                        type="text"
                                        placeholder="åå‰ã‚’å…¥åŠ›"
                                        value={author}
                                        onChange={(e) => setAuthor(e.target.value)}
                                        className={styles.input}
                                        disabled={isSubmitting}
                                    />
                                )}
                            </div>
                        </div>

                        {/* Main Textarea */}
                        <div className={styles.inputGroup} style={{ flex: 1 }}>
                            <label className={styles.label}>
                                æœ¬æ–‡ <span style={{ color: 'var(--muted-foreground)', fontWeight: 'normal', marginLeft: '0.5rem', fontSize: '0.75rem' }}>(Markdownå¯¾å¿œ)</span>
                            </label>
                            <textarea
                                ref={textareaRef}
                                className={styles.textarea}
                                placeholder="æœ¬æ–‡ã‚’å…¥åŠ›..."
                                value={content}
                                onChange={(e) => setContent(e.target.value)}
                                disabled={isSubmitting}
                                style={{ flex: 1 }}
                            />
                            <div className={styles.helpText} style={{ marginTop: '0.5rem' }}>
                                <p style={{ fontSize: '0.8rem', color: 'var(--muted-foreground)', display: 'flex', alignItems: 'center', gap: '0.5rem', margin: 0 }}>
                                    <Reply size={14} />
                                    <span><code className={styles.helpCode}>&gt;&gt;1</code> ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹ã¨è¿”ä¿¡ã§ãã¾ã™ã€‚è¤‡æ•°æŒ‡å®šã‚‚ã§ãã‚‹ã‚ˆ</span>
                                </p>
                            </div>
                        </div>
                    </form>
                </div>

                <div className={styles.footer}>
                    <button
                        type="submit"
                        form="post-form"
                        className={styles.submitButton}
                        disabled={isSubmitting || !content.trim()}
                        style={{ marginLeft: 'auto' }}
                    >
                        <Send size={16} />
                        {isSubmitting ? 'é€ä¿¡ä¸­...' : 'æ›¸ãè¾¼ã‚€'}
                    </button>
                </div>
            </div>
        </>
    );
}

================
File: src/components/PostContent.module.css
================
.content {
    white-space: pre-wrap;
    word-break: break-all;
    line-height: 1.6;
}

.brokenAnchor {
    color: var(--color-text-muted);
    text-decoration: line-through;
}

.anchorWrapper {
    position: relative;
    display: inline-block;
}

.anchorLink {
    color: #3498db;
    /* Specific anchor color, can be var */
    text-decoration: underline;
    cursor: pointer;
    font-weight: bold;
}

.anchorLink:hover {
    color: #5dade2;
}

/* Preview Card (Tooltip) */
.previewCard {
    position: absolute;
    bottom: 100%;
    left: 0;
    width: 300px;
    /* Fixed width for preview */
    background: var(--color-bg-surface);
    border: 1px solid var(--color-border);
    border-radius: 4px;
    /* Slightly defined */
    padding: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    z-index: 100;
    pointer-events: none;
    /* User pass-through */
    margin-bottom: 8px;
    /* Offset */

    /* Animation */
    opacity: 0;
    transform: translateY(10px);
    animation: fadeIn 0.2s forwards;

    text-align: left;
}

@keyframes fadeIn {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.previewHeader {
    display: flex;
    gap: 8px;
    font-size: 0.75rem;
    color: var(--color-text-muted);
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 6px;
    margin-bottom: 6px;
}

.previewNumber {
    font-weight: bold;
}

.previewBody {
    font-size: 0.85rem;
    color: var(--color-text-primary);
    line-height: 1.4;
    white-space: pre-wrap;
}

/* Highlight Target Animation */
.highlightTarget {
    animation: flashHighlight 1s ease-out;
}

@keyframes flashHighlight {
    0% {
        background-color: rgba(52, 152, 219, 0.3);
    }

    100% {
        background-color: transparent;
    }
}

================
File: src/components/PostForm.module.css
================
.container {
    background: var(--color-bg-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    box-shadow: var(--shadow-sm);
}

/* ... */

.input {
    padding: var(--spacing-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    font-family: inherit;
    font-size: 0.9rem;
    width: 200px;
    background: var(--color-bg-base);
    color: var(--color-text-primary);
    transition: border-color 0.2s;
}

/* ... */

.textarea {
    width: 100%;
    resize: vertical;
    margin-bottom: var(--spacing-sm);
    font-family: inherit;
    padding: var(--spacing-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    background: var(--color-bg-base);
    color: var(--color-text-primary);
    transition: border-color 0.2s;
    min-height: 100px;
}

/* ... */

.button {
    background-color: var(--color-text-primary);
    /* Black */
    color: #ffffff;
    /* White text */
    padding: 8px 16px;
    border-radius: var(--radius-sm);
    font-weight: bold;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
}

.button:hover:not(:disabled) {
    background-color: var(--color-text-secondary);
    transform: none;
}

================
File: src/components/PostList.module.css
================
.container {
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-md);
}

.list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.item {
    margin-bottom: var(--spacing-md);
    padding-bottom: var(--spacing-md);
    border-bottom: 1px solid #f0f0f0;
}

.item:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}

.header {
    margin-bottom: var(--spacing-xs);
    font-size: 0.9rem;
    color: var(--color-text-secondary);
}

.number {
    font-weight: bold;
    margin-right: var(--spacing-sm);
    color: var(--color-text);
}

.name {
    font-weight: bold;
    color: #2b6cb0;
    margin-right: var(--spacing-sm);
}

.date {
    margin-right: var(--spacing-sm);
}

.id {
    font-family: var(--font-mono);
    font-size: 0.8rem;
}

.content {
    font-size: 1rem;
    line-height: 1.6;
    color: var(--color-text);
}

.line {
    margin-bottom: 0.5em;
}

.empty {
    text-align: center;
    color: var(--color-text-secondary);
}

================
File: src/components/Providers.tsx
================
'use client';

import { SessionProvider } from 'next-auth/react';

export default function Providers({ children }: { children: React.ReactNode }) {
    return <SessionProvider>{children}</SessionProvider>;
}

================
File: src/components/ReportBoard.module.css
================
.container {
    padding: 1rem;
    height: 100%;
    overflow-y: auto;
}

.header {
    margin-bottom: 2rem;
    border-bottom: 1px solid var(--border);
    padding-bottom: 1rem;
}

.header h2 {
    font-size: 1.5rem;
    font-weight: 700;
}

.empty {
    padding: 4rem;
    text-align: center;
    color: var(--muted-foreground);
    background: var(--card);
    border-radius: 1rem;
}

.list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.reportCard {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 1rem;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
}

.reportHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.reasonTag {
    background: #fee2e2;
    color: #ef4444;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
}

.reportDate {
    font-size: 0.75rem;
    color: var(--muted-foreground);
}

.postContext {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.contextHeader {
    font-size: 0.8rem;
    color: var(--muted-foreground);
}

.postBox {
    background: var(--accent);
    padding: 1rem;
    border-radius: 0.5rem;
    border: 1px dashed var(--border);
}

.postMeta {
    font-size: 0.75rem;
    color: var(--muted-foreground);
    margin-bottom: 0.5rem;
}

.postContent {
    font-size: 0.9rem;
    color: var(--foreground);
    white-space: pre-wrap;
}

.reportDetail {
    font-size: 0.85rem;
    background: var(--color-bg-subtle);
    padding: 0.75rem;
    border-radius: 0.5rem;
}

.actions {
    display: flex;
    gap: 1rem;
    margin-top: 0.5rem;
}

.deleteBtn {
    background: #ef4444;
    color: white;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 0.5rem;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.2s;
}

.deleteBtn:hover {
    opacity: 0.9;
}

.dismissBtn {
    background: transparent;
    color: var(--foreground);
    border: 1px solid var(--border);
    padding: 0.6rem 1.2rem;
    border-radius: 0.5rem;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
}

.dismissBtn:hover {
    background: var(--accent);
}

================
File: src/components/ReportButton.module.css
================
.container {
    position: relative;
    display: inline-flex;
}

.trigger {
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    cursor: pointer;
    color: var(--muted-foreground);
    padding: 0.2rem;
    border-radius: 0.25rem;
    transition: color 0.2s, background 0.2s;
    opacity: 0.4;
}

.trigger:hover {
    color: #e74c3c;
    background: rgba(231, 76, 60, 0.08);
    opacity: 1;
}

.dropdown {
    position: absolute;
    bottom: 100%;
    right: 0;
    min-width: 160px;
    background: var(--card);
    border: 1px solid rgba(var(--border-rgb), 0.15);
    border-radius: 0.5rem;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    z-index: 100;
    overflow: hidden;
    animation: fadeIn 0.15s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(4px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.dropdownTitle {
    font-size: 0.7rem;
    color: var(--muted-foreground);
    padding: 0.5rem 0.75rem 0.25rem;
    font-weight: 600;
}

.reasonButton {
    display: block;
    width: 100%;
    text-align: left;
    padding: 0.5rem 0.75rem;
    background: none;
    border: none;
    font-size: 0.8rem;
    color: var(--foreground);
    cursor: pointer;
    font-family: inherit;
    transition: background 0.15s;
}

.reasonButton:hover {
    background: var(--accent);
}

.reasonButton:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.done {
    padding: 0.75rem;
    text-align: center;
    font-size: 0.8rem;
    color: #27ae60;
    font-weight: 600;
}

================
File: src/components/ReportButton.tsx
================
'use client';

import { useState } from 'react';
import { Flag } from 'lucide-react';
import { reportPost } from '@/app/actions';
import styles from './ReportButton.module.css';

interface ReportButtonProps {
    postId: string;
}

const REPORT_REASONS = [
    { value: 'spam', label: 'ã‚¹ãƒ‘ãƒ ãƒ»å®£ä¼' },
    { value: 'abuse', label: 'èª¹è¬—ä¸­å‚·ãƒ»æš´è¨€' },
    { value: 'illegal', label: 'é•æ³•ãªå†…å®¹' },
    { value: 'other', label: 'ãã®ä»–' },
];

export default function ReportButton({ postId }: ReportButtonProps) {
    const [isOpen, setIsOpen] = useState(false);
    const [isSubmitting, setIsSubmitting] = useState(false);
    const [done, setDone] = useState(false);

    const handleReport = async (reason: string) => {
        setIsSubmitting(true);
        const formData = new FormData();
        formData.append('postId', postId);
        formData.append('reason', reason);
        await reportPost(formData);
        setIsSubmitting(false);
        setDone(true);
        setTimeout(() => {
            setIsOpen(false);
            setDone(false);
        }, 2000);
    };

    return (
        <div className={styles.container}>
            <button
                onClick={() => setIsOpen(!isOpen)}
                className={styles.trigger}
                title="é€šå ±"
            >
                <Flag size={12} />
            </button>

            {isOpen && (
                <div className={styles.dropdown}>
                    {done ? (
                        <div className={styles.done}>âœ“ é€šå ±ã—ã¾ã—ãŸ</div>
                    ) : (
                        <>
                            <div className={styles.dropdownTitle}>é€šå ±ç†ç”±ã‚’é¸æŠ</div>
                            {REPORT_REASONS.map(r => (
                                <button
                                    key={r.value}
                                    onClick={() => handleReport(r.value)}
                                    disabled={isSubmitting}
                                    className={styles.reasonButton}
                                >
                                    {r.label}
                                </button>
                            ))}
                        </>
                    )}
                </div>
            )}
        </div>
    );
}

================
File: src/components/SourceCard.tsx
================
'use client';

import { Suspense } from 'react';
import { Tweet } from 'react-tweet';
import { ErrorBoundary } from './ErrorBoundary';

interface SourceCardProps {
    sourceUrl: string | null;
    sourceTitle: string | null;
    sourcePlatform: string | null;
}

export function SourceCard({ sourceUrl, sourceTitle, sourcePlatform }: SourceCardProps) {
    if (!sourceUrl) return null;

    // Twitter Embed logic
    if (sourcePlatform === 'twitter' || isTwitterUrl(sourceUrl)) {
        const tweetId = extractTweetId(sourceUrl);
        if (tweetId) {
            return (
                <div className="my-6 flex justify-center w-full" data-theme="dark">
                    <div className="w-full max-w-[500px]">
                        <ErrorBoundary fallback={<LinkCard url={sourceUrl} title={sourceTitle} />}>
                            <Suspense fallback={<div style={{ textAlign: 'center', padding: '1rem', color: 'var(--color-text-muted)' }}>Loading tweet...</div>}>
                                <Tweet id={tweetId} />
                            </Suspense>
                        </ErrorBoundary>
                    </div>
                </div>
            );
        }
    }

    return <LinkCard url={sourceUrl} title={sourceTitle} />;
}

// Reusable fallback link card
function LinkCard({ url, title }: { url: string; title: string | null }) {
    let hostname = '';
    try {
        hostname = new URL(url).hostname;
    } catch {
        hostname = 'External Link';
    }

    return (
        <a
            href={url}
            target="_blank"
            rel="noopener noreferrer"
            style={{
                display: 'block',
                margin: '1.5rem 0',
                padding: '1rem 1.5rem',
                border: '1px solid var(--color-border)',
                borderRadius: '0',
                background: 'var(--color-bg-surface)',
                textDecoration: 'none',
                color: 'inherit',
                transition: 'background 0.2s',
            }}
        >
            <div style={{ fontSize: '0.75rem', color: 'var(--color-text-muted)', marginBottom: '0.5rem', fontFamily: 'monospace', textTransform: 'uppercase', letterSpacing: '0.05em' }}>
                Source â€¢ {hostname}
            </div>
            <h3 style={{ fontSize: '1.1rem', fontWeight: 'bold', margin: 0, lineHeight: 1.4 }}>
                {title || url}
            </h3>
            <div style={{ fontSize: '0.8rem', color: 'var(--color-text-muted)', marginTop: '0.25rem', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>
                {url}
            </div>
        </a>
    );
}

function isTwitterUrl(url: string) {
    return url.includes('twitter.com') || url.includes('x.com');
}

function extractTweetId(url: string) {
    const match = url.match(/(?:twitter|x)\.com\/[\w_]+\/status\/(\d+)/);
    return match ? match[1] : null;
}

================
File: src/components/SparkAdmin.module.css
================
.container {
    margin-top: auto;
    /* Push to bottom of sidebar if flex column */
    padding: 16px;
    border-top: 1px solid #333;
    background: #1a1a1a;
}

.title {
    color: #888;
    font-size: 0.8rem;
    margin: 0 0 10px 0;
    text-transform: uppercase;
}

.button {
    width: 100%;
    background: #444;
    color: #eee;
    border: 1px solid #555;
    padding: 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8rem;
    transition: background 0.2s;
}

.button:hover {
    background: #555;
}

.button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.status {
    color: #4ade80;
    font-size: 0.75rem;
    margin-top: 8px;
    text-align: center;
}

.note {
    color: #666;
    font-size: 0.7rem;
    margin-top: 8px;
    font-style: italic;
}

================
File: src/components/SparkGenerator.module.css
================
.openButton {
    background: var(--color-bg-surface);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
    padding: 10px 20px;
    border-radius: var(--radius-full);
    font-weight: bold;
    cursor: pointer;
    box-shadow: var(--shadow-sm);
    transition: all 0.2s;
    margin-bottom: 20px;
    width: 100%;
    text-align: left;
}

.openButton:hover {
    background: var(--color-bg-base);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.container {
    background: var(--color-bg-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: 24px;
    margin-bottom: 20px;
    animation: slideDown 0.3s ease-out;
    box-shadow: var(--shadow-md);
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 12px;
}

.title {
    margin: 0;
    font-size: 1.2rem;
    color: var(--color-text-primary);
    display: flex;
    align-items: center;
    gap: 8px;
}

.closeButton {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--color-text-secondary);
    cursor: pointer;
}

.closeButton:hover {
    color: var(--color-text-primary);
}

.intro {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    margin-bottom: 20px;
}

.section {
    margin-bottom: 20px;
}

.label {
    display: block;
    font-weight: bold;
    color: var(--color-text-primary);
    margin-bottom: 8px;
    font-size: 0.95rem;
}

.input {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--color-border);
    border-radius: 0;
    font-size: 1rem;
    box-sizing: border-box;
    background: var(--color-bg-base);
    color: var(--color-text-primary);
}

.input:focus {
    outline: none;
    border-color: var(--color-text-primary);
}

.typeGrid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

.typeButton {
    background: var(--color-bg-base);
    border: 1px solid var(--color-border);
    border-radius: 0;
    padding: 12px;
    text-align: left;
    cursor: pointer;
    transition: all 0.2s;
    color: var(--color-text-primary);
}

.typeButton:hover {
    border-color: var(--color-text-primary);
    background: var(--color-bg-surface);
}

.typeButton.selected {
    border-color: var(--color-text-primary);
    background: var(--color-text-primary);
    color: var(--color-bg-base);
    box-shadow: none;
}

/* Inverted text when selected */
.typeButton.selected .typeLabel,
.typeButton.selected .typeDesc {
    color: var(--color-bg-base);
}


.typeLabel {
    display: block;
    font-weight: bold;
    font-size: 0.9rem;
    color: inherit;
}

.typeDesc {
    display: block;
    font-size: 0.75rem;
    color: var(--color-text-secondary);
    margin-top: 2px;
}

.typeButton:hover .typeDesc {
    color: var(--color-text-primary);
}

.actions {
    margin-top: 24px;
    text-align: center;
}

.generateButton {
    background: var(--color-text-primary);
    color: #ffffff;
    border: none;
    padding: 12px 32px;
    border-radius: 0;
    font-weight: bold;
    font-size: 1rem;
    cursor: pointer;
    transition: opacity 0.2s;
    width: 100%;
}

.generateButton:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--color-text-muted);
}

================
File: src/components/SparkGenerator.tsx
================
'use client';

import { useState } from 'react';
import { createNewThread } from '@/app/actions';
import styles from './SparkGenerator.module.css';

interface SparkGeneratorProps {
    boardId: string;
}

type SparkType = 'conflict' | 'experience' | 'boundary' | 'hypothesis';

export default function SparkGenerator({ boardId }: SparkGeneratorProps) {
    const [isOpen, setIsOpen] = useState(false);
    const [topic, setTopic] = useState('');
    const [selectedType, setSelectedType] = useState<SparkType | null>(null);
    const [isGenerating, setIsGenerating] = useState(false);

    const sparkTypes: { id: SparkType; label: string; description: string }[] = [
        { id: 'conflict', label: 'å¯¾ç«‹å‹ (Conflict)', description: 'A vs B ã®æ§‹é€ ã§è­°è«–ã‚’æ´»æ€§åŒ–' },
        { id: 'experience', label: 'çµŒé¨“è«‡åé›†å‹ (Experience)', description: 'ã€Œã€œãªä½“é¨“ã‚ã‚‹ï¼Ÿã€ã§å…±æ„Ÿã‚’é›†ã‚ã‚‹' },
        { id: 'boundary', label: 'ç·šå¼•ãå‹ (Boundary)', description: 'ã€Œã©ã“ã‹ã‚‰ãŒã€‡ã€‡ï¼Ÿã€ã§å®šç¾©ã‚’æ¢ã‚‹' },
        { id: 'hypothesis', label: 'ä»®èª¬æç¤ºå‹ (Hypothesis)', description: 'å¤§èƒ†ãªä»®èª¬ã§åè¨¼ã‚’èª˜ã†' },
    ];

    /* ... */

    const handleGenerate = async () => {
        if (!selectedType || !topic.trim()) return;

        setIsGenerating(true);

        // Mock AI Generation delay
        await new Promise(resolve => setTimeout(resolve, 1500));

        let title = '';
        let content = '';

        // Mock Generation Logic based on Type
        switch (selectedType) {
            case 'conflict':
                title = `ã€è­°è«–ã€‘${topic}ã¯ã€Œè‚¯å®šæ´¾ã€vsã€Œå¦å®šæ´¾ã€ã©ã£ã¡ï¼Ÿ`;
                content = `æœ€è¿‘è©±é¡Œã®ã€Œ${topic}ã€ã«ã¤ã„ã¦è­°è«–ã—ãŸã„ã€‚\n\nãƒ¡ãƒªãƒƒãƒˆã‚‚å¤šã„ã‘ã©ã€ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚‚ç„¡è¦–ã§ããªã„ã€‚\n\nè‚¯å®šæ´¾ï¼š\nãƒ»ç”Ÿç”£æ€§ãŒä¸ŠãŒã‚‹\nãƒ»æ–°ã—ã„ä¾¡å€¤è¦³\n\nå¦å®šæ´¾ï¼š\nãƒ»ãƒªã‚¹ã‚¯ãŒé«˜ã„\nãƒ»å¾“æ¥ã®æ–‡åŒ–ãŒå£Šã‚Œã‚‹\n\nã¿ãªã•ã‚“ã¯ã©ã£ã¡ã®ç«‹å ´ï¼Ÿå¿Œæ†šã®ãªã„æ„è¦‹ã‚’æ±‚ã‚€ã€‚`;
                break;
            case 'experience':
                title = `ã€å‹Ÿé›†ã€‘${topic}ã§ã€Œã¾ã•ã‹ã€ã¨æ€ã£ãŸä½“é¨“è«‡`;
                content = `ã¿ãªã•ã‚“ã®å‘¨ã‚Šã§ã€Œ${topic}ã€ã«é–¢ã™ã‚‹é¢ç™½ã„ãƒ»æ€–ã„ãƒ»è€ƒãˆã•ã›ã‚‰ã‚Œã‚‹ä½“é¨“è«‡ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚\n\nç§ã®å ´åˆã¯â€¦ï¼ˆä¾‹ï¼‰\n\näº›ç´°ãªã“ã¨ã§ã‚‚OKã€‚é›†ã¾ã£ãŸäº‹ä¾‹ã‹ã‚‰ä½•ã‹æ³•å‰‡ãŒè¦‹ãˆã‚‹ã‹ã‚‚ã€‚`;
                break;
            case 'boundary':
                title = `ã©ã“ã‹ã‚‰ãŒã€Œ${topic}ã€ãªã®ã‹ï¼Ÿå¢ƒç•Œç·šã‚’æ±ºã‚ã‚‹ã‚¹ãƒ¬`;
                content = `ã€Œ${topic}ã€ã®å®šç¾©ã£ã¦äººã«ã‚ˆã£ã¦é•ã†ã‚ˆã­ã€‚\n\nãƒ»Aã®ã‚±ãƒ¼ã‚¹ã¯ï¼Ÿ â†’ ãŸã¶ã‚“OK\nãƒ»Bã®ã‚±ãƒ¼ã‚¹ã¯ï¼Ÿ â†’ å¾®å¦™\nãƒ»Cã®ã‚±ãƒ¼ã‚¹ã¯ï¼Ÿ â†’ å®Œå…¨ã‚¢ã‚¦ãƒˆ\n\nã¿ã‚“ãªã®ã€Œè¨±å®¹ç¯„å›²ã€ã‚„ã€Œå®šç¾©ã€ã®å¢ƒç•Œç·šï¼ˆãƒ©ã‚¤ãƒ³ï¼‰ã‚’å‡ºã—åˆã£ã¦ã€é›†åˆçŸ¥ã§ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä½œã‚ŠãŸã„ã€‚`;
                break;
            case 'hypothesis':
                title = `ã€ä»®èª¬ã€‘${topic}ã®æœ¬è³ªã¯å®Ÿã¯ã€‡ã€‡ãªã‚“ã˜ã‚ƒãªã„ã‹èª¬`;
                content = `å¤šãã®äººã¯ã€Œ${topic}ã€ã‚’Xã ã¨æ€ã£ã¦ã‚‹ã‘ã©ã€å®Ÿã¯Yãªã‚“ã˜ã‚ƒãªã„ã‹ï¼Ÿã¨ãµã¨æ€ã£ãŸã€‚\n\næ ¹æ‹ ï¼š\n1. æœ€è¿‘ã®å‹•å‘\n2. æ­´å²çš„ãªé¡ä¼¼ç‚¹\n\nã“ã®ä»®èª¬ã€ã©ã†æ€ã†ï¼Ÿ\nã€Œãã‚Œã¯é•ã†ã€ã€Œä¸€ç†ã‚ã‚‹ã€ã€Œã‚€ã—ã‚Zã ã€ãªã©ã€åè«–ãƒ»è£œå¼·æ±‚ã‚€ã€‚\n\n[AIææ¡ˆ] ã“ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã¯AIãŒè­°é¡Œã‚’æä¾›ã—ã¾ã—ãŸã€‚`;
                break;
        }

        // Auto-submit the generated thread via Server Action
        const formData = new FormData();
        formData.append('boardId', boardId);
        formData.append('title', `[AI] ${title}`);
        formData.append('content', content);

        await createNewThread(formData);

        setIsGenerating(false);
        setIsOpen(false);
        setTopic('');
        setSelectedType(null);
    };

    if (!isOpen) {
        return (
            <button onClick={() => setIsOpen(true)} className={styles.openButton}>
                AIã§å•ã„ã‚’ç«‹ã¦ã‚‹ (AI Spark)
            </button>
        );
    }

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <h3 className={styles.title}>AI Spark Generator</h3>
                <button onClick={() => setIsOpen(false)} className={styles.closeButton}>Ã—</button>
            </div>

            <div className={styles.body}>
                <p className={styles.intro}>AIãŒã‚ãªãŸã®ä»£ã‚ã‚Šã«ã€Œç››ã‚Šä¸ŠãŒã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã€ã®ç¨®ï¼ˆSparkï¼‰ã‚’ä½œã‚Šã¾ã™ã€‚</p>

                <div className={styles.section}>
                    <label className={styles.label}>1. ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›</label>
                    <input
                        type="text"
                        value={topic}
                        onChange={(e) => setTopic(e.target.value)}
                        placeholder="ä¾‹: ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯, AIè¦åˆ¶, 30ä»£ã®ã‚­ãƒ£ãƒªã‚¢..."
                        className={styles.input}
                    />
                </div>

                <div className={styles.section}>
                    <label className={styles.label}>2. å•ã„ã®å‹ã‚’é¸æŠ</label>
                    <div className={styles.typeGrid}>
                        {sparkTypes.map((type) => (
                            <button
                                key={type.id}
                                onClick={() => setSelectedType(type.id)}
                                className={`${styles.typeButton} ${selectedType === type.id ? styles.selected : ''}`}
                            >
                                <span className={styles.typeLabel}>{type.label}</span>
                                <span className={styles.typeDesc}>{type.description}</span>
                            </button>
                        ))}
                    </div>
                </div>

                <div className={styles.actions}>
                    <button
                        onClick={handleGenerate}
                        disabled={isGenerating || !topic || !selectedType}
                        className={styles.generateButton}
                    >
                        {isGenerating ? 'AIãŒæ€è€ƒä¸­...' : 'ã“ã®æ§‹æˆã§ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆ'}
                    </button>
                </div>
            </div>
        </div>
    );
}

================
File: src/components/ThemeToggle.module.css
================
.placeholder {
    width: 90px;
    height: 40px;
}

.toggleContainer {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 6px 16px 6px 6px;
    background: rgba(233, 235, 239, 0.5);
    /* Glassmorphism base */
    border: 1px solid rgba(0, 0, 0, 0.05);
    border-radius: 9999px;
    cursor: pointer;
    transition: all 0.2s ease;
    backdrop-filter: blur(8px);
    position: relative;
    color: var(--foreground);
    font-family: var(--font-sans);
    pointer-events: auto;
    /* Enable clicks */
}

.toggleContainer:hover {
    background: rgba(233, 235, 239, 0.8);
    border-color: rgba(0, 0, 0, 0.1);
}

.toggleContainer:active {
    transform: scale(0.98);
}

/* Track Area */
.track {
    position: relative;
    width: 52px;
    height: 28px;
    border-radius: 9999px;
    background: rgba(0, 0, 0, 0.05);
    /* Inner track */
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 6px;
    /* Space for background icons */
    transition: all 0.3s ease;
}

/* Background Icons (Static) */
.icons {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 8px;
    pointer-events: none;
    z-index: 0;
}

.iconBase {
    color: var(--muted-foreground);
    opacity: 0.5;
    display: flex;
    transition: opacity 0.2s;
}

.iconHidden {
    opacity: 0;
}

/* Slider (Moving Part) */
.slider {
    position: absolute;
    left: 2px;
    top: 2px;
    width: 24px;
    height: 24px;
    background: #ffffff;
    border-radius: 50%;
    box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.1),
        0 1px 2px rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    color: #f59e0b;
    /* Sun color */
}

.sliderDark {
    transform: translateX(24px);
    background: #020203;
    color: #ffffff;
    /* Moon color */
}

.sliderIcon {
    animation: rotateIn 0.4s ease-out;
}

/* Label */
.label {
    font-size: 0.85rem;
    font-weight: 600;
    letter-spacing: 0.02em;
    min-width: 40px;
    text-align: left;
}

@keyframes rotateIn {
    from {
        transform: rotate(-90deg) scale(0.5);
        opacity: 0;
    }

    to {
        transform: rotate(0) scale(1);
        opacity: 1;
    }
}

================
File: src/components/ThreadCard.module.css
================
/* â”€â”€â”€ Base Card â”€â”€â”€ */
.card {
    background-color: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    transition: all 200ms ease;
    display: flex;
    flex-direction: column;
    text-decoration: none;
    color: inherit;
    padding: 20px;
}

.card:hover {
    border-color: var(--ring);
}

/* â”€â”€â”€ Horizontal variant (WHAT'S NEW) â”€â”€â”€ */
/* â”€â”€â”€ Horizontal variant (WHAT'S NEW) - Refined â”€â”€â”€ */
/* â”€â”€â”€ Horizontal variant (WHAT'S NEW) - Refined (Calm & Modern) â”€â”€â”€ */
.horizontal {
    width: 320px;
    height: 160px;
    flex-shrink: 0;

    /* Modern Clean Base - Dark Mode Compatible */
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;

    /* Subtle, Calm Shadow */
    box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.04),
        0 1px 2px rgba(0, 0, 0, 0.02);

    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    z-index: 1;
}

.horizontal:hover {
    transform: translateY(-2px);
    border-color: var(--ring);
    background: var(--card);

    /* Soft Elevation */
    box-shadow:
        0 12px 24px -4px rgba(0, 0, 0, 0.1),
        0 4px 8px -2px rgba(0, 0, 0, 0.05);
    z-index: 10;
}

/* Removed futuristic pseudo-elements */

.horizontal:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
}

/* â”€â”€â”€ Grid variant (PICK UP / DISCOVER) â”€â”€â”€ */
.grid {
    height: auto;
}

/* â”€â”€â”€ Meta Info â”€â”€â”€ */
.meta {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
    font-size: 0.75rem;
    color: var(--muted-foreground);
    line-height: 1;
}

.boardName {
    font-weight: 500;
    color: var(--foreground);
}

.separator {
    color: var(--muted-foreground);
}

.time {
    color: var(--muted-foreground);
}

.timeWrapper {
    display: flex;
    align-items: center;
    gap: 4px;
    color: var(--muted-foreground);
}

/* â”€â”€â”€ Title â”€â”€â”€ */
.title {
    font-size: 1rem;
    font-weight: 500;
    line-height: 1.625;
    color: var(--foreground);
    margin: 0;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
    transition: opacity 200ms ease;
}

/* Bold title for horizontal (WHAT'S NEW) cards */
.horizontalTitle {
    font-weight: 700;
}

.card:hover .title {
    opacity: 0.7;
}

.lineClamp2 {
    -webkit-line-clamp: 2;
}

/* â”€â”€â”€ Title margin for grid cards (push stats down) â”€â”€â”€ */
.titleGrid {
    margin-bottom: 16px;
    flex-grow: 1;
}

/* â”€â”€â”€ Stats â”€â”€â”€ */
.stats {
    margin-top: auto;
    display: flex;
    align-items: baseline;
    gap: 4px;
}

.commentCount {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--foreground);
    line-height: 1;
    font-variant-numeric: tabular-nums;
}

.commentLabel {
    font-size: 0.875rem;
    font-weight: 400;
    /* Color not specified in request, so inherit (likely foreground) */
    color: inherit;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â”€â”€â”€ List Variant (PICK UP / DISCOVER) â”€â”€â”€ */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.listItem {
    display: block;
    padding: 20px 24px;
    background-color: var(--card);
    border-bottom: 1px solid var(--border);
    /* border-border/40 */
    text-decoration: none;
    color: inherit;
    transition: all 200ms ease;
}

.listItem:hover {
    background-color: var(--accent);
    /* bg-muted/50 */
}

.listItem:last-child {
    border-bottom: none;
}

/* â”€â”€â”€ List Title â”€â”€â”€ */
.listTitle {
    font-size: 1.125rem;
    /* text-lg */
    font-weight: 500;
    line-height: 1.375;
    /* leading-snug */
    margin: 0 0 12px 0;
    /* mb-3 */
    color: var(--foreground);
    transition: color 200ms ease;
}

.listItem:hover .listTitle {
    color: var(--muted-foreground);
    /* text-foreground/70 */
}

/* â”€â”€â”€ List Meta Row â”€â”€â”€ */
.listMeta {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.listMetaLeft {
    display: flex;
    align-items: center;
    gap: 8px;
}

.listBoardName {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--muted-foreground);
    /* text-foreground/70 */
}

.listSeparator {
    font-size: 0.75rem;
    color: var(--muted-foreground);
    /* text-muted-foreground/30 */
}

.listTime {
    font-size: 0.75rem;
    color: var(--muted-foreground);
}

.listTimeWrapper {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.75rem;
    color: var(--muted-foreground);
}

/* â”€â”€â”€ List Comment Stats â”€â”€â”€ */
.listCommentStats {
    display: flex;
    align-items: baseline;
    gap: 4px;
}

.listCommentCount {
    font-size: 1.25rem;
    /* text-xl */
    font-weight: 700;
    color: var(--foreground);
    font-variant-numeric: tabular-nums;
    line-height: 1;
}

.listCommentLabel {
    font-size: 0.75rem;
    /* text-xs */
    font-weight: 400;
    color: var(--muted-foreground);
}

/* â”€â”€â”€ Mobile Responsive â”€â”€â”€ */
@media (max-width: 768px) {
    .horizontal {
        width: 260px;
        height: 120px;
        padding: 14px;
        box-shadow:
            0 2px 4px rgba(0, 0, 0, 0.04),
            0 1px 2px rgba(0, 0, 0, 0.02);
    }

    .card {
        padding: 14px;
    }

    .title {
        font-size: 0.9rem;
    }

    .listTitle {
        font-size: 0.95rem;
    }

    .listItem {
        padding: 16px 20px;
    }
}

================
File: src/components/ThreadList.module.css
================
.container {
    width: 100%;
}

.header {
    font-size: 1.25rem;
    font-weight: 800;
    margin-bottom: 1.5rem;
    display: none;
    /* Hidden as per new design implication or keep if needed? Let's hide if we want fully flat look */
}

/* Force header to be hidden if we strictly follow "listing" style, 
   but user might still want it. Let's keep existing header but maybe style it down?
   Actually user just showed the item. Let's leave header alone for now or hide if it clashes.
   The mock image only showed the card. */

.list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.item {
    border: 1px solid rgba(var(--border-rgb), 0.1);
    border-radius: 12px;
    background: rgba(var(--card-rgb), 0.5);
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
    overflow: hidden;
}

.item:hover {
    background: rgba(var(--card-rgb), 0.8);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    border-color: rgba(var(--accent-rgb), 0.3);
}

.link {
    display: flex;
    flex-direction: column;
    padding: 1.25rem;
    text-decoration: none;
    color: inherit;
    gap: 0.75rem;
}

.title {
    font-size: 1.1rem;
    font-weight: 700;
    margin: 0;
    line-height: 1.4;
    color: rgb(var(--foreground-rgb));
}

.metaRow {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 0.85rem;
    color: var(--muted-foreground);
    flex-wrap: wrap;
    /* Handle mobile */
    gap: 0.5rem;
}

.metaLeft {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
}

.metaRight {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--muted-foreground);
}

.boardName {
    background: rgba(var(--foreground-rgb), 0.05);
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-weight: 500;
    font-size: 0.8rem;
    color: rgb(var(--foreground-rgb));
}

.tags {
    display: flex;
    gap: 0.5rem;
}

.tag {
    color: var(--muted-foreground);
    font-weight: 400;
}

.separator {
    width: 3px;
    height: 3px;
    border-radius: 50%;
    background: currentColor;
    opacity: 0.5;
}

.iconItem {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.commentCount {
    font-weight: 700;
    color: rgb(var(--foreground-rgb));
}

.commentLabel {
    font-size: 0.8rem;
    font-weight: 400;
}

.empty {
    text-align: center;
    padding: 3rem;
    color: var(--muted-foreground);
    background: rgba(var(--card-rgb), 0.3);
    border-radius: 12px;
    border: 1px dashed rgba(var(--border-rgb), 0.2);
}

/* Mobile adjustments */
@media (max-width: 640px) {
    .metaRow {
        align-items: flex-start;
        flex-direction: column;
        gap: 0.75rem;
    }

    .metaRight {
        align-self: flex-end;
    }
}

================
File: src/components/ThreadList.tsx
================
import Link from 'next/link';
import { Thread, MOCK_BOARDS } from '@/data/mockBBS';
import styles from './ThreadList.module.css';
import { Clock, Eye, MessageCircle } from 'lucide-react';

interface ThreadListProps {
    threads: Thread[];
    boardId: string;
}

function getRelativeTime(dateString: string): string {
    const now = new Date();
    const past = new Date(dateString);
    const diffMs = now.getTime() - past.getTime();

    // Convert to seconds
    const diffSec = Math.floor(diffMs / 1000);
    if (diffSec < 60) return `${diffSec}ç§’å‰`;

    const diffMin = Math.floor(diffSec / 60);
    if (diffMin < 60) return `${diffMin}åˆ†å‰`;

    const diffHour = Math.floor(diffMin / 60);
    if (diffHour < 24) return `${diffHour}æ™‚é–“å‰`;

    const diffDay = Math.floor(diffHour / 24);
    if (diffDay < 7) return `${diffDay}æ—¥å‰`;

    return past.toLocaleDateString('ja-JP');
}

export default function ThreadList({ threads, boardId }: ThreadListProps) {
    // Find board name for the badge
    const boardName = MOCK_BOARDS.find(b => b.id === boardId)?.name.split(' ')[0] || 'ä¸€èˆ¬';

    return (
        <div className={styles.container}>
            {threads.length === 0 ? (
                <p className={styles.empty}>ã‚¹ãƒ¬ãƒƒãƒ‰ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            ) : (
                <ul className={styles.list}>
                    {threads.map((thread) => (
                        <li key={thread.id} className={styles.item}>
                            <Link href={`/${boardId}/${thread.id}`} className={styles.link}>
                                {/* Row 1: Title */}
                                <h3 className={styles.title}>{thread.title}</h3>

                                {/* Row 2: Metadata */}
                                <div className={styles.metaRow}>
                                    <div className={styles.metaLeft}>
                                        <span className={styles.boardName}>{boardName}</span>

                                        {thread.tags && thread.tags.length > 0 && (
                                            <div className={styles.tags}>
                                                {thread.tags.map(tag => (
                                                    <span key={tag} className={styles.tag}>#{tag}</span>
                                                ))}
                                            </div>
                                        )}

                                        <div className={styles.separator} />

                                        <div className={styles.iconItem}>
                                            <Clock size={14} />
                                            <span>{getRelativeTime(thread.lastUpdated)}</span>
                                        </div>

                                        <div className={styles.iconItem}>
                                            <Eye size={14} />
                                            <span>{thread.views || 0}</span>
                                        </div>
                                    </div>

                                    <div className={styles.metaRight}>
                                        <MessageCircle size={16} />
                                        <span className={styles.commentCount}>{thread.postCount}</span>
                                        <span className={styles.commentLabel}>ã‚³ãƒ¡ãƒ³ãƒˆ</span>
                                    </div>
                                </div>
                            </Link>
                        </li>
                    ))}
                </ul>
            )}
        </div>
    );
}

================
File: src/components/ThreadSummarizer.module.css
================
.container {
    background: var(--color-bg-base);
    border: 1px solid var(--color-border);
    border-radius: 0;
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    box-shadow: none;
}

.header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
}

.title {
    font-size: 1rem;
    color: var(--color-text-primary);
    font-weight: bold;
    margin: 0;
}

.description {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-md);
    line-height: 1.5;
}

.button {
    background: var(--color-text-primary);
    color: var(--color-bg-base);
    border: none;
    padding: 8px 16px;
    border-radius: var(--radius-full);
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s, transform 0.1s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.button:hover {
    background: var(--color-text-secondary);
    transform: none;
}

.loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--spacing-md);
    color: var(--color-text-secondary);
    font-size: 0.9rem;
}

.spinner {
    width: 24px;
    height: 24px;
    border: 2px solid var(--color-border);
    border-top: 2px solid var(--color-text-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: var(--spacing-sm);
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }

    100% {
        transform: rotate(360deg);
    }
}

.result {
    animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(5px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.summaryList {
    list-style: none;
    padding: 0;
    margin: 0;
}

.summaryItem {
    background: var(--color-bg-surface);
    padding: 8px 12px;
    border-radius: 0;
    margin-bottom: 8px;
    font-size: 0.95rem;
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
    border-left: 4px solid var(--color-text-primary);
}

.meta {
    text-align: right;
    font-size: 0.75rem;
    color: var(--color-text-muted);
    margin-top: var(--spacing-sm);
}

.closeButton {
    background: transparent;
    color: var(--color-text-secondary);
    border: 1px solid var(--color-border);
    padding: 4px 12px;
    font-size: 0.8rem;
    cursor: pointer;
    margin-top: var(--spacing-sm);
    display: block;
    margin-left: auto;
}

.closeButton:hover {
    background: var(--color-bg-surface);
    color: var(--color-text-primary);
}

.postCountBadge {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    background: var(--color-bg-surface);
    border: 1px solid var(--color-border);
    padding: 2px 8px;
    border-radius: var(--radius-full);
}

.actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: var(--spacing-sm);
}

.refreshButton {
    background: transparent;
    color: var(--color-text-secondary);
    border: 1px solid var(--color-border);
    padding: 4px 12px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: background 0.2s;
}

.refreshButton:hover {
    background: var(--color-bg-surface);
    color: var(--color-text-primary);
}

.refreshButton:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.errorText {
    font-size: 0.9rem;
    color: #e74c3c;
    margin-bottom: var(--spacing-md);
}

================
File: src/lib/auth.ts
================
import { NextAuthOptions } from "next-auth";
import GitHubProvider from "next-auth/providers/github";

export const authOptions: NextAuthOptions = {
    providers: [
        GitHubProvider({
            clientId: process.env.GITHUB_ID || "",
            clientSecret: process.env.GITHUB_SECRET || "",
        }),
    ],
    callbacks: {
        async signIn({ user }) {
            const adminEmail = process.env.ADMIN_EMAIL || "genkikun0513@gmail.com";
            if (user.email === adminEmail) {
                return true;
            }
            return false;
        },
    },
    pages: {
        signIn: '/auth/signin',
        error: '/auth/error',
    },
    secret: process.env.NEXTAUTH_SECRET,
};

================
File: src/lib/prisma.ts
================
import { PrismaClient } from '@prisma/client'

const prismaClientSingleton = () => {
    return new PrismaClient()
}

type PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>

const globalForPrisma = globalThis as unknown as {
    prisma: PrismaClientSingleton | undefined
}

const prisma = globalForPrisma.prisma ?? prismaClientSingleton()

export default prisma

if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma

================
File: src/lib/rate-limit.ts
================
import prisma from './prisma';

/**
 * Check and record a rate limit hit in the database.
 * 
 * @param key Unique key for the rate limit (e.g. "post:hashed_ip")
 * @param limit Maximum number of hits allowed in the window
 * @param windowMs Time window in milliseconds
 * @returns {Promise<boolean>} True if allowed, false if rate limited
 */
export async function checkRateLimit(key: string, limit: number, windowMs: number): Promise<boolean> {
    const now = new Date();
    const windowStart = new Date(now.getTime() - windowMs);

    // Find the record
    const record = await prisma.rateLimit.findUnique({
        where: { key }
    });

    if (!record) {
        // First hit
        await prisma.rateLimit.create({
            data: {
                key,
                count: 1,
                lastHit: now
            }
        });
        return true;
    }

    // Check if window has expired since last hit
    if (record.lastHit < windowStart) {
        // Reset window
        await prisma.rateLimit.update({
            where: { key },
            data: {
                count: 1,
                lastHit: now
            }
        });
        return true;
    }

    // Still in window, check count
    if (record.count >= limit) {
        return false;
    }

    // Increment count
    await prisma.rateLimit.update({
        where: { key },
        data: {
            count: record.count + 1,
            lastHit: now
        }
    });

    return true;
}

================
File: src/utils/time.ts
================
export function getRelativeTime(dateString: string): string {
    const now = new Date();
    const past = new Date(dateString);
    const diffMs = now.getTime() - past.getTime();

    // Convert to seconds
    const diffSec = Math.floor(diffMs / 1000);
    if (diffSec < 60) return `${diffSec}ç§’å‰`;

    const diffMin = Math.floor(diffSec / 60);
    if (diffMin < 60) return `${diffMin}åˆ†å‰`;

    const diffHour = Math.floor(diffMin / 60);
    if (diffHour < 24) return `${diffHour}æ™‚é–“å‰`;

    const diffDay = Math.floor(diffHour / 24);
    if (diffDay === 1) return 'æ˜¨æ—¥';
    if (diffDay < 7) return `${diffDay}æ—¥å‰`;

    // M/D format for > 7 days
    return `${past.getMonth() + 1}/${past.getDate()}`;
}

================
File: check-prisma-models.js
================
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();

async function main() {
    console.log('Prisma Models:', Object.keys(prisma).filter(k => !k.startsWith('_') && !k.startsWith('$')));
    await prisma.$disconnect();
}

main();

================
File: CLAUDE.md
================
# NWWW - The New World Wide Web (Beta) Development Context

## Project Overview
This is a modern BBS application inspired by 2ch, but designed as a "Knowledge Crossroads" for the AI era.
It features anonymous posting, thread-based discussions, and AI-powered features.

## Tech Stack
- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript
- **Database**: SQLite (via Prisma)
- **Styling**: Vanilla CSS (CSS Modules) - No Tailwind.
- **Icons**: Lucide React

## Design System
- **Colors**: Defined in `src/app/globals.css` (CSS Variables).
  - `--background`, `--foreground`: Base colors (Theme-aware).
  - `--accent`: Subtle gray/hover.
  - `--primary`: #0f172a (Slate).
- **Fonts**: Inter (Google Fonts).
- **Aesthetic**: Minimalist, News-site style (e.g., Quartz, Wired). High contrast, ample whitespace.

## Core Features Implemented
1.  **AI Thread Generation (Beta)**:
    - URL-based thread creation (`/api/thread/generate`).
    - Uses Gemini API to fetch content, sumamrize, select a Board, and generate an initial post.
    - Unified UI on Top Page and Board Page (Modal + Pill Button).

2.  **Thread Recommendations**:
    - **PICK UP**: Momentum algorithm (`postCount / hoursElapsed`).
    - **Discover**: History-based affinity (`localStorage`).

3.  **Components**:
    - `TopSparkCTA`: The main AI generator CTA (Top Page).
    - `NewThreadForm`: Board-specific thread creation (Manual + AI).
    - `ThreadInteractiveView`: Thread display with anonymous posting.

## Development Rules
- **CSS**: Use CSS Modules (`*.module.css`). Do NOT use inline styles unless dynamic.
- **Server Actions**: Use `src/app/actions.ts` for form handling.
- **Data Fetching**: Use `sys/data/db-actions.ts` (Prisma calls).
- **Prisma**: Run `npx prisma db push` after schema changes.

## Current Tasks
- [x] Top Page AI Generator (Done)
- [x] Recommendation Algorithms (Done)
- [ ] Implement Search functionality (Pending)
- [ ] Implement Tag system (Pending)

## Commands
- **Dev Server**: `npm run dev`
- **Lint**: `npm run lint`
- **Build**: `npm run build`

================
File: eslint.config.mjs
================
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;

================
File: README.md
================
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

================
File: test-debug.ts
================
import { checkRateLimit } from './src/lib/rate-limit';

async function test() {
    try {
        console.log("Checking rate limit for 'test-key'...");
        const result1 = await checkRateLimit("test-key", 1, 5000);
        console.log("Result 1 (expect true):", result1);

        const result2 = await checkRateLimit("test-key", 1, 5000);
        console.log("Result 2 (expect false):", result2);
    } catch (error) {
        console.error("Error during rate limit check:", error);
    }
}

test();

================
File: tsconfig.json
================
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}

================
File: prisma/schema.prisma
================
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Board {
  id          String   @id
  name        String
  description String
  category    String
  status      String   @default("active") // 'active' | 'locked'
  threads     Thread[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Thread {
  id            String   @id @default(cuid())
  title         String
  
  // Metadata & Stats
  views         Int      @default(0)
  postCount     Int      @default(0) // Denormalized count for performance
  momentum      Int      @default(0)
  status        String   @default("active") // 'active' | 'archived'
  lastUpdated   DateTime @default(now())

  // AI Generation & Source Tracking
  isAiGenerated Boolean  @default(false)
  sourceUrl     String?  // URL of the news/tweet
  sourceTitle   String?  // Original title of the source
  sourcePlatform String? // 'twitter', 'news', 'youtube', etc.
  aiAnalysis    String?  // Summary or analysis by AI

  // Tags (Stored as JSON in PostgreSQL)
  tags          Json     @default("[]") 

  // Relations
  boardId       String
  board         Board    @relation(fields: [boardId], references: [id])
  posts         Post[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Post {
  id            String   @id @default(cuid())
  
  content       String
  author        String   @default("åç„¡ã—ã•ã‚“")
  
  // User & AI Metadata
  userId        String?  // Hashed IP or user ID
  tripcode      String?  // For tripcode feature
  isAiGenerated Boolean  @default(false)
  likes         Int      @default(0)
  status        String   @default("active") // 'active' | 'deleted'

  // Relations
  threadId      String
  thread        Thread   @relation(fields: [threadId], references: [id])
  reports       Report[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Report {
  id            String   @id @default(cuid())
  reason        String   // 'spam', 'abuse', 'illegal', 'other'
  detail        String?  // Optional detail text
  reporterIp    String?  // IP of reporter (hashed)
  status        String   @default("pending") // 'pending' | 'resolved' | 'dismissed'

  // Relations
  postId        String
  post          Post     @relation(fields: [postId], references: [id])

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model RateLimit {
  key       String   @id // e.g. "post:hashed_ip" or "thread:hashed_ip"
  count     Int      @default(0)
  lastHit   DateTime @default(now())
}

================
File: prisma/seed.ts
================
import 'dotenv/config'
import { PrismaClient } from '@prisma/client'
import { MOCK_BOARDS } from '../src/data/mockBBS'

const prisma = new PrismaClient()

async function main() {
    console.log('Start seeding ...')

    for (const board of MOCK_BOARDS) {
        console.log(`Creating board: ${board.name}`)

        // Initial active boards
        const INITIAL_ACTIVE_BOARDS = ['news-global', 'lounge-chat', 'hobby-pc'];
        const status = INITIAL_ACTIVE_BOARDS.includes(board.id) ? 'active' : 'locked';

        // Create Board
        await prisma.board.upsert({
            where: { id: board.id },
            update: { status },
            create: {
                id: board.id,
                name: board.name,
                description: board.description,
                category: board.category,
                status: status,
            },
        })

        // Create Threads
        for (const thread of board.threads) {
            console.log(`  Creating thread: ${thread.title}`)

            const createdThread = await prisma.thread.upsert({
                where: { id: thread.id },
                update: {},
                create: {
                    id: thread.id,
                    title: thread.title,
                    views: thread.views,
                    postCount: thread.postCount,
                    momentum: thread.momentum,
                    status: thread.status,
                    lastUpdated: new Date(thread.lastUpdated),
                    createdAt: new Date(thread.createdAt),
                    tags: thread.tags,
                    // AI fields default to false/null
                    boardId: board.id,
                }
            })

            // Create Posts
            // Check if post exists to avoid error on re-run (or just ignore unique constraint error)
            for (const post of thread.posts) {
                const existingPost = await prisma.post.findUnique({
                    where: { id: post.id }
                })

                if (!existingPost) {
                    await prisma.post.create({
                        data: {
                            id: post.id,
                            content: post.content,
                            author: post.author,
                            userId: post.userId,
                            likes: post.likes,
                            createdAt: new Date(post.createdAt),
                            threadId: createdThread.id,
                        }
                    })
                }
            }
        }
    }

    console.log('Seeding finished.')
}

main()
    .then(async () => {
        await prisma.$disconnect()
    })
    .catch(async (e) => {
        console.error(e)
        await prisma.$disconnect()
        process.exit(1)
    })

================
File: src/app/api/auth/[...nextauth]/route.ts
================
import NextAuth from "next-auth";
import { authOptions } from "@/lib/auth";

const handler = NextAuth(authOptions);

export { handler as GET, handler as POST };

================
File: src/app/auth/signin/page.module.css
================
/* Global Container: Deep ambient background */
.container {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    background-color: #050505;
    background-image:
        radial-gradient(circle at 50% 0%, #1a1c29 0%, transparent 70%),
        radial-gradient(circle at 85% 30%, rgba(40, 45, 70, 0.2) 0%, transparent 50%),
        radial-gradient(circle at 15% 70%, rgba(30, 30, 40, 0.2) 0%, transparent 50%);
    background-attachment: fixed;
    /* Parallax-like feel */
    color: #fff;
    font-family: var(--font-sans, sans-serif);
    overflow: hidden;
    position: relative;
}

/* Subtle grid overlay for texture */
.container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image:
        linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
    background-size: 40px 40px;
    opacity: 0.3;
    pointer-events: none;
    z-index: 1;
}

/* Glass Card */
.card {
    position: relative;
    z-index: 2;
    width: 100%;
    max-width: 420px;
    padding: 3.5rem 2.5rem;

    background: rgba(20, 20, 30, 0.6);
    /* Slightly darker base for better contrast */
    backdrop-filter: blur(24px) saturate(180%);
    -webkit-backdrop-filter: blur(24px) saturate(180%);

    border: 1px solid rgba(255, 255, 255, 0.08);
    border-top: 1px solid rgba(255, 255, 255, 0.15);
    /* Top highlight */
    border-radius: 1.5rem;

    box-shadow:
        0 0 0 1px rgba(0, 0, 0, 0.2),
        /* Inner shadow */
        0 20px 40px -10px rgba(0, 0, 0, 0.6),
        /* Deep shadow */
        0 0 80px rgba(0, 0, 0, 0.3);
    /* Ambient glow */

    text-align: center;
    transform: translateY(20px);
    opacity: 0;
    animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

/* Entrance Animation */
@keyframes fadeInUp {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Header Area */
.header {
    margin-bottom: 2.5rem;
}

.logo {
    font-family: var(--font-mono, monospace);
    font-size: 0.8rem;
    letter-spacing: 0.2em;
    color: rgba(255, 255, 255, 0.4);
    margin-bottom: 1.5rem;
    text-transform: uppercase;
    position: relative;
    display: inline-block;
}

.logo::after {
    content: '';
    display: block;
    width: 40px;
    height: 1px;
    background: rgba(255, 255, 255, 0.1);
    margin: 0.5rem auto 0;
}

.title {
    font-size: 1.75rem;
    font-weight: 800;
    /* Extra Bold */
    margin-bottom: 0.75rem;
    letter-spacing: -0.03em;
    line-height: 1.2;

    /* Gradient Text */
    background: linear-gradient(135deg, #ffffff 0%, #a0a0b0 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 2px 10px rgba(255, 255, 255, 0.1);
}

.description {
    font-size: 0.9rem;
    line-height: 1.6;
    color: rgba(255, 255, 255, 0.6);
    font-weight: 400;
}

/* Interaction Area */
.content {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

/* GitHub Login Button */
.githubButton {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    width: 100%;
    padding: 1rem;

    background-color: #fff;
    color: #000;

    border: none;
    border-radius: 0.75rem;

    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);

    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

/* Button Glow Effect on Hover */
.githubButton::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, rgba(255, 255, 255, 0) 40%, rgba(255, 255, 255, 0.4) 50%, rgba(255, 255, 255, 0) 60%);
    transform: translateX(-100%);
    transition: transform 0.6s ease;
}

.githubButton:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 12px 24px -6px rgba(255, 255, 255, 0.25);
    background-color: #f8f9fa;
}

.githubButton:hover::before {
    transform: translateX(100%);
}

.githubButton:active {
    transform: translateY(0) scale(0.98);
}

.githubButton:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
}

/* Spinner */
.spinner {
    width: 20px;
    height: 20px;
    border: 2px solid rgba(0, 0, 0, 0.1);
    border-left-color: #000;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* Note Text */
.note {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.3);
    margin-top: 1rem;
    transition: color 0.2s ease;
}

.card:hover .note {
    color: rgba(255, 255, 255, 0.5);
}

================
File: src/app/search/page.module.css
================
.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 1rem;
}

.header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid rgba(var(--border-rgb), 0.1);
    margin-bottom: 1.5rem;
}

.backButton {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    background: var(--accent);
    color: var(--foreground);
    text-decoration: none;
    transition: background 0.2s;
}

.backButton:hover {
    background: var(--muted);
}

.title {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* Search Form */
.searchForm {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.searchInputWrapper {
    flex: 1;
    position: relative;
    display: flex;
    align-items: center;
}

.searchIcon {
    position: absolute;
    left: 0.75rem;
    color: var(--muted-foreground);
    pointer-events: none;
}

.searchInput {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.5rem;
    background: var(--background);
    border: 1px solid rgba(var(--border-rgb), 0.2);
    border-radius: 0.5rem;
    font-size: 0.95rem;
    color: var(--foreground);
    font-family: inherit;
    transition: border-color 0.2s;
}

.searchInput:focus {
    outline: none;
    border-color: var(--foreground);
    box-shadow: 0 0 0 2px rgba(var(--ring-rgb), 0.1);
}

.searchButton {
    padding: 0.75rem 1.5rem;
    background: var(--foreground);
    color: var(--background);
    border: none;
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
    font-family: inherit;
    transition: opacity 0.2s;
}

.searchButton:hover {
    opacity: 0.9;
}

/* Results */
.results {
    padding-bottom: 2rem;
}

.resultCount {
    font-size: 0.85rem;
    color: var(--muted-foreground);
    margin-bottom: 1rem;
}

.empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    padding: 6rem 1rem;
    background: var(--card);
    border-radius: 1rem;
    border: 1px solid rgba(var(--border-rgb), 0.1);
    text-align: center;
}

.emptyText {
    font-size: 1rem;
    color: var(--muted-foreground);
    line-height: 1.6;
}

.recommendations {
    margin-top: 1rem;
    font-size: 0.85rem;
    color: var(--muted-foreground);
}

.recommendationList {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 0.75rem;
    list-style: none;
    padding: 0;
}

.recommendationItem {
    padding: 0.25rem 0.75rem;
    background: var(--accent);
    border-radius: 9999px;
    color: var(--foreground);
    text-decoration: none;
    transition: opacity 0.2s;
}

.recommendationItem:hover {
    opacity: 0.8;
}

.threadList {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.cardLink {
    text-decoration: none;
    color: inherit;
}

.threadCard {
    padding: 1rem;
    border-radius: 0.5rem;
    border: 1px solid rgba(var(--border-rgb), 0.1);
    background: var(--card);
    transition: box-shadow 0.2s;
}

.threadCard:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.cardHeader {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.5rem;
}

.boardBadge {
    font-size: 0.7rem;
    padding: 0.15rem 0.5rem;
    border-radius: 9999px;
    background: var(--accent);
    color: var(--muted-foreground);
    white-space: nowrap;
    flex-shrink: 0;
}

.threadTitle {
    font-size: 0.95rem;
    font-weight: 600;
    margin: 0;
    line-height: 1.4;
}

.cardFooter {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
}

.timestamp {
    font-size: 0.75rem;
    color: var(--muted-foreground);
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.stats {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.statItem {
    font-size: 0.75rem;
    color: var(--muted-foreground);
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

================
File: src/app/search/page.tsx
================
import { Metadata } from 'next';
import Link from 'next/link';
import { searchThreads } from '@/data/db-actions';
import { ArrowLeft, Search, Clock, Eye, MessageCircle } from 'lucide-react';
import styles from './page.module.css';

interface PageProps {
    searchParams: Promise<{
        q?: string;
        board?: string;
    }>;
}

export async function generateMetadata({ searchParams }: PageProps): Promise<Metadata> {
    const { q } = await searchParams;
    const query = q?.trim() || '';

    if (!query) {
        return {
            title: 'æ¤œç´¢',
        };
    }

    return {
        title: `æ¤œç´¢: ${query}`,
        description: `NWWW ã§ã®ã€Œ${query}ã€ã®æ¤œç´¢çµæœã€‚`,
    };
}

export default async function SearchPage({ searchParams }: PageProps) {
    const { q, board } = await searchParams;
    const query = q?.trim() || '';
    const results = query ? await searchThreads(query, board) : [];

    return (
        <div className={styles.container}>
            <header className={styles.header}>
                <Link href="/" className={styles.backButton}>
                    <ArrowLeft size={16} />
                </Link>
                <h1 className={styles.title}>
                    <Search size={18} />
                    æ¤œç´¢çµæœ
                </h1>
            </header>

            {/* Search Form */}
            <form action="/search" method="get" className={styles.searchForm}>
                <div className={styles.searchInputWrapper}>
                    <Search size={16} className={styles.searchIcon} />
                    <input
                        type="text"
                        name="q"
                        defaultValue={query}
                        placeholder="ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ãƒ»æœ¬æ–‡ã‚’æ¤œç´¢..."
                        className={styles.searchInput}
                        autoFocus
                    />
                </div>
                <button type="submit" className={styles.searchButton}>æ¤œç´¢</button>
            </form>

            {/* Results */}
            <main className={styles.results}>
                {query && (
                    <p className={styles.resultCount}>
                        ã€Œ<strong>{query}</strong>ã€ã®æ¤œç´¢çµæœ: {results.length}ä»¶
                    </p>
                )}

                {query && results.length === 0 && (
                    <div className={styles.empty}>
                        <Search size={64} strokeWidth={1} style={{ opacity: 0.2 }} />
                        <div className={styles.emptyText}>
                            <p>ã€Œ<strong>{query}</strong>ã€ã«é–¢ã™ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
                            <div className={styles.recommendations}>
                                <p>ä»–ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§è©¦ã—ã¦ã¿ã‚‹ã‹ã€ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã§è©±é¡Œã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã€‚</p>
                                <ul className={styles.recommendationList}>
                                    <li><Link href="/" className={styles.recommendationItem}>ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</Link></li>
                                    <li><Link href="/search?q=ãƒ‹ãƒ¥ãƒ¼ã‚¹" className={styles.recommendationItem}>ãƒ‹ãƒ¥ãƒ¼ã‚¹</Link></li>
                                    <li><Link href="/search?q=é›‘è«‡" className={styles.recommendationItem}>é›‘è«‡</Link></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                )}

                <div className={styles.threadList}>
                    {results.map((thread: any) => (
                        <Link
                            href={`/${thread.boardId}/${thread.id}`}
                            key={thread.id}
                            className={styles.cardLink}
                        >
                            <article className={styles.threadCard}>
                                <div className={styles.cardHeader}>
                                    <span className={styles.boardBadge}>{thread.boardName}</span>
                                    <h3 className={styles.threadTitle}>{thread.title}</h3>
                                </div>
                                <div className={styles.cardFooter}>
                                    <span className={styles.timestamp}>
                                        <Clock size={14} />
                                        {new Date(thread.lastUpdated).toLocaleString('en-US', { hour12: true })}
                                    </span>
                                    <div className={styles.stats}>
                                        <span className={styles.statItem}>
                                            <Eye size={14} />
                                            {thread.views}
                                        </span>
                                        <span className={styles.statItem}>
                                            <MessageCircle size={14} />
                                            {thread.postCount}
                                        </span>
                                    </div>
                                </div>
                            </article>
                        </Link>
                    ))}
                </div>
            </main>
        </div>
    );
}

================
File: src/app/globals.css
================
:root {
  /* --- Typography --- */
  --font-sans: "Inter", "Noto Sans JP", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --font-mono: "Fira Code", "Menlo", "Monaco", "Consolas", monospace;

  /* --- Spacing --- */
  --spacing-xs: 0.25rem;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 2rem;
  --spacing-xl: 4rem;

  /* --- Border Radius (Rounded) --- */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-full: 9999px;

  /* --- Soft Light Theme (Reference Match) --- */
  --color-bg-base: #f8f9fa;
  /* Very Light Gray (App Background) */
  --color-bg-surface: #ffffff;
  /* Pure White (Card Background) */
  --color-bg-sidebar: #ffffff;
  /* White Sidebar */

  --color-text-primary: #1a1a1a;
  /* Almost Black */
  --color-text-secondary: #5e6c84;
  /* Cool Gray */
  --color-text-muted: #8993a4;
  /* Lighter Gray */

  --color-border: #eaecf0;
  /* Very subtle border */
  --color-divider: #f2f4f7;

  --color-accent: #1a1a1a;
  /* Black Accent */
  --color-accent-hover: #333333;

  --color-fire: #1a1a1a;
  --color-fire-bg: #f2f4f7;

  /* --- New Design Spec (Strict) --- */
  --background: #ffffff;
  --foreground: #0f172a;
  /* Slate 900 approx for oklch(0.145 0 0) */
  --card: #ffffff;
  --muted: #f1f5f9;
  /* Slate 100 */
  --muted-foreground: #64748b;
  /* Slate 500 */
  --accent: #f8fafc;
  /* Slate 50 */
  --accent-foreground: #0f172a;
  --border: #e2e8f0;
  /* Slate 200 */
  --input: #e2e8f0;
  --ring: #94a3b8;
  /* Slate 400 */

  /* Sidebar Spec */
  --sidebar-bg: rgba(255, 255, 255, 0.7);
  --sidebar-border: rgba(0, 0, 0, 0.06);
  --sidebar-accent: rgba(233, 235, 239, 0.5);
  --sidebar-foreground: #252525;
  --muted-foreground: #717182;
  --sidebar-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);

  /* Utilities for backdrop blur if not using Tailwind utilities */
  --backdrop-blur-md: blur(12px);
}

/* --- Dark Mode --- */
[data-theme="dark"] {
  --color-bg-base: #0f1117;
  --color-bg-surface: #1a1d27;
  --color-bg-sidebar: #13151d;

  --color-text-primary: #e4e6eb;
  --color-text-secondary: #9ca3b4;
  --color-text-muted: #6b7280;

  --color-border: #2a2d3a;
  --color-divider: #1f222e;

  --color-accent: #e4e6eb;
  --color-accent-hover: #c8cbd2;

  --color-fire: #e4e6eb;
  --color-fire-bg: #1f222e;

  --background: #0f1117;
  --foreground: #e4e6eb;
  --card: #1a1d27;
  --muted: #1f222e;
  --muted-foreground: #8b92a5;
  --accent: #252836;
  --accent-foreground: #e4e6eb;
  --border: #2a2d3a;
  --input: #2a2d3a;
  --ring: #4a5068;

  --sidebar-bg: rgba(19, 21, 29, 0.85);
  --sidebar-border: rgba(255, 255, 255, 0.06);
  --sidebar-accent: rgba(42, 45, 58, 0.6);
  --sidebar-foreground: #d1d5db;
  --muted-foreground: #8b92a5;
  --sidebar-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
  min-height: 100%;
}

body {
  font-family: var(--font-sans);
  background: var(--color-bg-base);
  color: var(--color-text-primary);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  color: inherit;
  text-decoration: none;
  transition: color 0.2s;
}

a:hover {
  color: var(--color-accent);
}

/* Utility to hide scrollbar but allow scrolling */
.no-scrollbar::-webkit-scrollbar {
  display: none;
}

.no-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

================
File: src/app/layout.module.css
================
.container {
    height: 100vh;
    display: flex;
    flex-direction: column;
    background-color: var(--color-bg-base);
    overflow: hidden;
    /* Disable generic window scroll */
}

/* Removed Header Styles */

/* Sidebar Logo */
.sidebarLogo {
    padding: 24px;
    /* border-bottom removed */
    display: flex;
    align-items: center;
    justify-content: flex-start;
    flex-shrink: 0;
    transition: opacity 0.2s;
}

.sidebarLogo:hover {
    opacity: 0.8;
}

.logo {
    display: block;
    width: 112px;
    /* Fixed width for logo */
}

/* Logo theme switching */
.logoLight {
    display: block;
}

.logoDark {
    display: none;
}

:global([data-theme="dark"]) .logoLight {
    display: none;
}

:global([data-theme="dark"]) .logoDark {
    display: block;
}

/* Sidebar Navigation Scroll Area */
.sidebarNav {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 32px;
    /* Space between sections */

    /* Scrollbar styling */
    scrollbar-width: thin;
    scrollbar-color: var(--sidebar-border) transparent;
}

.sidebarNav::-webkit-scrollbar {
    width: 4px;
}

.sidebarNav::-webkit-scrollbar-track {
    background: transparent;
}

.sidebarNav::-webkit-scrollbar-thumb {
    background-color: var(--sidebar-border);
    border-radius: 4px;
}


/* Top Bar (Search Container) */
.topBar {
    position: sticky;
    top: 0;
    z-index: 50;
    display: flex;
    justify-content: flex-end;
    align-items: center;
    padding: 24px 32px;
    gap: 16px;
    pointer-events: none;
    /* Allow clicks through to content */
}

/* Search Wrapper - Positioning only */
.searchWrapper {
    position: relative;
    display: flex;
    align-items: center;
    pointer-events: auto;
    /* Enable clicks on search */
}

.searchIcon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted-foreground);
    z-index: 10;
    pointer-events: none;
    width: 16px;
    height: 16px;
}

.searchInput {
    width: 240px;
    /* 15% shorter than 280px */
    padding: 12px 16px 12px 36px;
    /* Increased padding for thicker pill */

    background-color: var(--accent);
    border: 1px solid var(--border);
    /* border/50 approx */
    border-radius: 9999px;
    /* Pill shape */

    font-size: 14px;
    color: var(--color-text-primary);

    transition: all 0.2s ease;
    outline: none;
}

.searchInput:focus {
    background-color: var(--card);
    border-color: var(--ring);
    box-shadow: 0 0 0 2px var(--accent);
}

/* Main Layout */
.main {
    flex: 1;
    width: 100%;
    margin: 0;
    padding: 0;
    display: grid;
    grid-template-columns: 280px 1fr;
    /* Fixed sidebar width */
    gap: 0;
    overflow: hidden;
    min-height: 0;
}


.sidebar {
    display: flex;
    flex-direction: column;
    gap: 0;
    width: 280px;
    height: 100vh;

    /* Visual Style */
    background-color: var(--sidebar-bg);
    backdrop-filter: blur(24px);
    border-right: 1px solid var(--sidebar-border);
    box-shadow: var(--sidebar-shadow);

    overflow: hidden;
    /* Scroll inside sidebarNav */
}

.sidebarFooter {
    padding: 24px;
    border-top: 1px solid var(--sidebar-border);
    display: flex;
    flex-direction: column;
    gap: 16px;
    justify-content: flex-start;
}

.legalLinks {
    display: flex;
    gap: 12px;
    font-size: 0.7rem;
    color: var(--color-text-muted);
}

.legalLink {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color 0.2s;
}

.legalLink:hover {
    color: var(--color-text-primary);
    text-decoration: underline;
}

.sidebar::-webkit-scrollbar {
    width: 4px;
}

.sidebar::-webkit-scrollbar-track {
    background: transparent;
}

.sidebar::-webkit-scrollbar-thumb {
    background-color: var(--color-border);
    border-radius: 4px;
}

.content {
    background-color: var(--background);
    width: 100%;
    height: 100%;
    overflow-y: auto;
    /* Independent scroll */
    position: relative;
}

.footer {
    /* Footer stays at bottom of text flow or pinned? 
       In this layout, footer is outside .main in layout.tsx.
       Since .main is flex:1, footer will be pushed to very bottom of screen.
    */
    text-align: center;
    padding: var(--spacing-md);
    color: var(--color-text-muted);
    font-size: 0.8rem;
    border-top: 1px solid var(--color-border);
    background: var(--color-bg-surface);
    flex-shrink: 0;
}

@media (max-width: 768px) {
    .container {
        padding-top: 56px;
        /* Space for fixed mobile header */
    }

    .main {
        grid-template-columns: 1fr;
        gap: 0;
    }

    .sidebar {
        display: none;
    }

    .topBar {
        display: none;
        /* Search is in mobile drawer */
    }
}

================
File: src/app/page.module.css
================
/* Main Container */
.main {
  min-height: 100vh;
  background-color: var(--background);
  padding-bottom: 4rem;
}



/* â”€â”€â”€ Section Common â”€â”€â”€ */
.section {
  padding: 64px 0;
  border-bottom: 1px solid var(--border);
}

.sectionLast {
  border-bottom: none;
}

.sectionHeader {
  padding: 0 32px;
  margin-bottom: 40px;
}

/* Section Title Typography */
.sectionTitle {
  font-family: var(--font-sans);
  font-size: 3rem;
  /* 48px */
  font-weight: 900;
  letter-spacing: -0.025em;
  line-height: 1;
  margin: 0;
  padding: 0;
  color: var(--foreground);
  display: flex;
  align-items: center;
  gap: 12px;
}

/* Fluorescent Green Dot Indicator */
.sectionTitle::before {
  content: '';
  display: inline-block;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background-color: #39FF14;
  flex-shrink: 0;
}

.sectionSub {
  font-size: 0.875rem;
  color: var(--muted-foreground);
  font-weight: 500;
  margin: 8px 0 0 0;
}

/* â”€â”€â”€ WHAT'S NEW (Horizontal Scroll) â”€â”€â”€ */
/* â”€â”€â”€ WHAT'S NEW (Horizontal Scroll) â”€â”€â”€ */
.whatsNewScroll {
  display: flex;
  overflow-x: auto;
  gap: 16px;
  /* Add padding top/bottom to avoid clipping hover effects */
  padding: 20px 32px 20px 32px;
  /* Negative margin to maintain vertical rhythm despite padding */
  margin-top: -20px;
  margin-bottom: -12px;

  scrollbar-width: none;
  -ms-overflow-style: none;
}

.whatsNewScroll::-webkit-scrollbar {
  display: none;
}

/* â”€â”€â”€ PICK UP Section â”€â”€â”€ */
.pickUpSection {
  background-color: var(--accent);
  /* bg-muted/30 */
}

.pickUpList {
  max-width: 80rem;
  /* max-w-7xl */
  margin: 0 auto;
  padding: 0 32px;
}

/* â”€â”€â”€ DISCOVER Section â”€â”€â”€ */
.discoverTitle {
  font-family: var(--font-noto), sans-serif;
  font-size: 1.875rem;
  /* 30px / text-3xl */
  font-weight: 900;
  letter-spacing: -0.025em;
  line-height: 1;
  margin: 0 0 0.75rem 0;
  /* mb-3 */
  color: var(--foreground);
}

.discoverList {
  max-width: 80rem;
  /* max-w-7xl */
  margin: 0 auto;
  padding: 0 32px;
}

/* â”€â”€â”€ Empty State â”€â”€â”€ */
.emptyState {
  padding: 0 32px;
  color: var(--muted-foreground);
  font-size: 0.875rem;
}

/* â”€â”€â”€ Mobile Responsive â”€â”€â”€ */
@media (max-width: 768px) {
  .section {
    padding: 40px 0;
  }

  .sectionHeader {
    padding: 0 24px;
    margin-bottom: 24px;
  }

  .sectionTitle {
    font-size: 1.75rem;
    gap: 8px;
  }

  .sectionTitle::before {
    width: 8px;
    height: 8px;
  }

  .whatsNewScroll {
    padding: 0 24px;
    gap: 12px;
  }

  .pickUpList {
    padding: 0 24px;
  }

  .discoverTitle {
    font-size: 1.25rem;
  }

  .discoverList {
    padding: 0 24px;
  }

  .emptyState {
    padding: 0 24px;
  }
}

================
File: src/app/spark-actions.ts
================
'use server';

import { createThread, getBoards } from '@/data/mockBBS';
import { revalidatePath } from 'next/cache';

import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";

export async function triggerScheduledSpark(boardId: string) {
    const session = await getServerSession(authOptions);
    if (!session) {
        throw new Error("Unauthorized");
    }

    // 1. Get the target board to understand context (mocking AI context understanding)
    const boards = await getBoards();
    const targetBoard = boards.find(b => b.id === boardId);

    // Defines potential topics per board category or specific board ID
    const topicPool: Record<string, { title: string; content: string }[]> = {
        'news-detective': [
            { title: "ã€è­°è«–ã€‘ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ã‚¤ãƒ³ã‚«ãƒ ã¯æ—¥æœ¬ã§å°å…¥å¯èƒ½ãªã®ã‹è­°è«–ã™ã‚‹ã‚¹ãƒ¬", content: "..." },
        ],
        // ... (keep usage of generic pools or create a large mapped pool)
        // For simplicity in this mock, we'll use a generic generator based on category if specific board not found
    };

    // Mock AI generating content based on Board Name/Category
    const categoryTopics: Record<string, { title: string; content: string }[]> = {
        'News & Disc.': [
            { title: "ã€æ™‚äº‹ã€‘ä»Šæœˆã®æ³¨ç›®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¾ã¨ã‚", content: "..." },
            { title: "ã€è­°è«–ã€‘å ±é“ã®è‡ªç”±ã¨SNSã®è¦åˆ¶", content: "..." },
            { title: "ã€èµ·æ¥­ã€‘AIã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã®ç”Ÿå­˜æˆ¦ç•¥ã«ã¤ã„ã¦", content: "..." }
        ],
        'Life & Advice': [
            { title: "ã€ç›¸è«‡ã€‘30ä»£ã‹ã‚‰ã®ã‚­ãƒ£ãƒªã‚¢ãƒã‚§ãƒ³ã‚¸", content: "..." },
            { title: "ã€ç”Ÿæ´»ã€‘ä¸€äººæš®ã‚‰ã—ã®ãƒ©ã‚¤ãƒ•ãƒãƒƒã‚¯å…±æœ‰ã—ã‚ˆã†ãœ", content: "..." },
            { title: "ã€åœ°åŸŸã€‘åœ°æ–¹ç§»ä½ã—ã¦è‰¯ã‹ã£ãŸã“ã¨ãƒ»æ‚ªã‹ã£ãŸã“ã¨", content: "..." }
        ],
        'Culture & Hobby': [
            { title: "ã€æ„Ÿæƒ³ã€‘ä»ŠæœŸã®ã‚¢ãƒ‹ãƒ¡ã€ã©ã‚Œè¦‹ã‚‹ï¼Ÿ", content: "..." },
            { title: "ã€æ˜ ç”»ã€‘ã©ã‚“ã§ã‚“è¿”ã—ãŒå‡„ã„æ˜ ç”»æ•™ãˆã¦", content: "..." },
            { title: "ã€YouTubeã€‘æœ€è¿‘ä¼¸ã³ã¦ã‚‹æ•™è‚²ç³»YouTuberæ•™ãˆã¦", content: "..." }
        ],
        'Science & Academia': [
            { title: "ã€å®‡å®™ã€‘ã‚¸ã‚§ã‚¤ãƒ ã‚ºãƒ»ã‚¦ã‚§ãƒƒãƒ–å®‡å®™æœ›é é¡ã®æ–°ç™ºè¦‹ã«ã¤ã„ã¦", content: "..." },
            { title: "ã€æ­´å²ã€‘ã‚‚ã—ã‚‚ã‚ã®æ™‚æ­´å²ãŒå‹•ã„ã¦ã„ãŸã‚‰", content: "..." }
        ],
        'Subculture & Mystery': [
            { title: "ã€ã‚ªã‚«ãƒ«ãƒˆã€‘æ¤œç´¢ã—ã¦ã¯ã„ã‘ãªã„è¨€è‘‰", content: "..." },
            { title: "ã€éƒ½å¸‚ä¼èª¬ã€‘AIã¯æ—¢ã«è‡ªæˆ‘ã‚’æŒã£ã¦ã„ã‚‹ï¼Ÿ", content: "..." }
        ]
    };

    const category = targetBoard?.category || 'General';
    const topics = categoryTopics[category] || [
        { title: "ã€é›‘è«‡ã€‘æœ€è¿‘ã®å‡ºæ¥äº‹ã«ã¤ã„ã¦èªã‚ã†", content: "..." }
    ];

    const randomTopic = topics[Math.floor(Math.random() * topics.length)];

    await createThread(
        boardId,
        `[AIææ¡ˆ] ${randomTopic.title}`,
        `${randomTopic.content || randomTopic.title}\n\n(This thread was automatically generated by AI Spark System ğŸ¤– on board: ${targetBoard?.name})`
    );

    revalidatePath(`/${boardId}`);
    return { success: true };
}

================
File: src/components/BoardStatusManager.tsx
================
'use client';

import { useState } from 'react';
import { toggleBoardStatusAction } from '@/app/actions';
import styles from './BoardStatusManager.module.css';

interface Board {
    id: string;
    name: string;
    status: string;
    category: string;
}

interface BoardStatusManagerProps {
    initialBoards: Board[];
}

export default function BoardStatusManager({ initialBoards }: BoardStatusManagerProps) {
    const [boards, setBoards] = useState(initialBoards);
    const [isUpdating, setIsUpdating] = useState<string | null>(null);

    const handleToggle = async (boardId: string, currentStatus: string) => {
        const nextStatus = currentStatus === 'active' ? 'locked' : 'active';

        setIsUpdating(boardId);
        const formData = new FormData();
        formData.append('boardId', boardId);
        formData.append('status', nextStatus);

        const result = await toggleBoardStatusAction(formData);

        if (result.success) {
            setBoards(boards.map(b => b.id === boardId ? { ...b, status: nextStatus } : b));
        } else {
            alert(result.message || 'æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
        setIsUpdating(null);
    };

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <h2>æ¿ã®å…¬é–‹ç®¡ç† ({boards.filter(b => b.status === 'active').length} / {boards.length} å…¬é–‹ä¸­)</h2>
            </div>
            <div className={styles.grid}>
                {boards.map(board => (
                    <div key={board.id} className={`${styles.card} ${board.status === 'locked' ? styles.locked : ''}`}>
                        <div className={styles.info}>
                            <span className={styles.category}>{board.category}</span>
                            <h3 className={styles.name}>{board.name}</h3>
                            <code className={styles.id}>{board.id}</code>
                        </div>
                        <div className={styles.actions}>
                            <button
                                onClick={() => handleToggle(board.id, board.status)}
                                disabled={isUpdating === board.id}
                                className={board.status === 'active' ? styles.lockBtn : styles.unlockBtn}
                            >
                                {isUpdating === board.id ? 'æ›´æ–°ä¸­...' : board.status === 'active' ? 'éå…¬é–‹ã«ã™ã‚‹' : 'å…¬é–‹ã™ã‚‹'}
                            </button>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
}

================
File: src/components/MobileHeader.module.css
================
/* ===== Mobile Header - Only shown at 768px and below ===== */

/* Hide on desktop */
.header {
    display: none;
}

@media (max-width: 768px) {
    .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 100;
        height: 56px;
        padding: 0 16px;
        background: var(--background);
        border-bottom: 1px solid var(--border);
        backdrop-filter: blur(12px);
    }
}

.logoLink {
    display: flex;
    align-items: center;
}

/* Logo theme switching */
.logoLight {
    display: block;
}

.logoDark {
    display: none;
}

:global([data-theme="dark"]) .logoLight {
    display: none;
}

:global([data-theme="dark"]) .logoDark {
    display: block;
}

/* Header Right */
.headerRight {
    display: flex;
    align-items: center;
    gap: 8px;
}

.menuButton {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--foreground);
    border-radius: 8px;
    transition: background 0.2s;
}

.menuButton:hover {
    background: var(--accent);
}

/* ===== Overlay ===== */
.overlay {
    position: fixed;
    inset: 0;
    z-index: 198;
    /* Higher than FAB (100) */
    background: rgba(0, 0, 0, 0.4);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.overlayVisible {
    opacity: 1;
    pointer-events: auto;
}

/* ===== Drawer ===== */
.drawer {
    position: fixed;
    top: 56px;
    right: 0;
    bottom: 0;
    z-index: 199;
    /* Higher than FAB (100) */
    width: 300px;
    max-width: 85vw;
    background: var(--background);
    border-left: 1px solid var(--border);
    transform: translateX(100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

.drawerOpen {
    transform: translateX(0);
}

/* ===== Search in Drawer ===== */
.searchForm {
    position: relative;
    padding: 16px;
    border-bottom: 1px solid var(--border);
}

.searchIcon {
    position: absolute;
    left: 28px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted-foreground);
    pointer-events: none;
}

.searchInput {
    width: 100%;
    padding: 10px 12px 10px 36px;
    background: var(--accent);
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 14px;
    color: var(--foreground);
    outline: none;
    transition: border-color 0.2s;
}

.searchInput:focus {
    border-color: var(--ring);
}

/* ===== Board List in Drawer ===== */
.boardList {
    padding: 16px;
}

.boardListHeader {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
}

.boardListTitle {
    font-size: 0.85rem;
    font-weight: 700;
    color: var(--foreground);
}

.boardCount {
    font-size: 0.75rem;
    color: var(--muted-foreground);
}

.categorySection {
    margin-bottom: 20px;
}

.categoryTitle {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--muted-foreground);
    margin: 0 0 8px 0;
    text-transform: uppercase;
    letter-spacing: 0.02em;
}

.list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.boardLink {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 8px 8px 12px;
    font-size: 0.85rem;
    color: var(--foreground);
    text-decoration: none;
    border-radius: 6px;
    transition: background 0.15s;
}

.boardLink:hover,
.boardLink:active {
    background: var(--accent);
}

.drawerFooter {
    padding: 16px 24px 32px 24px;
    margin-top: auto;
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.legalLinks {
    display: flex;
    gap: 16px;
    margin-bottom: 4px;
}

.legalLink {
    font-size: 0.75rem;
    color: var(--muted-foreground);
    text-decoration: none;
}

.legalLink:active {
    color: var(--foreground);
    text-decoration: underline;
}

.footerDivider {
    height: 1px;
    background: var(--border);
    margin-bottom: 24px;
    width: 100%;
}

================
File: src/components/MobileHeader.tsx
================
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import Image from 'next/image';
import { Menu, X, Search, Hash } from 'lucide-react';
import ThemeToggle from './ThemeToggle';
import BoardIcon from './BoardIcon';
import styles from './MobileHeader.module.css';

interface Board {
    id: string;
    name: string;
    category?: string;
}

interface MobileHeaderProps {
    boards: Board[];
}

export default function MobileHeader({ boards }: MobileHeaderProps) {
    const [isOpen, setIsOpen] = useState(false);
    const [searchQuery, setSearchQuery] = useState('');

    // Prevent body scroll when drawer is open
    useEffect(() => {
        if (isOpen) {
            document.body.style.overflow = 'hidden';
        } else {
            document.body.style.overflow = '';
        }
        return () => {
            document.body.style.overflow = '';
        };
    }, [isOpen]);

    // Group boards by category
    const categories = boards.reduce((acc, board) => {
        const category = board.category || 'Other';
        if (!acc[category]) acc[category] = [];
        acc[category].push(board);
        return acc;
    }, {} as Record<string, Board[]>);

    return (
        <>
            <header className={styles.header}>
                <Link href="/" className={styles.logoLink} onClick={() => setIsOpen(false)}>
                    <Image
                        src="/nwww_logo.png?v=2"
                        alt="NWWW (Î²)"
                        width={80}
                        height={28}
                        className={styles.logoLight}
                        style={{ objectFit: 'contain' }}
                        priority
                        unoptimized
                    />
                    <Image
                        src="/nwww_logo_w.png"
                        alt="NWWW (Î²)"
                        width={80}
                        height={28}
                        className={styles.logoDark}
                        style={{ objectFit: 'contain' }}
                        priority
                        unoptimized
                    />
                </Link>
                <div className={styles.headerRight}>
                    <button
                        className={styles.menuButton}
                        onClick={() => setIsOpen(!isOpen)}
                        aria-label={isOpen ? 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹' : 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã'}
                    >
                        {isOpen ? <X size={22} /> : <Menu size={22} />}
                    </button>
                </div>
            </header>

            {/* Overlay */}
            <div
                className={`${styles.overlay} ${isOpen ? styles.overlayVisible : ''}`}
                onClick={() => setIsOpen(false)}
            />

            {/* Drawer */}
            <nav className={`${styles.drawer} ${isOpen ? styles.drawerOpen : ''}`}>
                {/* Search */}
                <form
                    action="/search"
                    method="get"
                    className={styles.searchForm}
                    onSubmit={() => setIsOpen(false)}
                >
                    <Search className={styles.searchIcon} size={16} />
                    <input
                        type="text"
                        name="q"
                        placeholder="ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’æ¤œç´¢"
                        className={styles.searchInput}
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                    />
                </form>

                {/* Board List */}
                <div className={styles.boardList}>
                    <div className={styles.boardListHeader}>
                        <span className={styles.boardListTitle}>æ¿ä¸€è¦§</span>
                        <span className={styles.boardCount}>{boards.length} Boards</span>
                    </div>
                    {Object.entries(categories).map(([category, categoryBoards]) => (
                        <div key={category} className={styles.categorySection}>
                            <h3 className={styles.categoryTitle}>
                                <BoardIcon category={category} size={16} />
                                {category}
                            </h3>
                            <ul className={styles.list}>
                                {categoryBoards.map((board) => (
                                    <li key={board.id}>
                                        <Link
                                            href={`/${board.id}`}
                                            className={styles.boardLink}
                                            onClick={() => setIsOpen(false)}
                                        >
                                            <Hash size={12} style={{ opacity: 0.4 }} />
                                            {board.name}
                                        </Link>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    ))}
                </div>

                {/* Drawer Footer */}
                <div className={styles.drawerFooter}>
                    <div className={styles.footerDivider} />
                    <div className={styles.legalLinks}>
                        <Link href="/tos" className={styles.legalLink} onClick={() => setIsOpen(false)}>åˆ©ç”¨è¦ç´„</Link>
                        <Link href="/privacy" className={styles.legalLink} onClick={() => setIsOpen(false)}>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</Link>
                    </div>
                    <ThemeToggle />
                </div>
            </nav>
        </>
    );
}

================
File: src/components/NewThreadForm.module.css
================
/* Overlay */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    backdrop-filter: blur(4px);
    animation: fadeIn 0.2s ease-out;
}

/* Modal Card */
.modal {
    background: var(--card);
    width: 90%;
    max-width: 672px;
    /* Spec: 672px */
    border-radius: 10px;
    /* Spec: 10px */
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    padding: 24px;
    /* Spec: 24px */
    position: relative;
    animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    color: var(--foreground);
    /* Spec: Text */
    border: 1px solid var(--border);
}

/* Header */
.header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
    /* Spec: Section spacing */
}

.titleArea {
    flex: 1;
}

.title {
    font-size: 20px;
    /* Spec: 20px */
    font-weight: 500;
    /* Spec: 500 */
    color: var(--foreground);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.titleIcon {
    color: var(--foreground);
}

.description {
    color: var(--muted-foreground);
    font-size: 14px;
    line-height: 1.5;
}

.closeButton {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--muted-foreground);
    padding: 8px;
    border-radius: 50%;
    transition: background-color 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.closeButton:hover {
    background: var(--accent);
    /* Spec: Accent */
    color: var(--foreground);
}

/* Form Elements */
.form {
    display: flex;
    flex-direction: column;
    gap: 24px;
    /* Spec: Section spacing */
}

.field {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.label {
    font-size: 14px;
    /* Spec: 14px */
    font-weight: 400;
    /* Spec: 400 */
    color: var(--foreground);
    display: flex;
    align-items: center;
    gap: 8px;
}

.input,
.textarea {
    width: 100%;
    padding: 12px 16px;
    /* Spec: 12px 16px */
    border: 1px solid var(--border);
    /* Spec: Border */
    border-radius: 8px;
    font-size: 14px;
    /* Spec: 14px */
    font-weight: 400;
    /* Spec: 400 */
    font-family: inherit;
    background: var(--background);
    /* Spec: Input bg */
    color: var(--foreground);
    transition: all 0.2s ease;
    /* Spec: 200ms ease */
}

.input::placeholder,
.textarea::placeholder {
    color: var(--muted-foreground);
}

.input:focus,
.textarea:focus {
    outline: none;
    border-color: var(--foreground);
    box-shadow: 0 0 0 2px rgba(var(--foreground-rgb, 0, 0, 0), 0.1);
    /* Spec: Focus ring */
}

.textarea {
    resize: vertical;
    min-height: 120px;
    /* Approx 6 lines */
}

/* Tags */
.subtitle {
    font-size: 14px;
    /* Spec: 14px Label */
    font-weight: 400;
    color: var(--foreground);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.tagList {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    /* Spec: 8px */
    margin-bottom: 12px;
}

.tagButton {
    background: transparent;
    border: 1px solid var(--border);
    padding: 8px 16px;
    border-radius: 9999px;
    font-size: 14px;
    font-weight: 400;
    color: var(--foreground);
    cursor: pointer;
    transition: all 0.2s ease;
}

.tagButton:hover {
    background: var(--accent);
    /* Spec: Hover darker (Accent) */
}

.tagButton.active {
    background: var(--foreground);
    /* Spec: "Select: Black BG" */
    color: var(--background);
    border-color: var(--foreground);
}

.customTagGroup {
    display: flex;
    gap: 8px;
}

.tagInput {
    flex: 1;
    padding: 10px 16px;
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 14px;
    background: var(--background);
}

.addTagButton {
    padding: 0 24px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: var(--foreground);
    transition: all 0.2s ease;
}

.addTagButton:hover {
    background: var(--accent);
}

/* Actions */
.actions {
    display: flex;
    justify-content: flex-end;
    gap: 16px;
    margin-top: 24px;
    padding-top: 0;
}

.cancelButton {
    padding: 12px 24px;
    /* Spec: 12px 24px */
    background: transparent;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    /* Spec: 16px */
    font-weight: 500;
    /* Spec: 500 */
    color: var(--muted-foreground);
    cursor: pointer;
    transition: all 0.2s ease;
}

.cancelButton:hover {
    background: var(--accent);
    color: var(--foreground);
}

.submitButton {
    padding: 12px 24px;
    /* Spec: 12px 24px */
    background: var(--foreground);
    /* Spec: Primary #020203 */
    color: var(--background);
    /* Spec: White text */
    border: none;
    border-radius: 8px;
    font-size: 16px;
    /* Spec: 16px */
    font-weight: 600;
    /* Spec: 500 */
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.submitButton:hover:not(:disabled) {
    opacity: 0.9;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.submitButton:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

/* Success Toast */
.toast {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 60;
    background-color: #10b981;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
    animation: slideUpFade 0.3s ease-out;
}

@keyframes slideUpFade {
    from {
        opacity: 0;
        transform: translate(-50%, 1rem);
    }

    to {
        opacity: 1;
        transform: translate(-50%, 0);
    }
}

/* Trigger Button (FAB) */
.triggerButton {
    position: fixed;
    bottom: 32px;
    right: 32px;
    z-index: 90;

    background: var(--foreground);
    color: var(--background);
    border: none;
    padding: 16px 28px;
    border-radius: 9999px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);

    /* High Elevation Shadow */
    box-shadow:
        0 10px 15px -3px rgba(0, 0, 0, 0.15);
}

.triggerButton:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow:
        0 20px 25px -5px rgba(0, 0, 0, 0.15);
    opacity: 1;
}

.triggerButton:active {
    transform: translateY(0) scale(0.96);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.primaryTriggerButton {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.75rem 2rem;
    background: var(--foreground);
    color: var(--background);
    border: none;
    border-radius: 9999px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    gap: 8px;
}

.primaryTriggerButton:hover {
    background: rgba(var(--foreground-rgb), 0.9);
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

.primaryTriggerButton:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* AI Tabs */
.tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 24px;
    border-bottom: 1px solid var(--border);
}

.tab {
    padding: 10px 16px;
    border: none;
    background: none;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: var(--muted-foreground);
    display: flex;
    align-items: center;
    gap: 6px;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px;
    transition: all 0.2s;
}

.tab:hover {
    color: var(--foreground);
}

.activeTab {
    color: var(--foreground);
    border-bottom-color: var(--foreground);
}

.helperText {
    font-size: 13px;
    color: var(--muted-foreground);
    margin-top: 8px;
    line-height: 1.4;
}

.submitButtonAi {
    padding: 12px 24px;
    background: var(--foreground);
    color: var(--background);
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.submitButtonAi:hover:not(:disabled) {
    opacity: 0.9;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.submitButtonAi:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* â”€â”€â”€ Processing State â”€â”€â”€ */
.processingState {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 16px;
    padding: 40px 0;
    text-align: center;
}

.spinner {
    color: var(--foreground);
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.processingText {
    font-size: 1rem;
    font-weight: 600;
    color: var(--foreground);
    margin: 0;
}

.processingSub {
    font-size: 0.85rem;
    color: var(--muted-foreground);
    margin: 0;
}

/* â”€â”€â”€ Done State â”€â”€â”€ */
.doneState {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 32px 0;
}

.doneIcon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: #10b981;
    color: white;
    margin-bottom: 8px;
}

.doneText {
    font-size: 1.1rem;
    font-weight: 700;
    margin: 0;
    color: var(--foreground);
}

.doneSubtext {
    font-size: 0.9rem;
    color: var(--muted-foreground);
    margin: 0;
}

================
File: src/components/PostContent.tsx
================
'use client';

import React, { useState } from 'react';
import { Post } from '@/data/mockBBS';
import styles from './PostContent.module.css';

interface PostContentProps {
    content: string;
    posts: Post[];
    isDeleted?: boolean;
}

export default function PostContent({ content, posts, isDeleted }: PostContentProps) {
    if (isDeleted) {
        return <div className={styles.deletedText}>ã‚ã¼ãƒ¼ã‚“</div>;
    }

    // Split content by anchor pattern (>>NUMBER)
    // Regex matches: (>>\d+)
    const parts = content.split(/(>>\d+)/g);

    return (
        <div className={styles.content}>
            {parts.map((part, index) => {
                const match = part.match(/^>>(\d+)$/);
                if (match) {
                    const targetIndex = parseInt(match[1], 10) - 1;
                    const targetPost = posts[targetIndex];

                    if (targetPost) {
                        return (
                            <AnchorLink
                                key={index}
                                anchorText={part}
                                targetPost={targetPost}
                                targetIndex={targetIndex + 1}
                            />
                        );
                    } else {
                        // Target doesn't exist (e.g. >>999)
                        return <span key={index} className={styles.brokenAnchor}>{part}</span>;
                    }
                }

                // Render regular text, handling newlines
                return (
                    <span key={index}>
                        {part.split('\n').map((line, i) => (
                            <React.Fragment key={i}>
                                {i > 0 && <br />}
                                {line}
                            </React.Fragment>
                        ))}
                    </span>
                );
            })}
        </div>
    );
}

function AnchorLink({ anchorText, targetPost, targetIndex }: { anchorText: string, targetPost: Post, targetIndex: number }) {
    const [showPreview, setShowPreview] = useState(false);

    const handleClick = (e: React.MouseEvent) => {
        e.preventDefault();
        const element = document.getElementById(`post-${targetIndex}`);
        if (element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            // Highlight effect could be added here
            element.classList.add(styles.highlightTarget);
            setTimeout(() => element.classList.remove(styles.highlightTarget), 2000);
        }
    };

    return (
        <span
            className={styles.anchorWrapper}
            onMouseEnter={() => setShowPreview(true)}
            onMouseLeave={() => setShowPreview(false)}
        >
            <a href={`#post-${targetIndex}`} onClick={handleClick} className={styles.anchorLink}>
                {anchorText}
            </a>

            {showPreview && (
                <div className={styles.previewCard}>
                    <div className={styles.previewHeader}>
                        <span className={styles.previewNumber}>{targetIndex}</span>
                        <span className={styles.previewName}>{targetPost.author}</span>
                        <span className={styles.previewDate}>
                            {new Date(targetPost.createdAt).toLocaleString('ja-JP')}
                        </span>
                    </div>
                    <div className={styles.previewBody}>
                        {targetPost.content.length > 100
                            ? targetPost.content.slice(0, 100) + '...'
                            : targetPost.content}
                    </div>
                </div>
            )}
        </span>
    );
}

================
File: src/components/PostForm.tsx
================
'use client';

import { useState } from 'react';
import { submitPost } from '@/app/actions';
import styles from './PostForm.module.css';

interface PostFormProps {
    boardId: string;
    threadId: string;
}

export default function PostForm({ boardId, threadId }: PostFormProps) {
    const [content, setContent] = useState('');
    const [author, setAuthor] = useState('');
    const [isSubmitting, setIsSubmitting] = useState(false);

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        if (!content.trim()) return;

        setIsSubmitting(true);

        const formData = new FormData();
        formData.append('boardId', boardId);
        formData.append('threadId', threadId);
        formData.append('content', content);
        formData.append('author', author);

        // Add Honeypot if present in form
        const honeypot = (e.currentTarget as HTMLFormElement).elements.namedItem('website_url_verification') as HTMLInputElement;
        if (honeypot) {
            formData.append('website_url_verification', honeypot.value);
        }

        const result = await submitPost(formData);

        if (result.success) {
            setContent('');
            // Optional: Scroll to bottom or show toast
        } else {
            alert('æ›¸ãè¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }

        setIsSubmitting(false);
    };

    return (
        <div className={styles.container}>
            <h3 className={styles.title}>æ›¸ãè¾¼ã¿</h3>
            <form onSubmit={handleSubmit} className={styles.form}>
                <div className={styles.inputGroup}>
                    <input
                        type="text"
                        className={styles.input}
                        placeholder="åå‰ï¼ˆçœç•¥å¯ï¼‰"
                        value={author}
                        onChange={(e) => setAuthor(e.target.value)}
                        disabled={isSubmitting}
                    />
                </div>
                <textarea
                    className={styles.textarea}
                    value={content}
                    onChange={(e) => setContent(e.target.value)}
                    placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."
                    rows={4}
                    disabled={isSubmitting}
                />

                {/* Honeypot field for anti-spam (invisible to users) */}
                <div style={{ display: 'none' }} aria-hidden="true">
                    <input
                        type="text"
                        name="website_url_verification"
                        autoComplete="off"
                        tabIndex={-1}
                    />
                </div>

                <div className={styles.actions}>
                    <button
                        type="submit"
                        className={styles.button}
                        disabled={isSubmitting || !content.trim()}
                    >
                        {isSubmitting ? 'é€ä¿¡ä¸­...' : 'æ›¸ãè¾¼ã‚€'}
                    </button>
                </div>
            </form>
        </div>
    );
}

================
File: src/components/PostList.tsx
================
import { Post } from '@/data/mockBBS';
import styles from './PostList.module.css';

import PostContent from './PostContent';
import ReportButton from './ReportButton';

interface PostListProps {
    posts: Post[];
}

export default function PostList({ posts }: PostListProps) {
    return (
        <div className={styles.container}>
            {posts.length === 0 ? (
                <p className={styles.empty}>ã¾ã æ›¸ãè¾¼ã¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            ) : (
                <ul className={styles.list}>
                    {posts.map((post, index) => (
                        <li key={post.id} className={styles.item} id={`post-${index + 1}`}>
                            <div className={styles.header}>
                                <span className={styles.number}>{index + 1}</span>
                                <span className={styles.name}>{post.author}</span>
                                <span className={styles.date}>{new Date(post.createdAt).toLocaleString('ja-JP')}</span>
                                <span className={styles.id}>ID: {post.id.substring(0, 8)}</span>
                                <div className={styles.reportWrapper}>
                                    <ReportButton postId={post.id} />
                                </div>
                            </div>
                            <div className={styles.content}>
                                <PostContent content={post.content} posts={posts} />
                            </div>
                        </li>
                    ))}
                </ul>
            )}
        </div>
    );
}

================
File: src/components/ReportBoard.tsx
================
'use client';

import { useState } from 'react';
import { updateReportStatus, deletePostAction } from '@/app/actions';
import styles from './ReportBoard.module.css';

interface Report {
    id: string;
    reason: string;
    detail: string | null;
    status: string;
    createdAt: string;
    post: {
        id: string;
        content: string;
        author: string;
        createdAt: string;
        threadTitle: string;
        boardName: string;
        threadId: string;
        boardId: string;
    };
}

interface ReportBoardProps {
    initialReports: Report[];
}

export default function ReportBoard({ initialReports }: ReportBoardProps) {
    const [reports, setReports] = useState(initialReports);

    const handleResolve = async (reportId: string, postId: string) => {
        // Soft delete post and resolve report
        const formData = new FormData();
        formData.append('postId', postId);

        // We only delete if they confirm, but for this UI we'll have separate buttons
        // This helper specifically resolves the report
        const resolveFormData = new FormData();
        resolveFormData.append('reportId', reportId);
        resolveFormData.append('status', 'resolved');

        await updateReportStatus(resolveFormData);
        setReports(reports.filter(r => r.id !== reportId));
    };

    const handleDismiss = async (reportId: string) => {
        const formData = new FormData();
        formData.append('reportId', reportId);
        formData.append('status', 'dismissed');

        await updateReportStatus(formData);
        setReports(reports.filter(r => r.id !== reportId));
    };

    const handleDeleteAndResolve = async (reportId: string, postId: string, boardId: string, threadId: string) => {
        // 1. Delete Post
        const deleteData = new FormData();
        deleteData.append('postId', postId);
        deleteData.append('boardId', boardId);
        deleteData.append('threadId', threadId);
        await deletePostAction(deleteData);

        // 2. Resolve Report
        const resolveData = new FormData();
        resolveData.append('reportId', reportId);
        resolveData.append('status', 'resolved');
        await updateReportStatus(resolveData);

        setReports(reports.filter(r => r.id !== reportId));
    };

    if (reports.length === 0) {
        return <div className={styles.empty}>æœªå‡¦ç†ã®é€šå ±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>;
    }

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <h2>é€šå ±ä¸€è¦§ ({reports.length})</h2>
            </div>
            <div className={styles.list}>
                {reports.map(report => (
                    <div key={report.id} className={styles.reportCard}>
                        <div className={styles.reportHeader}>
                            <span className={styles.reasonTag}>{report.reason}</span>
                            <span className={styles.reportDate}>{new Date(report.createdAt).toLocaleString()}</span>
                        </div>

                        <div className={styles.postContext}>
                            <div className={styles.contextHeader}>
                                <strong>{report.post.boardName}</strong> / {report.post.threadTitle}
                            </div>
                            <div className={styles.postBox}>
                                <div className={styles.postMeta}>
                                    {report.post.author} - {new Date(report.post.createdAt).toLocaleString()}
                                </div>
                                <div className={styles.postContent}>
                                    {report.post.content}
                                </div>
                            </div>
                        </div>

                        {report.detail && (
                            <div className={styles.reportDetail}>
                                <strong>è©³ç´°:</strong> {report.detail}
                            </div>
                        )}

                        <div className={styles.actions}>
                            <button
                                onClick={() => handleDeleteAndResolve(report.id, report.post.id, report.post.boardId, report.post.threadId)}
                                className={styles.deleteBtn}
                            >
                                æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¦è§£æ±º
                            </button>
                            <button
                                onClick={() => handleDismiss(report.id)}
                                className={styles.dismissBtn}
                            >
                                å´ä¸‹
                            </button>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
}

================
File: src/components/SparkAdmin.tsx
================
'use client';

import { useState } from 'react';
import { triggerScheduledSpark } from '@/app/spark-actions';
import styles from './SparkAdmin.module.css';

export default function SparkAdmin() {
    const [isTriggering, setIsTriggering] = useState(false);
    const [lastRun, setLastRun] = useState<string | null>(null);

    const handleTrigger = async () => {
        setIsTriggering(true);
        // Randomly select a board from the expanded list
        const boards = [
            'news-global', 'news-domestic', 'politics-econ', 'media-sns', 'biz-startups',
            'life-work', 'life-relationships', 'life-mental', 'life-money', 'region-local',
            'culture-anime', 'culture-movies', 'culture-gaming', 'culture-music', 'culture-books', 'culture-youtube',
            'science-natural', 'humanities', 'philosophy', 'tech-future',
            'occult', 'urban-legends', 'internet-culture'
        ];
        const randomBoard = boards[Math.floor(Math.random() * boards.length)];

        await triggerScheduledSpark(randomBoard);
        setLastRun(`${new Date().toLocaleTimeString()} (${randomBoard})`);
        setIsTriggering(false);
    };

    return (
        <div className={styles.container}>
            <h4 className={styles.title}>Admin / Debug</h4>
            <div className={styles.controls}>
                <button
                    onClick={handleTrigger}
                    disabled={isTriggering}
                    className={styles.button}
                >
                    {isTriggering ? 'Running...' : 'Trigger Scheduled Spark'}
                </button>
                {lastRun && <p className={styles.status}>Last run: {lastRun}</p>}
                <p className={styles.note}>
                    *Simulates the &quot;Every 3 Hours&quot; auto-generation task.
                </p>
            </div>
        </div>
    );
}

================
File: src/components/ThemeToggle.tsx
================
'use client';

import { useState, useEffect, useCallback } from 'react';
import { Moon, Sun } from 'lucide-react';
import styles from './ThemeToggle.module.css';

export default function ThemeToggle() {
    const [theme, setTheme] = useState<'light' | 'dark'>('light');
    const [mounted, setMounted] = useState(false);

    useEffect(() => {
        const current = document.documentElement.getAttribute('data-theme');
        if (current === 'dark') {
            // eslint-disable-next-line react-hooks/set-state-in-effect
            setTheme('dark');
        } else {
            // eslint-disable-next-line react-hooks/set-state-in-effect
            setTheme('light');
        }
        setMounted(true);
    }, []);

    const toggle = useCallback(() => {
        const next = theme === 'light' ? 'dark' : 'light';
        setTheme(next);
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
    }, [theme]);

    if (!mounted) {
        return <div className={styles.placeholder} />;
    }

    return (
        <button
            className={styles.toggleContainer}
            onClick={toggle}
            aria-label={theme === 'light' ? 'Switch to dark mode' : 'Switch to light mode'}
            type="button"
        >
            <div className={styles.track}>
                <div className={`${styles.slider} ${theme === 'dark' ? styles.sliderDark : ''}`}>
                    {theme === 'light' ? (
                        <Sun size={14} className={styles.sliderIcon} />
                    ) : (
                        <Moon size={14} className={styles.sliderIcon} />
                    )}
                </div>
                <div className={styles.icons}>
                    <span className={`${styles.iconBase} ${theme === 'light' ? styles.iconHidden : ''}`}>
                        <Sun size={14} />
                    </span>
                    <span className={`${styles.iconBase} ${theme === 'dark' ? styles.iconHidden : ''}`}>
                        <Moon size={14} />
                    </span>
                </div>
            </div>
            <span className={styles.label}>{theme === 'light' ? 'LIGHT' : 'DARK'}</span>
        </button>
    );
}

================
File: src/components/TopSparkCTA.module.css
================
/* â”€â”€â”€ Trigger Button â”€â”€â”€ */
/* â”€â”€â”€ Trigger Button (FAB) â”€â”€â”€ */
.triggerButton {
    position: fixed;
    bottom: 32px;
    right: 32px;
    z-index: 100;

    background: #020203;
    color: #ffffff;
    border: none;
    padding: 16px 28px;
    border-radius: 9999px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);

    /* High Elevation Shadow */
    box-shadow:
        0 4px 6px -1px rgba(0, 0, 0, 0.1),
        0 2px 4px -1px rgba(0, 0, 0, 0.06),
        0 10px 15px -3px rgba(0, 0, 0, 0.15);
}

.triggerButton:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow:
        0 20px 25px -5px rgba(0, 0, 0, 0.15),
        0 10px 10px -5px rgba(0, 0, 0, 0.08);
}

.triggerButton:active {
    transform: translateY(0) scale(0.96);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

/* â”€â”€â”€ Overlay & Modal â”€â”€â”€ */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    backdrop-filter: blur(4px);
    animation: fadeIn 0.2s ease-out;
}

.modal {
    background: var(--card);
    width: 90%;
    max-width: 672px;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    padding: 24px;
    position: relative;
    animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    color: #020203;
}

/* â”€â”€â”€ Header â”€â”€â”€ */
.header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
}

.titleArea {
    flex: 1;
}

.title {
    font-size: 20px;
    font-weight: 500;
    color: var(--foreground);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.titleIcon {
    color: var(--foreground);
}

.description {
    color: var(--muted-foreground);
    font-size: 14px;
    line-height: 1.5;
}

.closeButton {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--muted-foreground);
    padding: 8px;
    border-radius: 50%;
    transition: background-color 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.closeButton:hover {
    background: var(--accent);
    color: var(--foreground);
}

/* â”€â”€â”€ Form Elements â”€â”€â”€ */
.form {
    display: flex;
    flex-direction: column;
    gap: 24px;
}

.field {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.label {
    font-size: 14px;
    font-weight: 400;
    color: var(--foreground);
    display: flex;
    align-items: center;
    gap: 8px;
}

.input {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 14px;
    font-weight: 400;
    background: var(--background);
    color: var(--foreground);
    transition: all 0.2s ease;
}

.input:focus {
    outline: none;
    border-color: var(--foreground);
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
}

.input::placeholder {
    color: var(--muted-foreground);
}

.helperText {
    font-size: 13px;
    color: var(--muted-foreground);
    margin-top: 8px;
    line-height: 1.4;
}

.errorText {
    color: #ef4444;
    font-size: 0.85rem;
    font-weight: 500;
    margin-top: 4px;
}

/* â”€â”€â”€ Actions â”€â”€â”€ */
.actions {
    display: flex;
    justify-content: flex-end;
    gap: 16px;
    margin-top: 24px;
}

.cancelButton {
    padding: 12px 24px;
    background: transparent;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    color: var(--muted-foreground);
    cursor: pointer;
    transition: all 0.2s ease;
}

.cancelButton:hover {
    background: var(--accent);
    color: var(--foreground);
}

.submitButtonAi {
    padding: 12px 24px;
    background: var(--foreground);
    color: var(--background);
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.submitButtonAi:hover:not(:disabled) {
    opacity: 0.8;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.submitButtonAi:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

/* â”€â”€â”€ Processing State â”€â”€â”€ */
.processingState {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 16px;
    padding: 40px 0;
    text-align: center;
}

.spinner {
    color: var(--foreground);
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.processingText {
    font-size: 1rem;
    font-weight: 600;
    color: var(--foreground);
    margin: 0;
}

.processingSub {
    font-size: 0.85rem;
    color: var(--muted-foreground);
    margin: 0;
}

/* â”€â”€â”€ Done State â”€â”€â”€ */
.doneState {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 32px 0;
}

.doneIcon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: #10b981;
    color: white;
    margin-bottom: 8px;
}

.doneText {
    font-size: 1.1rem;
    font-weight: 700;
    margin: 0;
    color: var(--foreground);
}

.doneSubtext {
    font-size: 0.9rem;
    color: var(--muted-foreground);
    margin: 0;
}

/* â”€â”€â”€ Animations â”€â”€â”€ */
@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* â”€â”€â”€ Mobile â”€â”€â”€ */
@media (max-width: 768px) {
    .modal {
        width: 100%;
        height: 100%;
        max-width: none;
        border-radius: 0;
        padding: 20px;
    }
}

================
File: src/components/TopSparkCTA.tsx
================
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { Sparkles, X, Check, Loader2, Link as LinkIcon, AlertCircle } from 'lucide-react';
import styles from './TopSparkCTA.module.css';

interface BoardInfo {
    id: string;
    name: string;
    category: string;
    description: string;
}

interface TopSparkCTAProps {
    boards: BoardInfo[];
}

export default function TopSparkCTA({ boards }: TopSparkCTAProps) {
    const router = useRouter();
    const [isOpen, setIsOpen] = useState(false);
    const [url, setUrl] = useState('');
    const [isSubmitting, setIsSubmitting] = useState(false);
    const [result, setResult] = useState<{ threadId: string; boardId: string } | null>(null);
    const [error, setError] = useState<string | null>(null);

    // Lock body scroll when modal is open
    useEffect(() => {
        if (isOpen) {
            document.body.style.overflow = 'hidden';
        } else {
            document.body.style.overflow = 'unset';
        }
        return () => {
            document.body.style.overflow = 'unset';
        };
    }, [isOpen]);

    const handleGenerate = async (e: React.FormEvent) => {
        e.preventDefault();
        if (!url.trim()) return;

        const honeypot = (e.currentTarget as HTMLFormElement).elements.namedItem('website_url_verification') as HTMLInputElement;
        if (honeypot?.value) {
            console.warn('Spam detected via Honeypot');
            return;
        }

        setIsSubmitting(true);
        setError(null);

        try {
            const res = await fetch('/api/thread/generate', {
                method: 'POST',
                body: JSON.stringify({
                    url,
                    website_url_verification: (e.currentTarget as HTMLFormElement).elements.namedItem('website_url_verification')?.valueOf()
                }),
                headers: { 'Content-Type': 'application/json' }
            });
            const data = await res.json();

            if (data.success) {
                setResult({ threadId: data.threadId, boardId: data.boardId || '' });
                setTimeout(() => {
                    const targetBoardId = data.boardId || 'news-global';
                    router.push(`/${targetBoardId}/${data.threadId}`);
                }, 1500);
            } else {
                setError(data.error || 'ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                setIsSubmitting(false);
            }
        } catch (e) {
            setError('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            setIsSubmitting(false);
        }
    };

    const handleClose = () => {
        setIsOpen(false);
        setUrl('');
        setResult(null);
        setError(null);
        setIsSubmitting(false);
    };

    const getBoardName = (id: string) => {
        const b = boards.find(b => b.id === id);
        return b ? b.name : id;
    };

    if (!isOpen) {
        return (
            <div className={styles.triggerButtonWrapper}>
                <button onClick={() => setIsOpen(true)} className={styles.triggerButton}>
                    <span>æ–°è¦ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆ</span>
                </button>
            </div>
        );
    }

    return (
        <div className={styles.overlay} onClick={handleClose}>
            <div className={styles.modal} onClick={e => e.stopPropagation()}>
                {result ? (
                    <div className={styles.doneState}>
                        <div className={styles.doneIcon}><Check size={28} /></div>
                        <p className={styles.doneText}>ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆã—ã¾ã—ãŸï¼</p>
                        <p className={styles.doneSubtext}>
                            {getBoardName(result.boardId)} ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆä¸­...
                        </p>
                    </div>
                ) : isSubmitting ? (
                    <div className={styles.processingState}>
                        <Loader2 size={32} className={styles.spinner} />
                        <p className={styles.processingText}>NWWWãŒè¨˜äº‹ã‚’åˆ†æã—ã€æœ€é©ãªæ¿ã‚’é¸å®šã—ã¦ã„ã¾ã™...</p>
                        <p className={styles.processingSub}>ã“ã‚Œã«ã¯æ•°ç§’ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™</p>
                    </div>
                ) : (
                    <>
                        <div className={styles.header}>
                            <div className={styles.titleArea}>
                                <h2 className={styles.title}>
                                    <Sparkles className={styles.titleIcon} size={24} />
                                    NWWWã‚¹ãƒ¬ãƒƒãƒ‰ç”Ÿæˆ (Beta)
                                </h2>
                            </div>
                            <button className={styles.closeButton} onClick={handleClose}>
                                <X size={24} />
                            </button>
                        </div>

                        <form onSubmit={handleGenerate} className={styles.form}>
                            <div className={styles.field}>
                                <label className={styles.label}>
                                    <LinkIcon size={16} />
                                    è¨˜äº‹ã®URL
                                </label>
                                <input
                                    type="url"
                                    value={url}
                                    onChange={(e) => setUrl(e.target.value)}
                                    placeholder="https://example.com/news/..."
                                    className={styles.input}
                                    autoFocus
                                    required
                                />
                                <p className={styles.helperText}>
                                    URLå…ˆã®å†…å®¹ã‚’NWWWãŒåˆ†æã—ã¦ã€é©åˆ‡ãªæ¿ã«ã‚¹ãƒ¬ç«‹ã¦ã—ã¾ã™ã€‚
                                </p>
                                {error && (
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '6px', color: '#ef4444', marginTop: '8px', fontSize: '0.85rem' }}>
                                        <AlertCircle size={16} />
                                        <span>{error}</span>
                                    </div>
                                )}
                            </div>

                            {/* Honeypot field for anti-spam (invisible to users) */}
                            <div style={{ display: 'none' }} aria-hidden="true">
                                <input
                                    type="text"
                                    name="website_url_verification"
                                    autoComplete="off"
                                    tabIndex={-1}
                                />
                            </div>

                            <div className={styles.actions}>
                                <button
                                    type="button"
                                    className={styles.cancelButton}
                                    onClick={handleClose}
                                >
                                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                </button>
                                <button
                                    type="submit"
                                    className={styles.submitButtonAi}
                                    disabled={!url.trim()}
                                >
                                    <Sparkles size={18} />
                                    è¨˜äº‹ã‹ã‚‰ä½œæˆ
                                </button>
                            </div>
                        </form>
                    </>
                )}
            </div>
        </div>
    );
}

================
File: src/middleware.ts
================
import { withAuth } from "next-auth/middleware";

export default withAuth({
    callbacks: {
        authorized: ({ token }) => !!token,
    },
});

export const config = {
    matcher: ["/admin/:path*"],
};

================
File: .gitignore
================
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

/src/generated/prisma


.claude/
.gemini/
.repomix/
repomix-output.xml
repomix-output.txt
.agent/

================
File: next.config.ts
================
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  experimental: {
    optimizePackageImports: ["lucide-react"],
  },
};

export default nextConfig;

================
File: src/app/[boardId]/page.module.css
================
/* Page Container */
.pageContainer {
    width: 100%;
}

/* Sticky Header */
.stickyHeader {
    position: sticky;
    top: 0;
    z-index: 10;
    background: var(--background);
    /* bg-background/80 */
    backdrop-filter: blur(12px);
    /* backdrop-blur-md */
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    /* border-border/50 */
}

.headerInner {
    max-width: 80rem;
    /* max-w-5xl (1280px) */
    margin: 0 auto;
    padding: 1rem 2rem;
    /* px-8 py-4 */
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Header Left */
.headerLeft {
    display: flex;
    align-items: center;
    gap: 12px;
    /* gap-3 */
}

.backButton {
    color: var(--muted-foreground);
    width: 1rem;
    height: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.2s;
}

.backButton:hover {
    color: var(--foreground);
}

.boardInfo {
    margin-bottom: 1px;
    /* mb-1 for title */
}

.boardTitle {
    font-size: 1.25rem;
    /* text-xl */
    font-weight: 500;
    color: var(--foreground);
    line-height: 1.2;
    margin: 0;
}

.boardDesc {
    font-size: 0.875rem;
    /* text-sm */
    color: var(--muted-foreground);
    margin: 0;
    margin-left: 0;
    /* Spec said ml-7 to align, but flex layout handles it better here? */
}

/* Header Right */
.headerRight {
    display: flex;
    align-items: center;
    gap: 12px;
    /* gap-3 */
}

.searchContainer {
    position: relative;
}

.searchInput {
    width: 200px;
    padding: 8px 16px 8px 36px;
    /* pl-9 pr-4 py-2 */
    background: rgba(233, 235, 239, 0.3);
    /* bg-accent/30 */
    border: 1px solid rgba(0, 0, 0, 0.05);
    /* border-border/50 */
    border-radius: 8px;
    /* rounded-lg */
    font-size: 0.875rem;
    transition: all 0.2s;
}

.searchInput:focus {
    outline: none;
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
    background: var(--card);
}

.searchIcon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted-foreground);
    pointer-events: none;
}

.aiToggle {
    padding: 8px 12px;
    /* px-3 py-2 */
    background: rgba(233, 235, 239, 0.5);
    /* bg-accent/50 */
    border: 1px solid rgba(0, 0, 0, 0.05);
    border-radius: 8px;
    font-size: 0.875rem;
    /* text-sm */
    color: var(--foreground);
    cursor: pointer;
    transition: all 0.2s;
}

.aiToggle:hover {
    background: #e9ebef;
    /* bg-accent */
}

/* Content Area */
.contentArea {
    max-width: 80rem;
    /* max-w-5xl */
    margin: 0 auto;
    padding: 2rem;
    /* py-8 */
    padding-left: 2rem;
    /* px-8 */
    padding-right: 2rem;
}

.listHeader {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    /* mb-6 */
}

.categoryBadge {
    font-size: 0.75rem;
    /* text-xs */
    text-transform: uppercase;
    letter-spacing: 0.05em;
    /* tracking-wider */
    color: var(--muted-foreground);
    font-weight: 500;
}

.threadList {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    /* space-y-4 */
}

/* Thread Card */
.cardLink {
    display: block;
    text-decoration: none;
    color: inherit;
}

.threadCard {
    background: var(--card);
    /* bg-card */
    border: 1px solid rgba(0, 0, 0, 0.05);
    /* border-border/50 */
    border-radius: 12px;
    /* rounded-xl */
    padding: 1.5rem;
    /* p-6 */
    transition: all 0.3s ease;
    /* duration-300 */
}

.threadCard:hover {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    /* shadow-md */
    border-color: rgba(0, 0, 0, 0.1);
    /* border-border */
    transform: translateY(-1px);
}

.cardHeader {
    margin-bottom: 0.75rem;
    /* space-y-3 gap */
}

.threadTitle {
    font-size: 1.125rem;
    /* text-lg */
    font-weight: 500;
    color: var(--foreground);
    margin: 0;
    transition: color 0.2s;
}

.threadCard:hover .threadTitle {
    color: rgba(26, 26, 26, 0.9);
    /* group-hover:text-foreground/90 */
}

/* Footer & Meta */
.cardFooter {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-top: 0.5rem;
    /* pt-2 */
}

.tags {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    /* gap-2 */
}

.tag {
    font-size: 0.75rem;
    /* text-xs */
    color: var(--muted-foreground);
    transition: color 0.2s;
}

.threadCard:hover .tag {
    color: var(--foreground);
}

.metaData {
    display: flex;
    align-items: center;
    gap: 1rem;
    /* gap-4 */
    font-size: 0.75rem;
    /* text-xs */
    color: var(--muted-foreground);
}

.timestamp {
    display: flex;
    align-items: center;
    gap: 4px;
}

.stats {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    /* gap-3 */
}

.statItem {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    /* gap-1 */
}

/* Responsive adjustments */
@media (max-width: 768px) {

    .contentArea,
    .headerInner {
        padding-left: 1rem;
        padding-right: 1rem;
    }

    .threadCard {
        padding: 1rem;
    }
}

/* Pagination */
.pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin-top: 2rem;
    padding: 1rem 0;
}

.pageButton {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem 1rem;
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--foreground);
    background: var(--card);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 0.5rem;
    text-decoration: none;
    transition: all 0.2s;
    cursor: pointer;
}

.pageButton:hover {
    background: var(--accent);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.pageButtonDisabled {
    opacity: 0.3;
    pointer-events: none;
    cursor: default;
}

.pageInfo {
    font-size: 0.85rem;
    color: var(--muted-foreground);
    font-weight: 500;
}

/* Empty State */
.emptyState {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 6rem 2rem;
    text-align: center;
    background: var(--card);
    /* Fallback is enough */
    border-radius: 16px;
    border: 1px dashed rgba(0, 0, 0, 0.08);
    margin-top: 2rem;
    position: relative;
    overflow: hidden;
}

@media (prefers-color-scheme: dark) {
    .emptyState {
        border-color: rgba(255, 255, 255, 0.1);
    }
}

.emptyContent {
    position: relative;
    z-index: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width: 480px;
}

.emptyIconWrapper {
    width: 64px;
    height: 64px;
    background: rgba(0, 0, 0, 0.03);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1.5rem;
    color: var(--muted-foreground);
    transition: all 0.3s ease;
}

.emptyState:hover .emptyIconWrapper {
    transform: scale(1.05);
    background: rgba(0, 0, 0, 0.05);
    color: var(--foreground);
}

.emptyTitle {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0 0 0.75rem 0;
    color: var(--foreground);
    letter-spacing: -0.01em;
}

.emptyDescription {
    color: var(--muted-foreground);
    margin: 0 0 2rem 0;
    font-size: 0.95rem;
    line-height: 1.6;
}

.emptyAction {
    width: 100%;
    display: flex;
    justify-content: center;
}

================
File: src/app/api/thread/generate/route.ts
================
import { NextResponse } from 'next/server';
import { GoogleGenerativeAI } from '@google/generative-ai';
import * as cheerio from 'cheerio';
import prisma from '@/lib/prisma';

// Helper: Try to scrape content via generic HTTP fetch + OGP metadata
async function scrapeGeneric(url: string): Promise<{ title: string; content: string }> {
    const res = await fetch(url, {
        headers: {
            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
        }
    });
    if (!res.ok) throw new Error(`Failed to fetch: ${res.status}`);
    const html = await res.text();
    const $ = cheerio.load(html);

    $('script, style, nav, footer, iframe, noscript').remove();

    const ogTitle = $('meta[property="og:title"]').attr('content');
    const ogDesc = $('meta[property="og:description"]').attr('content');
    const twitterDesc = $('meta[name="twitter:description"]').attr('content');
    const desc = $('meta[name="description"]').attr('content');

    const title = ogTitle || $('title').text().trim() || 'No Title';
    const metaSummary = [ogDesc, twitterDesc, desc].filter(Boolean).join('\n');

    let bodyText = $('article').text() || $('main').text() || $('body').text();
    bodyText = bodyText.replace(/\s+/g, ' ').trim();

    const content = `Summary: ${metaSummary}\nContent: ${bodyText.slice(0, 10000)}`;

    if (content.length < 30 && !metaSummary) {
        throw new Error('Content too short and no metadata found');
    }

    return { title, content };
}

// Helper: Try Twitter oEmbed API
async function scrapeTwitter(url: string): Promise<{ title: string; content: string } | null> {
    try {
        const oembedUrl = `https://publish.twitter.com/oembed?url=${encodeURIComponent(url)}`;
        const res = await fetch(oembedUrl);

        if (!res.ok) {
            console.warn(`Twitter oEmbed returned ${res.status}, falling back to generic scraping`);
            return null; // Signal to use fallback
        }

        const data = await res.json();
        const $ = cheerio.load(data.html || '');
        const tweetText = $('p').text();

        return {
            title: `ã€Xã€‘${data.author_name}ã®ãƒã‚¹ãƒˆ`,
            content: [
                `[Platform]: X (Twitter)`,
                `[Author]: ${data.author_name}`,
                `[Tweet Link]: ${url}`,
                `[Content]:`,
                tweetText,
            ].join('\n'),
        };
    } catch (error) {
        console.warn('Twitter oEmbed failed, falling back:', error);
        return null;
    }
}

import { checkRateLimit } from '@/lib/rate-limit';

export async function POST(req: Request) {
    try {
        const { url, website_url_verification } = await req.json();

        // Rate Limit Check (IP-based)
        const ip = req.headers.get('x-forwarded-for')?.split(',')[0] || '127.0.0.1';
        const canGenerate = await checkRateLimit(`thread-gen:${ip}`, 1, 60000); // 1 request per minute
        if (!canGenerate) {
            return NextResponse.json({ error: 'Too many requests. Please wait a minute.' }, { status: 429 });
        }

        if (website_url_verification) {
            return NextResponse.json({ error: 'Spam detected' }, { status: 400 });
        }

        if (!url) {
            return NextResponse.json({ error: 'URL is required' }, { status: 400 });
        }

        if (!process.env.GEMINI_API_KEY) {
            console.error('GEMINI_API_KEY is missing');
            return NextResponse.json({ error: 'Server configuration error: GEMINI_API_KEY missing' }, { status: 500 });
        }

        // 1. Fetch content â€” try platform-specific first, fallback to generic
        let textContent = '';
        let pageTitle = '';
        const isTwitter = url.includes('twitter.com') || url.includes('x.com');

        try {
            if (isTwitter) {
                // Try oEmbed first; if it fails, fall back to generic scraping
                const twitterResult = await scrapeTwitter(url);
                if (twitterResult) {
                    pageTitle = twitterResult.title;
                    textContent = twitterResult.content;
                } else {
                    // Fallback: generic scraping (will get OGP meta at minimum)
                    const genericResult = await scrapeGeneric(url);
                    pageTitle = genericResult.title;
                    textContent = genericResult.content;
                }
            } else {
                const genericResult = await scrapeGeneric(url);
                pageTitle = genericResult.title;
                textContent = genericResult.content;
            }
        } catch (error) {
            console.error('Content extraction failed:', error);
            return NextResponse.json(
                { error: 'Failed to retrieve content from URL. Please try another URL.' },
                { status: 400 }
            );
        }

        // 2. Get available boards for categorization (only active ones)
        const boards = await prisma.board.findMany({
            where: { status: 'active' },
            select: { id: true, name: true, description: true }
        });
        const boardsList = boards.map((b: { id: string; name: string; description: string | null }) =>
            `- ID: "${b.id}" (${b.name}): ${b.description}`
        ).join('\n');

        // 3. Call Gemini API â€” try multiple model names for compatibility
        const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);

        const modelsToTry = [
            'gemini-2.0-flash',
            'gemini-1.5-flash-001',
            'gemini-1.5-flash',
            'gemini-pro',
        ];

        const prompt = `
    ã‚ãªãŸã¯ã€Œ2ã¡ã‚ƒã‚“ã­ã‚‹ï¼ˆ5ã¡ã‚ƒã‚“ã­ã‚‹ï¼‰ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹é€Ÿå ±ï¼‹æ¿ã€ã«ã‚¹ãƒ¬ã‚’ç«‹ã¦ã‚‹ã€ç™¾æˆ¦éŒ¬ç£¨ã®ã€Œã‚¹ãƒ¬ç«‹ã¦è¨˜è€…ã€ã§ã™ã€‚
    ä»¥ä¸‹ã®è¨˜äº‹æƒ…å ±ã‚’ã‚‚ã¨ã«ã€ä½äººï¼ˆã­ã‚‰ãƒ¼ï¼‰ãŒæœ€ã‚‚é£Ÿã„ã¤ãã€è­°è«–ãŒç™½ç†±ï¼ˆç‚ä¸Šï¼‰ã™ã‚‹ã‚ˆã†ãªã€Œã‚¯ã‚½ã‚¹ãƒ¬ã€ã‚®ãƒªã‚®ãƒªã®ã€Œè‰¯ã‚¹ãƒ¬ã€ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

    ## è¨˜äº‹æƒ…å ±
    Title: ${pageTitle}
    URL: ${url}
    Content Summary: ${textContent.slice(0, 5000)}... (truncated)

    ## æ–‡ä½“ãƒ»ãƒˆãƒ¼ãƒ³ã®æŒ‡ç¤º (é‡è¦)
    - **å ±é“æ©Ÿé–¢ã®ã‚ˆã†ãªä¸­ç«‹çš„ãƒ»ä¸å¯§ãªå£èª¿ã¯å³ç¦**ã§ã™ã€‚ã€Œã€œã§ã™ã­ã€ã€Œã€œã—ã¾ã—ã‚‡ã†ã€ã¯æ’é™¤ã—ã¦ãã ã•ã„ã€‚
    - **æ–­å®šèª¿**ã€**å€’ç½®æ³•**ã€**ãƒãƒƒãƒˆã‚¹ãƒ©ãƒ³ã‚°**ï¼ˆã€Œã€œãªä»¶ã€ã€Œã€œä¸å¯é¿ã€ã€Œã€æ‚²å ±ã€‘ã€ã€Œã€æœ—å ±ã€‘ã€ãªã©ï¼‰ã‚’è‡ªç„¶ã«æ··ãœã¦ãã ã•ã„ã€‚
    - è¨˜äº‹ã®æ ¸å¿ƒã‚’çªãã€ä¸€è¨€ã§ã€Œè¦ã™ã‚‹ã«ã“ã†ã„ã†ã“ã¨ã ã‚ã€ã¨æ–­ã˜ã‚‹ã‚ˆã†ãªã€çŸ­ãã‚­ãƒ¬ã®ã‚ã‚‹æ–‡ä½“ã«ã—ã¦ãã ã•ã„ã€‚

    ## é‡è¦: AIè¦ç´„ (aiAnalysis) ã®åˆ¶ç´„
    - å¿…ãš **3è¡Œ** ã®ç®‡æ¡æ›¸ãã§æ§‹æˆã—ã¦ãã ã•ã„ã€‚
    - **å„è¡Œã¯å…¨è§’10æ–‡å­—ä»¥å†…** ã«å³æ ¼ã«åã‚ã¦ãã ã•ã„ã€‚
    - ä½“è¨€æ­¢ã‚ã‚„çŸ­ã„ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’ä½¿ç”¨ã—ã€ç°¡æ½”ã«è¦ç‚¹ã‚’çªã„ã¦ãã ã•ã„ã€‚

    ## å‡ºåŠ›ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¦ä»¶

    ### 1. Title (ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¿ã‚¤ãƒˆãƒ«)
    - 30æ–‡å­—ä»¥å†…ã€‚
    - è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ãã®ã¾ã¾ä½¿ã†ã®ã§ã¯ãªãã€ã­ã‚‰ãƒ¼ãŒæ€ã‚ãšã‚¯ãƒªãƒƒã‚¯ã—ãŸããªã‚‹ã‚ˆã†ã«æ”¹å¤‰ã—ã¦ãã ã•ã„ã€‚

    ### 2. Initial Post Content (>>1 æœ¬æ–‡)
    - **æ¥µã‚ã¦ç°¡æ½”ã«**æ›¸ã„ã¦ãã ã•ã„ã€‚ãƒ€ãƒ©ãƒ€ãƒ©ã¨ã—ãŸèª¬æ˜ã¯ä¸è¦ã§ã™ã€‚
    - è¨˜äº‹ã®**å®¢è¦³çš„ãªè¦ç´„**ï¼ˆ2ã€œ3è¡Œç¨‹åº¦ã€çŸ­ã„æ–‡ã§ï¼‰ã‚’æœ€åˆã«æ›¸ã„ã¦ãã ã•ã„ã€‚
    - ãã®å¾Œã«ã€ã‚¹ãƒ¬ç«‹ã¦è¨˜è€…ï¼ˆã‚ãªãŸï¼‰ã¨ã—ã¦ã®**ä¸€è¨€ã‚³ãƒ¡ãƒ³ãƒˆ**ï¼ˆç…½ã‚Šã€ãƒœãƒ¤ã‚­ã€çš®è‚‰ãªã©ï¼‰ã‚’1è¡Œã€œ2è¡Œç¨‹åº¦ã§æ·»ãˆã¦ãã ã•ã„ã€‚
    - **ã€ŒãŠå‰ã‚‰ã©ã†æ€ã†ï¼Ÿã€ã‚„ã€Œè­°è«–ã—ã¾ã—ã‚‡ã†ã€ã¨ã„ã£ãŸã€ä½äººã«åªšã³ã‚‹ã‚ˆã†ãªå•ã„ã‹ã‘ã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚** è¨˜è€…ã®ç‹¬ã‚Šè¨€ã¨ã—ã¦å®Œçµã•ã›ã¦ãã ã•ã„ã€‚
    - ã‚¹ãƒãƒ›ã§ã‚‚1ç”»é¢ã«åã¾ã‚‹ç¨‹åº¦ã®åˆ†é‡ã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚

    ## å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ (JSONã®ã¿)
    {
      "title": "ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ30æ–‡å­—ä»¥å†…ï¼‰",
      "boardId": "ä»¥ä¸‹ã®ãƒªã‚¹ãƒˆã‹ã‚‰æœ€ã‚‚é©åˆ‡ãªIDã‚’é¸æŠ",
      "tags": ["ã‚¿ã‚°1", "ã‚¿ã‚°2", "ã‚¿ã‚°3"],
      "aiAnalysis": "3è¡Œç®‡æ¡æ›¸ãï¼ˆå„è¡Œ10æ–‡å­—ä»¥å†…ï¼‰ã€‚",
      "initialPostContent": "è¦ç´„éƒ¨åˆ†...\\n\\n(ä¸€è¨€ã‚³ãƒ¡ãƒ³ãƒˆ)..."
    }

    ## é¸æŠå¯èƒ½ãªBoard IDãƒªã‚¹ãƒˆ
    ${boardsList}

    é‡è¦: "boardId" ã¯å¿…ãšãƒªã‚¹ãƒˆã®ä¸­ã‹ã‚‰æ­£ç¢ºã«é¸ã‚“ã§ãã ã•ã„ã€‚
    JSONä»¥å¤–ã®ãƒ†ã‚­ã‚¹ãƒˆã¯å‡ºåŠ›ã—ãªã„ã§ãã ã•ã„ã€‚
    `;

        let generatedText = '';
        let lastError: Error | null = null;

        for (const modelName of modelsToTry) {
            try {
                console.log(`Trying model: ${modelName}`);
                const model = genAI.getGenerativeModel({ model: modelName });

                // Add simple retry logic for 429/404
                let attempts = 0;
                while (attempts < 2) { // Retry once per model
                    try {
                        const result = await model.generateContent(prompt);
                        const response = await result.response;
                        generatedText = response.text();
                        console.log(`Success with model: ${modelName}`);
                        break;
                    } catch (e: any) {
                        attempts++;
                        console.warn(`Attempt ${attempts} failed for ${modelName}:`, e.message);
                        if (attempts >= 2) throw e;
                        // Wait 2 seconds before retry
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                }
                if (generatedText) break; // Success â€” exit model loop

            } catch (error) {
                console.warn(`Model ${modelName} failed after retries:`, error);
                lastError = error as Error;
                // Wait a bit before trying next model to avoid hitting rate limits properly
                await new Promise(resolve => setTimeout(resolve, 1000));
                continue; // Try next model
            }
        }

        if (!generatedText) {
            console.error('All models failed. Last error:', lastError);
            return NextResponse.json(
                { error: 'AI generation failed. All model variants returned errors.', details: String(lastError) },
                { status: 500 }
            );
        }

        // ... existing code ...

        // Extract JSON from response
        const jsonMatch = generatedText.match(/\{[\s\S]*\}/);
        if (!jsonMatch) {
            console.error('AI Response (No JSON):', generatedText); // Log raw text
            throw new Error('No JSON found in AI response. Raw output logged.');
        }

        let data;
        try {
            data = JSON.parse(jsonMatch[0]);
        } catch (e) {
            console.error('JSON Parse Error:', e);
            console.error('Raw JSON String:', jsonMatch[0]);
            throw new Error('Failed to parse (valid?) JSON from AI response');
        }

        // Validate boardId
        const validBoardIds = boards.map((b: { id: string }) => b.id);
        let targetBoardId = data.boardId;
        if (!validBoardIds.includes(targetBoardId)) {
            console.warn(`Invalid boardId "${targetBoardId}" returned. Defaulting to news-global.`);
            targetBoardId = validBoardIds.includes('news-global') ? 'news-global' : validBoardIds[0];
        }

        // 4. Save to Database (Transaction)
        try {
            const newThread = await prisma.$transaction(async (tx: any) => {
                const thread = await tx.thread.create({
                    data: {
                        title: data.title,
                        boardId: targetBoardId,
                        isAiGenerated: true,
                        sourceUrl: url,
                        sourceTitle: pageTitle,
                        sourcePlatform: isTwitter ? 'twitter' : 'web',
                        aiAnalysis: typeof data.aiAnalysis === 'string'
                            ? data.aiAnalysis
                            : Array.isArray(data.aiAnalysis)
                                ? data.aiAnalysis.join('\n')
                                : String(data.aiAnalysis), // Fallback to String() instead of JSON.stringify()
                        tags: data.tags || [],
                        views: 0,
                        postCount: 1,
                        momentum: 1000,
                        lastUpdated: new Date(),
                    }
                });

                await tx.post.create({
                    data: {
                        content: data.initialPostContent,
                        author: '@ãƒ‹ãƒ¥ã€œãã‚“ã¯AIãªã®ã§ã™',
                        userId: 'NWWW_KUN_',
                        threadId: thread.id,
                    }
                });

                return thread;
            });
            return NextResponse.json({ success: true, threadId: newThread.id, boardId: targetBoardId });
        } catch (dbError) {
            console.error('Database Transaction Error:', dbError);
            throw new Error(`Database error: ${dbError}`);
        }

    } catch (error: any) {
        console.error('API Implementation Error:', error);
        // Return the specific error message to client for debugging
        return NextResponse.json(
            { error: 'Internal Server Error', details: error.message || String(error) },
            { status: 500 }
        );
    }
}

================
File: src/app/auth/signin/page.tsx
================
'use client';

import { Suspense } from 'react';
import { signIn } from 'next-auth/react';
import { useSearchParams as useNextSearchParams } from 'next/navigation';
import { useState } from 'react';
import { Github } from 'lucide-react';
import styles from './page.module.css';

function SignInContent() {
    const searchParams = useNextSearchParams();
    const callbackUrl = searchParams.get('callbackUrl') || '/admin';
    const [isLoading, setIsLoading] = useState(false);

    const handleSignIn = async () => {
        setIsLoading(true);
        await signIn('github', { callbackUrl });
    };

    return (
        <div className={styles.container}>
            <div className={styles.card}>
                <div className={styles.header}>
                    <div className={styles.logo}>
                        NWWW
                    </div>
                    <h1 className={styles.title}>ç®¡ç†ç”»é¢ãƒ­ã‚°ã‚¤ãƒ³</h1>
                    <p className={styles.description}>
                        ç®¡ç†è€…æ¨©é™ã‚’æŒã¤GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§<br />
                        ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚
                    </p>
                </div>

                <div className={styles.content}>
                    <button
                        onClick={handleSignIn}
                        disabled={isLoading}
                        className={styles.githubButton}
                    >
                        {isLoading ? (
                            <div className={styles.spinner} />
                        ) : (
                            <Github size={20} />
                        )}
                        GitHub ã§ãƒ­ã‚°ã‚¤ãƒ³
                    </button>

                    <p className={styles.note}>
                        â€»è¨±å¯ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ä»¥å¤–ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“
                    </p>
                </div>
            </div>
        </div>
    );
}

export default function SiginInPage() {
    return (
        <Suspense fallback={<div className={styles.container}><div className={styles.spinner} /></div>}>
            <SignInContent />
        </Suspense>
    );
}

================
File: src/app/page.tsx
================
import { getAllThreads, getBoards } from '@/data/db-actions';
import styles from './page.module.css';
import ThreadCard from '@/components/ThreadCard';
import DiscoverSection from '@/components/DiscoverSection';
import TopSparkCTA from '@/components/TopSparkCTA';

export default async function Home() {
  const [allThreadsWithBoard, boards] = await Promise.all([
    getAllThreads(),
    getBoards()
  ]);

  // 1. WHAT'S NEW: Sort by createdAt desc, take 10
  const newThreads = [...allThreadsWithBoard]
    .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())
    .slice(0, 10);

  // 2. PICK UP: Sort by momentum (postCount / hours elapsed), take 6
  const now = Date.now();
  const pickUpThreads = [...allThreadsWithBoard]
    .map(t => {
      const hoursElapsed = Math.max((now - new Date(t.createdAt).getTime()) / 3600000, 1);
      return { ...t, momentum: t.postCount / hoursElapsed };
    })
    .sort((a, b) => b.momentum - a.momentum)
    .slice(0, 6);

  // 3. DISCOVER: IDs to exclude (already shown in WHAT'S NEW and PICK UP)
  const usedIds = [
    ...newThreads.map(t => t.id),
    ...pickUpThreads.map(t => t.id)
  ];

  // Optimize serialization: Only pass fields needed by DiscoverSection/ThreadCard
  const threadsForClient = allThreadsWithBoard.map(t => ({
    id: t.id,
    title: t.title,
    postCount: t.postCount,
    lastUpdated: t.lastUpdated,
    boardName: t.boardName,
    boardId: t.boardId,
    createdAt: t.createdAt
  }));

  return (
    <main className={styles.main}>
      <TopSparkCTA boards={boards} />

      {/* WHAT'S NEW */}
      <section className={styles.section}>
        <div className={styles.sectionHeader}>
          <h2 className={styles.sectionTitle}>WHAT&apos;S NEW</h2>
          <p className={styles.sectionSub}>æ–°ç€ã‚¹ãƒ¬ãƒƒãƒ‰</p>
        </div>
        <div className={styles.whatsNewScroll}>
          {newThreads.map(thread => (
            <ThreadCard
              key={thread.id}
              thread={thread}
              boardName={thread.boardName}
              boardId={thread.boardId}
              variant="horizontal"
            />
          ))}
          {newThreads.length === 0 && (
            <p className={styles.emptyState}>æ–°ã—ã„ã‚¹ãƒ¬ãƒƒãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
          )}
        </div>
      </section>

      {/* PICK UP */}
      <section className={`${styles.section} ${styles.pickUpSection}`}>
        <div className={styles.sectionHeader}>
          <h2 className={styles.sectionTitle}>PICK UP</h2>
          <p className={styles.sectionSub}>æ³¨ç›®ã®ã‚¹ãƒ¬ãƒƒãƒ‰</p>
        </div>
        <div className={styles.pickUpList}>
          {pickUpThreads.map(thread => (
            <ThreadCard
              key={thread.id}
              thread={thread}
              boardName={thread.boardName}
              boardId={thread.boardId}
              variant="list"
            />
          ))}
        </div>
      </section>

      {/* ã“ã‚“ãªã‚¹ãƒ¬ãƒƒãƒ‰ã‚‚ */}
      <section className={`${styles.section} ${styles.sectionLast}`}>
        <div className={styles.sectionHeader}>
          <h3 className={styles.discoverTitle}>ã“ã‚“ãªã‚¹ãƒ¬ãƒƒãƒ‰ã‚‚</h3>
          <p className={styles.sectionSub}>ã¾ã çŸ¥ã‚‰ãªã„ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ç™ºè¦‹</p>
        </div>
        <DiscoverSection
          allThreads={threadsForClient}
          excludeIds={usedIds}
        />
      </section>
    </main>
  );
}

================
File: src/components/DiscoverSection.tsx
================
'use client';

import { useEffect, useState, useMemo } from 'react';
import { ThreadSummary } from './ThreadCard';
import ThreadCard from './ThreadCard';
import styles from './DiscoverSection.module.css';

type ThreadWithBoard = ThreadSummary & { boardId: string; boardName: string };

interface DiscoverSectionProps {
    allThreads: ThreadWithBoard[];
    excludeIds: string[];
}

// LocalStorage key for browsing history
const HISTORY_KEY = 'nwww_board_history';
const MAX_HISTORY = 20;

function getBoardHistory(): string[] {
    if (typeof window === 'undefined') return [];
    try {
        const raw = localStorage.getItem(HISTORY_KEY);
        return raw ? JSON.parse(raw) : [];
    } catch {
        return [];
    }
}

export function recordBoardVisit(boardId: string) {
    if (typeof window === 'undefined') return;
    try {
        const history = getBoardHistory().filter(id => id !== boardId);
        history.unshift(boardId);
        localStorage.setItem(HISTORY_KEY, JSON.stringify(history.slice(0, MAX_HISTORY)));
    } catch {
        // ignore
    }
}

export default function DiscoverSection({ allThreads, excludeIds }: DiscoverSectionProps) {
    const threads = useMemo(() => {
        const excludeSet = new Set(excludeIds);
        const candidates = allThreads.filter(t => !excludeSet.has(t.id));
        const history = getBoardHistory();

        if (history.length === 0) {
            // No history: random shuffle
            const shuffled = [...candidates].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, 12);
        }

        // Score by board affinity: more recent visits = higher score
        const scored = candidates.map(t => {
            const idx = history.indexOf(t.boardId);
            // If board is in history, score based on recency (lower index = higher score)
            const affinityScore = idx >= 0 ? (MAX_HISTORY - idx) / MAX_HISTORY : 0;
            // Add randomness to avoid always showing the same threads
            const randomFactor = Math.random() * 0.3;
            return { thread: t, score: affinityScore + randomFactor };
        });

        scored.sort((a, b) => b.score - a.score);
        return scored.slice(0, 12).map(s => s.thread);
    }, [allThreads, excludeIds]);

    return (
        <div className={styles.list}>
            {threads.map(thread => (
                <ThreadCard
                    key={thread.id}
                    thread={thread}
                    boardName={thread.boardName}
                    boardId={thread.boardId}
                    variant="list"
                />
            ))}
            {threads.length === 0 && (
                <p className={styles.empty}>ã‚¹ãƒ¬ãƒƒãƒ‰ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            )}
        </div>
    );
}

================
File: src/components/NewThreadForm.tsx
================
'use client';

import { useState, useEffect } from 'react';
import { createPortal } from 'react-dom';
import { useRouter } from 'next/navigation';
import { createNewThread } from '@/app/actions';
import { Sparkles, X, Type, FileText, CheckCircle2, Loader2, Check } from 'lucide-react';
import styles from './NewThreadForm.module.css';

interface NewThreadFormProps {
    boardId: string;
    variant?: 'default' | 'primary';
}

export default function NewThreadForm({ boardId, variant = 'default' }: NewThreadFormProps) {
    const router = useRouter();
    const [title, setTitle] = useState('');
    const [content, setContent] = useState('');
    const [isSubmitting, setIsSubmitting] = useState(false);
    const [isOpen, setIsOpen] = useState(false);
    const [showSuccess, setShowSuccess] = useState(false);

    // AI Mode State
    const [mode, setMode] = useState<'manual' | 'ai'>('manual');
    const [aiUrl, setAiUrl] = useState('');
    const [result, setResult] = useState<{ threadId: string; boardId: string } | null>(null);
    const [error, setError] = useState<string | null>(null);

    const handleAiSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        if (!aiUrl) return;
        setIsSubmitting(true);
        setError(null);

        try {
            const res = await fetch('/api/thread/generate', {
                method: 'POST',
                body: JSON.stringify({
                    url: aiUrl,
                    website_url_verification: (e.currentTarget as HTMLFormElement).elements.namedItem('website_url_verification')?.valueOf()
                }),
                headers: { 'Content-Type': 'application/json' }
            });
            const data = await res.json();
            if (data.success) {
                setResult({ threadId: data.threadId, boardId: data.boardId || boardId });
                setTimeout(() => {
                    setAiUrl('');
                    setIsOpen(false);
                    setResult(null);
                    // AI might have picked a different board
                    router.push(`/${data.boardId || boardId}/${data.threadId}`);
                }, 1500);
            } else {
                setError(data.error || 'ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                setIsSubmitting(false);
            }
        } catch (e) {
            setError('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            setIsSubmitting(false);
        }
    };

    const handleClose = () => {
        setIsOpen(false);
        setAiUrl('');
        setResult(null);
        setError(null);
        setIsSubmitting(false);
        setTitle('');
        setContent('');
    };

    // Lock body scroll when modal is open
    useEffect(() => {
        if (isOpen) {
            document.body.style.overflow = 'hidden';
        } else {
            document.body.style.overflow = 'unset';
        }
        return () => {
            document.body.style.overflow = 'unset';
        };
    }, [isOpen]);

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        if (!title.trim() || !content.trim()) return;

        setIsSubmitting(true);

        const formData = new FormData();
        formData.append('boardId', boardId);
        formData.append('title', title);
        formData.append('content', content);

        const result = await createNewThread(formData);

        if (result.success && result.threadId) {
            setTitle('');
            setContent('');
            setIsOpen(false);
            setShowSuccess(true);

            // Wait for toast to be seen before redirecting
            setTimeout(() => {
                router.push(`/${boardId}/${result.threadId}`);
            }, 1000);
        } else {
            alert('ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            setIsSubmitting(false);
        }
    };

    // Auto-hide toast after delay (cleanup if component unmounts or to be safe)
    useEffect(() => {
        if (showSuccess) {
            const timer = setTimeout(() => setShowSuccess(false), 3000);
            return () => clearTimeout(timer);
        }
    }, [showSuccess]);

    if (!isOpen) {
        return (
            <>
                {showSuccess && (
                    <div className={styles.toast}>
                        <CheckCircle2 size={18} />
                        ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆã—ã¾ã—ãŸ
                    </div>
                )}
                <button
                    className={variant === 'primary' ? styles.primaryTriggerButton : styles.triggerButton}
                    onClick={() => setIsOpen(true)}
                >
                    æ–°è¦ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆ
                </button>
            </>
        );
    }

    return createPortal(
        <div className={styles.overlay} onClick={handleClose}>
            <div className={styles.modal} onClick={e => e.stopPropagation()}>
                {result ? (
                    <div className={styles.doneState}>
                        <div className={styles.doneIcon}><Check size={28} /></div>
                        <p className={styles.doneText}>ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆã—ã¾ã—ãŸï¼</p>
                        <p className={styles.doneSubtext}>
                            ç§»å‹•ä¸­...
                        </p>
                    </div>
                ) : isSubmitting && mode === 'ai' ? (
                    <div className={styles.processingState}>
                        <Loader2 size={32} className={styles.spinner} />
                        <p className={styles.processingText}>NWWWãŒè¨˜äº‹ã‚’åˆ†æã—ã€æœ€é©ãªæ¿ã‚’é¸å®šã—ã¦ã„ã¾ã™...</p>
                        <p className={styles.processingSub}>ã“ã‚Œã«ã¯æ•°ç§’ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™</p>
                    </div>
                ) : (
                    <>
                        <div className={styles.header}>
                            <div className={styles.titleArea}>
                                <h2 className={styles.title}>
                                    æ–°è¦ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆ
                                </h2>
                            </div>
                            <button className={styles.closeButton} onClick={handleClose}>
                                <X size={24} />
                            </button>
                        </div>

                        <div className={styles.tabs}>
                            <button
                                className={`${styles.tab} ${mode === 'manual' ? styles.activeTab : ''}`}
                                onClick={() => setMode('manual')}
                            >
                                <Type size={18} />
                                <span>è‡ªåˆ†ã§ä½œã‚‹</span>
                            </button>
                            <button
                                className={`${styles.tab} ${mode === 'ai' ? styles.activeTab : ''}`}
                                onClick={() => setMode('ai')}
                            >
                                <Sparkles size={18} />
                                <span>è¨˜äº‹ã‹ã‚‰è‡ªå‹•ã§ä½œã‚‹ (Beta)</span>
                            </button>
                        </div>

                        {mode === 'manual' ? (
                            <form onSubmit={handleSubmit} className={styles.form}>
                                <div className={styles.field}>
                                    <label className={styles.label}>
                                        <Type size={16} />
                                        ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¿ã‚¤ãƒˆãƒ«
                                    </label>
                                    <input
                                        type="text"
                                        className={styles.input}
                                        value={title}
                                        onChange={(e) => setTitle(e.target.value)}
                                        disabled={isSubmitting}
                                        placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥ã‚Œã¦ã­"
                                    />
                                </div>

                                <div className={styles.field}>
                                    <label className={styles.label}>
                                        <FileText size={16} />
                                        ã‚³ãƒ¡ãƒ³ãƒˆ
                                    </label>
                                    <textarea
                                        className={styles.textarea}
                                        value={content}
                                        onChange={(e) => setContent(e.target.value)}
                                        disabled={isSubmitting}
                                        rows={6}
                                        placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã„ã¦ã­"
                                    />
                                </div>

                                {/* Honeypot field for anti-spam (invisible to users) */}
                                <div style={{ display: 'none' }} aria-hidden="true">
                                    <input
                                        type="text"
                                        name="website_url_verification"
                                        autoComplete="off"
                                        tabIndex={-1}
                                    />
                                </div>

                                <div className={styles.actions}>
                                    <button
                                        type="button"
                                        className={styles.cancelButton}
                                        onClick={handleClose}
                                        disabled={isSubmitting}
                                    >
                                        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                    </button>
                                    <button
                                        type="submit"
                                        className={styles.submitButton}
                                        disabled={isSubmitting || !title.trim() || !content.trim()}
                                    >
                                        {isSubmitting ? 'ä½œæˆä¸­...' : 'ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆ'}
                                    </button>
                                </div>
                            </form>
                        ) : (
                            <form onSubmit={handleAiSubmit} className={styles.form}>
                                <div className={styles.field}>
                                    <label className={styles.label}>
                                        <Sparkles size={16} />
                                        è¨˜äº‹ã‚„ãƒã‚¹ãƒˆã®URL
                                    </label>
                                    <input
                                        type="url"
                                        className={styles.input}
                                        value={aiUrl}
                                        onChange={(e) => setAiUrl(e.target.value)}
                                        disabled={isSubmitting}
                                        placeholder="https://example.com/news/..."
                                        required
                                    />
                                    <p className={styles.helperText}>
                                        URLå…ˆã®å†…å®¹ã‚’NWWWãŒåˆ†æã—ã¦ã€é©åˆ‡ãªæ¿ã«ã‚¹ãƒ¬ç«‹ã¦ã—ã¾ã™ã€‚
                                    </p>
                                    {error && (
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '6px', color: '#ef4444', marginTop: '8px', fontSize: '0.85rem' }}>
                                            <CheckCircle2 size={16} style={{ color: '#ef4444' }} /> {/* Reusing CheckCircle2 for now or X */}
                                            <span>{error}</span>
                                        </div>
                                    )}
                                </div>

                                <div className={styles.actions}>
                                    <button
                                        type="button"
                                        className={styles.cancelButton}
                                        onClick={handleClose}
                                        disabled={isSubmitting}
                                    >
                                        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                    </button>
                                    <button
                                        type="submit"
                                        className={styles.submitButtonAi}
                                        disabled={isSubmitting || !aiUrl.trim()}
                                    >
                                        <Sparkles size={18} />
                                        {isSubmitting ? 'NWWWãŒç”Ÿæˆä¸­...' : 'è¨˜äº‹ã‹ã‚‰ä½œæˆ'}
                                    </button>
                                </div>
                            </form>
                        )}
                    </>
                )}
            </div>
        </div>,
        document.body
    );
}

================
File: src/components/ThreadCard.tsx
================
import Link from 'next/link';
import { Thread } from '@/data/mockBBS';
import styles from './ThreadCard.module.css';
import { getRelativeTime } from '@/utils/time';
import { Clock } from 'lucide-react';

export interface ThreadSummary {
    id: string;
    title: string;
    postCount: number;
    lastUpdated: string;
    createdAt?: string;
    status?: string;
    aiSummary?: string | null;
}

interface ThreadCardProps {
    thread: ThreadSummary;
    boardName: string;
    boardId: string;
    variant?: 'horizontal' | 'grid' | 'list';
}

export default function ThreadCard({ thread, boardName, boardId, variant = 'grid' }: ThreadCardProps) {
    const isGrid = variant === 'grid';

    // â”€â”€â”€ List Variant â”€â”€â”€
    if (variant === 'list') {
        return (
            <Link
                href={`/${boardId}/${thread.id}`}
                className={styles.listItem}
            >
                {/* Title */}
                <h4 className={styles.listTitle}>
                    {thread.title}
                </h4>
                {/* Meta Row */}
                <div className={styles.listMeta}>
                    <div className={styles.listMetaLeft}>
                        <span className={styles.listBoardName}>{boardName}</span>
                        <span className={styles.listSeparator}>â€¢</span>
                        <div className={styles.listTimeWrapper}>
                            <Clock size={12} />
                            <span>{getRelativeTime(thread.lastUpdated)}</span>
                        </div>
                    </div>
                    <div className={styles.listCommentStats}>
                        <span className={styles.listCommentCount}>{thread.postCount}</span>
                        <span className={styles.listCommentLabel}>ã‚³ãƒ¡ãƒ³ãƒˆ</span>
                    </div>
                </div>
            </Link>
        );
    }

    // â”€â”€â”€ Card Variants (horizontal / grid) â”€â”€â”€
    return (
        <Link
            href={`/${boardId}/${thread.id}`}
            className={`${styles.card} ${variant === 'horizontal' ? styles.horizontal : styles.grid}`}
        >
            {/* Meta Info */}
            <div className={styles.meta}>
                <span className={styles.boardName}>{boardName}</span>
                <span className={styles.separator}>â€¢</span>
                <div className={styles.timeWrapper}>
                    <Clock size={12} />
                    <span>{getRelativeTime(thread.lastUpdated)}</span>
                </div>
            </div>

            {/* Title */}
            <h3 className={`${styles.title} ${styles.lineClamp2} ${isGrid ? styles.titleGrid : ''} ${variant === 'horizontal' ? styles.horizontalTitle : ''}`}>
                {thread.title}
            </h3>


            {/* Stats - Comment count emphasis for grid cards */}
            {isGrid && (
                <div className={styles.stats}>
                    <span className={styles.commentCount}>{thread.postCount}</span>
                    <span className={styles.commentLabel}>ã‚³ãƒ¡ãƒ³ãƒˆ</span>
                </div>
            )}
        </Link>
    );
}

================
File: src/components/ThreadSummarizer.tsx
================
'use client';

import { useState, useEffect } from 'react';
import styles from './ThreadSummarizer.module.css';

// Auto-summarize thresholds
const SUMMARY_THRESHOLDS = [20, 50, 100, 200, 500];

interface ThreadSummarizerProps {
    threadId: string;
    initialSummary?: string | null;
    postCount: number;
}

export default function ThreadSummarizer({ threadId, initialSummary, postCount }: ThreadSummarizerProps) {
    const [summary, setSummary] = useState<string | null>(initialSummary || null);
    const [isLoading, setIsLoading] = useState(false);
    const [isOpen, setIsOpen] = useState(false);
    const [error, setError] = useState<string | null>(null);

    // Auto-trigger summarization when postCount hits a threshold
    useEffect(() => {
        if (postCount < 20) return; // Don't summarize below 20

        const shouldAutoSummarize = SUMMARY_THRESHOLDS.some(threshold =>
            postCount >= threshold && postCount < threshold + 5 // Within 5 posts of threshold
        );

        if (shouldAutoSummarize && !summary && !isLoading) {
            handleSummarize();
        }
    }, [postCount]);

    const handleSummarize = async () => {
        setIsLoading(true);
        setError(null);

        try {
            const res = await fetch('/api/thread/summarize', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ threadId }),
            });

            if (!res.ok) {
                const data = await res.json();
                throw new Error(data.error || 'Failed to summarize');
            }

            const data = await res.json();
            setSummary(data.summary);
            setIsOpen(true);
        } catch (err: any) {
            console.error('Summarization error:', err);
            setError(err.message || 'è¦ç´„ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        } finally {
            setIsLoading(false);
        }
    };

    // Don't render at all if less than 20 posts
    if (postCount < 20) {
        return null;
    }

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <h3 className={styles.title}>NWWWè¦ç´„ (3-Line Summary)</h3>
                <span className={styles.postCountBadge}>{postCount}ãƒ¬ã‚¹</span>
            </div>

            {/* Error State */}
            {error && (
                <div className={styles.action}>
                    <p className={styles.errorText}>{error}</p>
                    <button onClick={handleSummarize} className={styles.button}>
                        å†è©¦è¡Œ
                    </button>
                </div>
            )}

            {/* No summary yet â€” offer to generate */}
            {!summary && !isLoading && !error && (
                <div className={styles.action}>
                    <p className={styles.description}>
                        {postCount}ä»¶ã®ãƒ¬ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚<br />
                        NWWWã§è­°è«–ã®è¦ç‚¹ã‚’3è¡Œã«è¦ç´„ã—ã¾ã™ã€‚
                    </p>
                    <button onClick={handleSummarize} className={styles.button}>
                        è¦ç´„ã‚’ç”Ÿæˆã™ã‚‹
                    </button>
                </div>
            )}

            {/* Summary exists but collapsed */}
            {summary && !isOpen && !isLoading && (
                <div className={styles.action}>
                    <p className={styles.description}>
                        NWWWã«ã‚ˆã‚‹3è¡Œè¦ç´„ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚
                    </p>
                    <button onClick={() => setIsOpen(true)} className={styles.button}>
                        è¦ç´„ã‚’è¡¨ç¤ºã™ã‚‹
                    </button>
                </div>
            )}

            {/* Loading */}
            {isLoading && (
                <div className={styles.loading}>
                    <div className={styles.spinner}></div>
                    <p>NWWWãŒã‚¹ãƒ¬ãƒƒãƒ‰ã‚’åˆ†æä¸­...</p>
                </div>
            )}

            {/* Summary open */}
            {summary && isOpen && (
                <div className={styles.result}>
                    <ul className={styles.summaryList}>
                        {summary.split('\n').filter(line => line.trim()).map((line, index) => (
                            <li key={index} className={styles.summaryItem}>{line}</li>
                        ))}
                    </ul>
                    <div className={styles.meta}>
                        Generated by NWWW AI â€¢ {postCount}ãƒ¬ã‚¹æ™‚ç‚¹
                    </div>
                    <div className={styles.actions}>
                        <button onClick={handleSummarize} className={styles.refreshButton} disabled={isLoading}>
                            ğŸ”„ æœ€æ–°ã®è¦ç´„ã«æ›´æ–°
                        </button>
                        <button onClick={() => setIsOpen(false)} className={styles.closeButton}>
                            é–‰ã˜ã‚‹
                        </button>
                    </div>
                </div>
            )}
        </div>
    );
}

================
File: src/data/mockBBS.ts
================
export interface Post {
    id: string;
    author: string;
    content: string;
    createdAt: string;
    userId?: string; // Anonymous ID
    likes: number;
    status?: string;
}

export interface Thread {
    id: string;
    title: string;
    lastUpdated: string;
    postCount: number;
    views: number;
    tags: string[]; // Added tags
    aiSummary?: string | null;
    aiAnalysis?: string | null;
    isAiGenerated?: boolean;
    sourceUrl?: string | null;
    sourceTitle?: string | null;
    sourcePlatform?: string | null;
    posts: Post[];
    // Growth & Selection fields
    createdAt: string;
    momentum: number;
    status: string;
}

export interface Board {
    id: string;
    name: string;
    description: string;
    category: string;
    threads: Thread[];
}

export let MOCK_BOARDS: Board[] = [
    // --- ãƒ©ã‚¦ãƒ³ã‚¸ ---
    {
        id: "lounge-live",
        name: "ãªã‚“ã§ã‚‚å®Ÿæ³",
        description: "ä»Šèµ·ãã¦ã„ã‚‹ã“ã¨ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã€‚",
        category: "ãƒ©ã‚¦ãƒ³ã‚¸",
        threads: [
            {
                id: "thread-live-1",
                title: "ã€é€Ÿå ±ã€‘å††å®‰ã€ã¤ã„ã«1ãƒ‰ãƒ«160å††çªç ´ã‹ï¼ï¼Ÿ 34",
                lastUpdated: "2026-02-15T23:45:00",
                postCount: 452,
                views: 5200,
                tags: ["Economy", "Live"],
                createdAt: "2026-02-15T20:00:00",
                momentum: 1200,
                status: 'active',
                posts: [
                    {
                        id: "post-live-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ã†ã‚ã‚ã‚ã‚ã‚ã‚ã‚ã‚é€ã£ãŸã‚ã‚ã‚ã‚ã‚ã‚ã‚ã‚ã‚ã‚",
                        createdAt: "2026-02-15T23:45:00",
                        likes: 0,
                        status: 'active',
                    }
                ],
            }
        ],
    },
    {
        id: "lounge-chat",
        name: "ãªã‚“ã§ã‚‚é›‘è«‡",
        description: "æ—¥å¸¸ã®è©±é¡Œã€æš‡ã¤ã¶ã—ã€‚",
        category: "ãƒ©ã‚¦ãƒ³ã‚¸",
        threads: [
            {
                id: "thread-chat-1",
                title: "ãŠå‰ã‚‰ã®é»’æ­´å²æ™’ã—ã¦ã„ã‘ï½—ï½—ï½—",
                lastUpdated: "2026-02-15T22:10:00",
                postCount: 128,
                views: 3400,
                tags: ["Chat", "Funny"],
                createdAt: "2026-02-15T18:00:00",
                momentum: 500,
                status: 'active',
                posts: [
                    {
                        id: "post-chat-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ä¸­äºŒç—…æ™‚ä»£ã®ãƒãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã£ãŸã‚“ã ãŒã€æ­»ã«ãŸã„",
                        createdAt: "2026-02-15T18:00:00",
                        likes: 15,
                        status: 'active',
                    }
                ],
            },
            {
                id: "thread-chat-2",
                title: "æœ€è¿‘ã®AIé€²åŒ–ã—ã™ããƒ¯ãƒ­ã‚¿ï½—ï½—ï½— æœªæ¥ã©ã†ãªã‚‹ã‚“ï¼Ÿ",
                lastUpdated: "2026-02-15T21:00:00",
                postCount: 85,
                views: 2100,
                tags: ["AI", "Tech"],
                createdAt: "2026-02-14T15:00:00",
                momentum: 300,
                status: 'active',
                posts: [
                    {
                        id: "post-chat-2",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ã‚‚ã†ä¿ºã‚‰ã®ä»•äº‹ãªããªã‚‹ã‚“ã˜ã‚ƒã­ï¼Ÿãƒã‚¸ã§ã€‚",
                        createdAt: "2026-02-14T15:00:00",
                        likes: 8,
                        status: 'active',
                    }
                ],
            }
        ],
    },
    {
        id: "lounge-qa",
        name: "ãªã‚“ã§ã‚‚çŸ¥æµè¢‹",
        description: "è³ªå•ã€ç›¸è«‡ã€çŸ¥æµã®å…±æœ‰ã€‚",
        category: "ãƒ©ã‚¦ãƒ³ã‚¸",
        threads: [
            {
                id: "thread-qa-1",
                title: "ã€è‡³æ€¥ã€‘å½¼å¥³ã¸ã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã€äºˆç®—3ä¸‡ã§ä½•ãŒã„ã„ï¼Ÿ",
                lastUpdated: "2026-02-15T19:30:00",
                postCount: 42,
                views: 1200,
                tags: ["Love", "Advice"],
                createdAt: "2026-02-15T10:00:00",
                momentum: 120,
                status: 'active',
                posts: [
                    {
                        id: "post-qa-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ä»˜ãåˆã£ã¦3ãƒ¶æœˆã€‚20ä»£å¾ŒåŠã§ã™ã€‚ã‚¢ã‚¯ã‚»ã‹ï¼Ÿã‚³ã‚¹ãƒ¡ã‹ï¼Ÿ",
                        createdAt: "2026-02-15T10:00:00",
                        likes: 3,
                        status: 'active',
                    }
                ],
            }
        ],
    },

    // --- ç¤¾ä¼šãƒ»ãƒ‹ãƒ¥ãƒ¼ã‚¹ ---
    {
        id: "news-global",
        name: "å›½éš›ãƒ‹ãƒ¥ãƒ¼ã‚¹",
        description: "ä¸–ç•Œæƒ…å‹¢ã€ç´›äº‰ã€å¤–äº¤ã€‚",
        category: "ç¤¾ä¼šãƒ»ãƒ‹ãƒ¥ãƒ¼ã‚¹",
        threads: [
            {
                id: "thread-news-global-1",
                title: "ã€ç±³å›½ã€‘æ¬¡æœŸå¤§çµ±é ˜é¸ã€æ¿€æˆ¦å·ã§æ¥æˆ¦ç¶šã ä¸–è«–èª¿æŸ»",
                lastUpdated: "2026-02-15T14:00:00",
                postCount: 230,
                views: 8900,
                tags: ["Politics", "US"],
                createdAt: "2026-02-15T08:00:00",
                momentum: 600,
                status: 'active',
                posts: [
                    {
                        id: "post-news-g-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ã©ã£ã¡ãŒå‹ã£ã¦ã‚‚æ··ä¹±ã—ãã†ã ãªã“ã‚Œ",
                        createdAt: "2026-02-15T08:00:00",
                        likes: 12,
                    }
                ],
            }
        ],
    },
    {
        id: "news-domestic",
        name: "å›½å†…ãƒ‹ãƒ¥ãƒ¼ã‚¹",
        description: "æ”¿æ²»ã€äº‹ä»¶ã€ç½å®³æƒ…å ±ã€‚",
        category: "ç¤¾ä¼šãƒ»ãƒ‹ãƒ¥ãƒ¼ã‚¹",
        threads: [
            {
                id: "thread-news-dom-1",
                title: "ã€æ°—è±¡ã€‘å°é¢¨7å·ã€é€±æœ«ã«é–¢æ±ç›´æ’ƒã®æã‚Œ å³é‡è­¦æˆ’ã‚’",
                lastUpdated: "2026-02-15T16:00:00",
                postCount: 156,
                views: 12000,
                tags: ["Weather", "Disaster"],
                createdAt: "2026-02-15T07:00:00",
                momentum: 800,
                status: 'active',
                posts: [
                    {
                        id: "post-news-d-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ã¾ãŸé€±æœ«ã‹ã‚ˆ...ã‚³ãƒ­ãƒƒã‚±è²·ã£ã¦ãã‚‹ã‚",
                        createdAt: "2026-02-15T07:00:00",
                        likes: 45,
                    }
                ],
            }
        ],
    },
    {
        id: "news-politics",
        name: "æ”¿æ²»ãƒ»çµŒæ¸ˆ",
        description: "æ”¿ç­–è­°è«–ã€æ ªä¾¡å‹•å‘ã€çµŒæ¸ˆã€‚",
        category: "ç¤¾ä¼šãƒ»ãƒ‹ãƒ¥ãƒ¼ã‚¹",
        threads: [
            {
                id: "thread-news-1",
                title: "ã€è­°è«–ã€‘ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ã‚¤ãƒ³ã‚«ãƒ ã¯æ—¥æœ¬ã§å°å…¥å¯èƒ½ãªã®ã‹è­°è«–ã™ã‚‹ã‚¹ãƒ¬",
                lastUpdated: "2026-02-14T13:00:00",
                postCount: 89,
                views: 1250,
                tags: ["Economy", "Society"],
                aiSummary: "è²¡æºã®å•é¡Œã¨åŠ´åƒæ„æ¬²ã¸ã®å½±éŸ¿ãŒä¸»ãªè«–ç‚¹ã€‚AIã«ã‚ˆã‚‹è‡ªå‹•åŒ–ãŒé€²ã‚€ä¸­ã§å¿…é ˆã«ãªã‚‹ã¨ã„ã†æ„è¦‹ã‚‚ã€‚",
                createdAt: "2026-02-13T10:00:00",
                momentum: 80,
                status: 'active',
                posts: [],
            }
        ],
    },
    {
        id: "news-media",
        name: "ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ»ãƒãƒƒãƒˆ",
        description: "ãƒã‚¹ã‚³ãƒŸå ±é“ã€SNSãƒˆãƒ¬ãƒ³ãƒ‰ã€ç‚ä¸Šæ¡ˆä»¶ã€‚",
        category: "ç¤¾ä¼šãƒ»ãƒ‹ãƒ¥ãƒ¼ã‚¹",
        threads: [],
    },
    {
        id: "news-local",
        name: "åœ°åŸŸãƒ»è¡—",
        description: "åœ°å…ƒã®è©±é¡Œã€ç§»ä½ã€ç”ºãŠã“ã—ã€‚",
        category: "ç¤¾ä¼šãƒ»ãƒ‹ãƒ¥ãƒ¼ã‚¹",
        threads: [],
    },

    // --- ã‚­ãƒ£ãƒªã‚¢ãƒ»ãƒ“ã‚¸ãƒã‚¹ ---
    {
        id: "biz-startup",
        name: "ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—",
        description: "èµ·æ¥­ã€ãƒ™ãƒ³ãƒãƒ£ãƒ¼ã€è³‡é‡‘èª¿é”ã€‚",
        category: "ã‚­ãƒ£ãƒªã‚¢ãƒ»ãƒ“ã‚¸ãƒã‚¹",
        threads: [
            {
                id: "thread-startup-1",
                title: "ã‚·ãƒ¼ãƒ‰æœŸã§1å„„èª¿é”ã—ãŸã‘ã©è³ªå•ã‚ã‚‹ï¼Ÿ",
                lastUpdated: "2026-02-14T19:00:00",
                postCount: 56,
                views: 2300,
                tags: ["Startup", "Finance"],
                createdAt: "2026-02-14T10:00:00",
                momentum: 150,
                status: 'active',
                posts: [
                    {
                        id: "post-startup-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "VCã¨ã®äº¤æ¸‰ãƒã‚¸ã§ç–²ã‚ŒãŸã‚ã€‚ç‰¹å®šé¿ã‘ã¦ç­”ãˆã‚‹ã€‚",
                        createdAt: "2026-02-14T10:00:00",
                        likes: 20,
                    }
                ],
            }
        ],
    },
    {
        id: "biz-career",
        name: "ä»•äº‹ãƒ»ã‚­ãƒ£ãƒªã‚¢",
        description: "å°±è·ã€è»¢è·ã€åƒãæ–¹ã€‚",
        category: "ã‚­ãƒ£ãƒªã‚¢ãƒ»ãƒ“ã‚¸ãƒã‚¹",
        threads: [
            {
                id: "thread-life-1",
                title: "30ä»£å¾ŒåŠã§ç•°æ¥­ç¨®è»¢è·ã—ãŸäººã®ä½“é¨“è«‡ã‚’èããŸã„",
                lastUpdated: "2026-02-14T12:30:00",
                postCount: 34,
                views: 562,
                tags: ["Career", "JobChange"],
                createdAt: "2026-02-14T09:00:00",
                momentum: 230,
                status: 'active',
                posts: [],
            }
        ],
    },
    {
        id: "biz-sidehustle",
        name: "å‰¯æ¥­",
        description: "å‰¯æ¥­ã€è¤‡æ¥­ã€ã‚¹ã‚­ãƒ«ã‚·ã‚§ã‚¢ã€‚",
        category: "ã‚­ãƒ£ãƒªã‚¢ãƒ»ãƒ“ã‚¸ãƒã‚¹",
        threads: [],
    },

    // --- ãƒãƒãƒ¼ãƒ»è³‡ç”£å½¢æˆ ---
    {
        id: "money-stock",
        name: "æ ªãƒ»æŠ•è³‡",
        description: "æ—¥æœ¬æ ªã€ç±³å›½æ ªã€NISAã€iDeCoã€‚",
        category: "ãƒãƒãƒ¼ãƒ»è³‡ç”£å½¢æˆ",
        threads: [
            {
                id: "thread-stock-1",
                title: "ã€S&P500ã€‘ç±³å›½æ ªæŠ•è³‡ä¿¡è¨—ã‚¹ãƒ¬ Part153",
                lastUpdated: "2026-02-15T22:30:00",
                postCount: 980,
                views: 15000,
                tags: ["Money", "Stock"],
                createdAt: "2026-02-10T11:00:00",
                momentum: 200,
                status: 'active',
                posts: [
                    {
                        id: "post-stock-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "çµå±€ã‚ªãƒ«ã‚«ãƒ³ã¨S&Pã©ã£ã¡ãŒã„ã„ã‚“ã ã‚ˆ",
                        createdAt: "2026-02-10T11:00:00",
                        likes: 5,
                    }
                ],
            }
        ],
    },
    {
        id: "money-crypto",
        name: "ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ãƒ»ä»®æƒ³é€šè²¨",
        description: "BTCã€ETHã€ã‚¢ãƒ«ãƒˆã‚³ã‚¤ãƒ³ã€Web3ã€‚",
        category: "ãƒãƒãƒ¼ãƒ»è³‡ç”£å½¢æˆ",
        threads: [
            {
                id: "thread-crypto-1",
                title: "ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³10ä¸‡ãƒ‰ãƒ«ç›®å‰ï¼ãŠå‰ã‚‰ã¾ã è²·ã£ã¦ãªã„ã®ï¼Ÿï½—ï½—",
                lastUpdated: "2026-02-15T23:00:00",
                postCount: 340,
                views: 6700,
                tags: ["Crypto", "BTC"],
                createdAt: "2026-02-15T12:00:00",
                momentum: 800,
                status: 'active',
                posts: [
                    {
                        id: "post-crypto-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "é´ç£¨ãã®å°‘å¹´ãŒã©ã†ã¨ã‹è¨€ã£ã¦ãŸå¥´æ¯ã—ã¦ã‚‹ï¼Ÿ",
                        createdAt: "2026-02-15T12:00:00",
                        likes: 12,
                    }
                ],
            }
        ],
    },

    // --- ã‚¦ã‚§ãƒ«ãƒ“ãƒ¼ã‚¤ãƒ³ã‚° ---
    {
        id: "well-relationship",
        name: "æ‹æ„›ãƒ»äººé–“é–¢ä¿‚",
        description: "æ‹æ„›ã€çµå©šã€å®¶æ—ã€äººé–“é–¢ä¿‚ã€‚",
        category: "ã‚¦ã‚§ãƒ«ãƒ“ãƒ¼ã‚¤ãƒ³ã‚°",
        threads: [
            {
                id: "thread-rel-1",
                title: "ä¸Šå¸ãŒã‚¦ã‚¶ã™ãã¦ä¼šç¤¾è¾ã‚ãŸã„ã‚“ã ãŒ",
                lastUpdated: "2026-02-15T20:15:00",
                postCount: 23,
                views: 500,
                tags: ["Work", "Stress"],
                createdAt: "2026-02-15T15:00:00",
                momentum: 40,
                status: 'active',
                posts: [
                    {
                        id: "post-rel-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "æ¯æœæŒ¨æ‹¶ã—ã¦ã‚‚ç„¡è¦–ã•ã‚Œã‚‹ã€‚ã“ã‚Œãƒ‘ãƒ¯ãƒãƒ©ã˜ã‚ƒã­ï¼Ÿ",
                        createdAt: "2026-02-15T15:00:00",
                        likes: 3,
                    }
                ],
            }
        ],
    },
    {
        id: "well-health",
        name: "ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ»å¥åº·",
        description: "ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ã€ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã€å¥åº·æ³•ã€‚",
        category: "ã‚¦ã‚§ãƒ«ãƒ“ãƒ¼ã‚¤ãƒ³ã‚°",
        threads: [],
    },

    // --- ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ« ---
    {
        id: "life-shopping",
        name: "è²·ã„ç‰©",
        description: "ãŠã™ã™ã‚å•†å“ã€ã‚»ãƒ¼ãƒ«æƒ…å ±ã€‚",
        category: "ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«",
        threads: [],
    },
    {
        id: "life-food",
        name: "æ–™ç†ãƒ»é£Ÿã¹ç‰©",
        description: "ãƒ¬ã‚·ãƒ”ã€ã‚°ãƒ«ãƒ¡ã€é£²é£Ÿåº—ã€‚",
        category: "ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«",
        threads: [
            {
                id: "thread-food-1",
                title: "æœ€å¼·ã®å¤œé£Ÿæ±ºå®šæˆ¦",
                lastUpdated: "2026-02-15T23:30:00",
                postCount: 88,
                views: 1500,
                tags: ["Food", "LateNight"],
                createdAt: "2026-02-15T21:00:00",
                momentum: 200,
                status: 'active',
                posts: [
                    {
                        id: "post-food-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ã‚«ãƒƒãƒ—ãƒŒãƒ¼ãƒ‰ãƒ«ã‚«ãƒ¬ãƒ¼å‘³ä¸€æŠã ã‚",
                        createdAt: "2026-02-15T21:00:00",
                        likes: 10,
                    }
                ],
            }
        ],
    },
    {
        id: "life-diy",
        name: "DIY",
        description: "æ—¥æ›œå¤§å·¥ã€ãƒãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ‰ã€‚",
        category: "ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«",
        threads: [],
    },
    {
        id: "life-interior",
        name: "ã‚¤ãƒ³ãƒ†ãƒªã‚¢",
        description: "å®¶å…·ã€éƒ¨å±‹ä½œã‚Šã€åç´ã€‚",
        category: "ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«",
        threads: [],
    },
    {
        id: "life-fashion",
        name: "ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³",
        description: "ãƒ¡ãƒ³ã‚ºã€ãƒ¬ãƒ‡ã‚£ãƒ¼ã‚¹ã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒãƒ¼ãƒˆã€‚",
        category: "ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«",
        threads: [],
    },
    {
        id: "life-pet",
        name: "ãƒšãƒƒãƒˆãƒ»å‹•ç‰©",
        description: "çŠ¬ã€çŒ«ã€å°å‹•ç‰©ã€ã‚¢ã‚¯ã‚¢ãƒªã‚¦ãƒ ã€‚",
        category: "ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«",
        threads: [],
    },
    {
        id: "life-parenting",
        name: "å­è‚²ã¦",
        description: "è‚²å…ã€æ•™è‚²ã€å­ä¾›ã®æˆé•·ã€‚",
        category: "ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«",
        threads: [],
    },
    {
        id: "life-school",
        name: "å­¦æ ¡ç”Ÿæ´»",
        description: "å­¦ç”Ÿç”Ÿæ´»ã€éƒ¨æ´»ã€å‹‰å¼·ã€‚",
        category: "ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«",
        threads: [],
    },
    {
        id: "life-travel",
        name: "æ—…è¡Œ",
        description: "å›½å†…æ—…è¡Œã€æµ·å¤–æ—…è¡Œã€è¦³å…‰åœ°ã€‚",
        category: "ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«",
        threads: [
            {
                id: "thread-travel-1",
                title: "åŒ—æµ·é“ä¸€äººæ—…ã«è¡Œãã‚“ã ã‘ã©ãŠã™ã™ã‚ã‚ã‚‹ï¼Ÿ",
                lastUpdated: "2026-02-14T22:00:00",
                postCount: 65,
                views: 1200,
                tags: ["Travel", "Solo"],
                createdAt: "2026-02-14T10:00:00",
                momentum: 50,
                status: 'active',
                posts: [
                    {
                        id: "post-travel-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "æœ­å¹Œã€å°æ¨½ã‚ãŸã‚Šã§ç¾å‘³ã„å¯¿å¸å±‹æ•™ãˆã¦ãã‚Œ",
                        createdAt: "2026-02-14T10:00:00",
                        likes: 4,
                    }
                ],
            }
        ],
    },
    {
        id: "life-car",
        name: "è»Š",
        description: "è‡ªå‹•è»Šã€ãƒ‰ãƒ©ã‚¤ãƒ–ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€‚",
        category: "ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«",
        threads: [],
    },
    {
        id: "life-bike",
        name: "ãƒã‚¤ã‚¯",
        description: "ãƒ„ãƒ¼ãƒªãƒ³ã‚°ã€ã‚«ã‚¹ã‚¿ãƒ ã€äºŒè¼ªã€‚",
        category: "ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«",
        threads: [],
    },

    // --- ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ ---
    {
        id: "tech-ai",
        name: "AI",
        description: "ç”ŸæˆAIã€LLMã€æ©Ÿæ¢°å­¦ç¿’ã€‚",
        category: "ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼",
        threads: [
            {
                id: "thread-ai-1",
                title: "GPT-5å¾…æ©Ÿã‚¹ãƒ¬ part3",
                lastUpdated: "2026-02-15T22:00:00",
                postCount: 890,
                views: 12000,
                tags: ["AI", "GPT"],
                createdAt: "2026-02-10T00:00:00",
                momentum: 500,
                status: 'active',
                posts: [
                    {
                        id: "post-ai-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ã„ã¤æ¥ã‚‹ã‚“ã ã‚ˆ...å¾…ã¡ããŸã³ã‚ŒãŸ",
                        createdAt: "2026-02-10T00:00:00",
                        likes: 4,
                    }
                ],
            },
            {
                id: "thread-ai-2",
                title: "ç”»åƒç”ŸæˆAIã§æ¶ç©ºã®ã‚¢ã‚¤ãƒ‰ãƒ«ä½œã£ãŸã‹ã‚‰è¦‹ã¦",
                lastUpdated: "2026-02-15T21:40:00",
                postCount: 45,
                views: 3200,
                tags: ["AI", "Art"],
                createdAt: "2026-02-15T18:00:00",
                momentum: 200,
                status: 'active',
                posts: [
                    {
                        id: "post-ai-2",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ï¼ˆç”»åƒç•¥ï¼‰ã©ã†ï¼Ÿã‚‚ã£ã¨ã„ã‘ã‚‹ï¼Ÿ",
                        createdAt: "2026-02-15T18:00:00",
                        likes: 12,
                    }
                ],
            }
        ],
    },
    {
        id: "tech-app",
        name: "ã‚¢ãƒ—ãƒªãƒ»ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢",
        description: "PCã‚½ãƒ•ãƒˆã€ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªã€Webã‚µãƒ¼ãƒ“ã‚¹ã€‚",
        category: "ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼",
        threads: [],
    },
    {
        id: "tech-dev",
        name: "ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆé–‹ç™º",
        description: "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€é–‹ç™ºæ‰‹æ³•ã€UI/UXã€‚",
        category: "ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼",
        threads: [],
    },
    {
        id: "tech-home-elec",
        name: "å®¶é›»",
        description: "ç™½ç‰©å®¶é›»ã€é»’ç‰©å®¶é›»ã€æœ€æ–°å®¶é›»ã€‚",
        category: "ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼",
        threads: [],
    },
    {
        id: "tech-pc-mobile",
        name: "ã‚¹ãƒãƒ›ãƒ»ãƒ‘ã‚½ã‚³ãƒ³",
        description: "iPhoneã€Androidã€Macã€è‡ªä½œPCã€‚",
        category: "ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼",
        threads: [
            {
                id: "thread-pc-1",
                title: "iPhone 18 ãƒªãƒ¼ã‚¯æƒ…å ±ã¾ã¨ã‚",
                lastUpdated: "2026-02-15T15:00:00",
                postCount: 120,
                views: 5600,
                tags: ["iPhone", "Apple"],
                createdAt: "2026-02-14T10:00:00",
                momentum: 300,
                status: 'active',
                posts: [
                    {
                        id: "post-pc-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ã‚«ãƒ¡ãƒ©ãŒã•ã‚‰ã«å‡ºã£å¼µã‚‹ã‚‰ã—ã„ã",
                        createdAt: "2026-02-14T10:00:00",
                        likes: 8,
                    }
                ],
            }
        ],
    },
    {
        id: "tech-gadget",
        name: "ã‚¬ã‚¸ã‚§ãƒƒãƒˆ",
        description: "ã‚¦ã‚§ã‚¢ãƒ©ãƒ–ãƒ«ã€ã‚«ãƒ¡ãƒ©ã€é›»å­æ©Ÿå™¨ã€‚",
        category: "ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼",
        threads: [],
    },
    {
        id: "tech-science",
        name: "ç§‘å­¦æŠ€è¡“",
        description: "æœ€æ–°æŠ€è¡“ã€å®‡å®™ã€ãƒ­ãƒœãƒƒãƒˆã€‚",
        category: "ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼",
        threads: [],
    },

    // --- å‹•ç”»ãƒ»ã‚½ãƒ¼ã‚·ãƒ£ãƒ« ---
    {
        id: "social-youtube",
        name: "YouTubeãƒ»å‹•ç”»",
        description: "YouTuberã€å‹•ç”»åˆ¶ä½œã€‚",
        category: "å‹•ç”»ãƒ»ã‚½ãƒ¼ã‚·ãƒ£ãƒ«",
        threads: [
            {
                id: "thread-youtube-1",
                title: "ã€æ‚²å ±ã€‘æŸå¤§ç‰©Youtuberã€æ´»å‹•ä¼‘æ­¢ã‚’ç™ºè¡¨",
                lastUpdated: "2026-02-15T20:00:00",
                postCount: 560,
                views: 24000,
                tags: ["YouTube", "Gossip"],
                createdAt: "2026-02-15T12:00:00",
                momentum: 1500,
                status: 'active',
                posts: [
                    {
                        id: "post-yt-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ãƒã‚¸ã‹ã‚ˆ...ã‚·ãƒ§ãƒƒã‚¯ã§å¯è¾¼ã‚€ã‚",
                        createdAt: "2026-02-15T12:00:00",
                        likes: 54,
                    }
                ],
            }
        ],
    },
    {
        id: "social-vtuber",
        name: "VTuberãƒ»é…ä¿¡è€…",
        description: "ãƒãƒ¼ãƒãƒ£ãƒ«YouTuberã€ã‚¹ãƒˆãƒªãƒ¼ãƒãƒ¼ã€‚",
        category: "å‹•ç”»ãƒ»ã‚½ãƒ¼ã‚·ãƒ£ãƒ«",
        threads: [],
    },
    {
        id: "social-twitter",
        name: "X (Twitter)",
        description: "Xã®è©±é¡Œã€ãƒˆãƒ¬ãƒ³ãƒ‰ã€‚",
        category: "å‹•ç”»ãƒ»ã‚½ãƒ¼ã‚·ãƒ£ãƒ«",
        threads: [],
    },
    {
        id: "social-other",
        name: "ãã®ä»–SNS",
        description: "Instagram, TikTok, Reddit, Blueskyã€‚",
        category: "å‹•ç”»ãƒ»ã‚½ãƒ¼ã‚·ãƒ£ãƒ«",
        threads: [],
    },

    // --- ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡ ---
    {
        id: "ent-manga",
        name: "æ¼«ç”»",
        description: "é€±åˆŠèªŒã€Webæ¼«ç”»ã€åä½œã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [],
    },
    {
        id: "ent-anime",
        name: "ã‚¢ãƒ‹ãƒ¡",
        description: "ãƒ†ãƒ¬ãƒ“ã‚¢ãƒ‹ãƒ¡ã€æ˜ ç”»ã‚¢ãƒ‹ãƒ¡ã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [
            {
                id: "thread-anime-1",
                title: "ä»ŠæœŸè¦‡æ¨©ã‚¢ãƒ‹ãƒ¡äºˆæ¸¬ã‚¹ãƒ¬",
                lastUpdated: "2026-02-15T23:50:00",
                postCount: 340,
                views: 5400,
                tags: ["Anime", "Review"],
                createdAt: "2026-02-10T00:00:00",
                momentum: 400,
                status: 'active',
                posts: [
                    {
                        id: "post-anime-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ã‚„ã£ã±ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¢ãƒ‹ãƒ¡ãŒç†±ã„ã‚ˆãª",
                        createdAt: "2026-02-10T00:00:00",
                        likes: 10,
                    }
                ],
            }
        ],
    },
    {
        id: "ent-drama",
        name: "æ˜ ç”»ãƒ»ãƒ‰ãƒ©ãƒ",
        description: "é‚¦ç”»ã€æ´‹ç”»ã€ãƒ‰ãƒ©ãƒã€Netflixã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [],
    },
    {
        id: "ent-radio",
        name: "ãƒ©ã‚¸ã‚ª",
        description: "ãƒ©ã‚¸ã‚ªç•ªçµ„ã€ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [],
    },
    {
        id: "ent-game",
        name: "ã‚²ãƒ¼ãƒ ç·åˆ",
        description: "å®¶åº­ç”¨ã‚²ãƒ¼ãƒ ã€PCã‚²ãƒ¼ãƒ ã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [
            {
                id: "thread-game-1",
                title: "ãƒ¢ãƒ³ãƒãƒ³ã®æ–°ä½œã€ç™ºå£²æ—¥æ±ºå®šï½·ï¾€â”â”â”â”(ï¾Ÿâˆ€ï¾Ÿ)â”â”â”â”!!",
                lastUpdated: "2026-02-15T19:00:00",
                postCount: 670,
                views: 18000,
                tags: ["Game", "MH"],
                createdAt: "2026-02-15T09:00:00",
                momentum: 2000,
                status: 'active',
                posts: [
                    {
                        id: "post-game-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "å…¨è£¸å¾…æ©Ÿä½™è£•ã§ã—ãŸ",
                        createdAt: "2026-02-15T09:00:00",
                        likes: 33,
                    }
                ],
            }
        ],
    },
    {
        id: "ent-socialgame",
        name: "ã‚½ã‚·ãƒ£ã‚²",
        description: "ã‚¹ãƒãƒ›ã‚²ãƒ¼ãƒ ã€ã‚¬ãƒãƒ£ã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [],
    },
    {
        id: "ent-music",
        name: "éŸ³æ¥½",
        description: "é‚¦æ¥½ã€æ´‹æ¥½ã€ãƒ•ã‚§ã‚¹ã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [
            {
                id: "thread-music-1",
                title: "ä»Šå¹´ã®ãƒ•ã‚§ã‚¹ã®ãƒ¡ãƒ³ãƒ„å¾®å¦™ã™ãã‚“ï¼Ÿ",
                lastUpdated: "2026-02-14T18:00:00",
                postCount: 120,
                views: 4500,
                tags: ["Music", "Fes"],
                createdAt: "2026-02-14T12:00:00",
                momentum: 80,
                status: 'active',
                posts: [
                    {
                        id: "post-music-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ãƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒŠãƒ¼èª°ã ã‚ˆã“ã‚Œ...çŸ¥ã‚‰ãªã„ãŠã˜ã•ã‚“ã°ã£ã‹",
                        createdAt: "2026-02-14T12:00:00",
                        likes: 6,
                    }
                ],
            }
        ],
    },
    {
        id: "ent-book",
        name: "èª­æ›¸ãƒ»æ–‡å­¦",
        description: "å°èª¬ã€ãƒ“ã‚¸ãƒã‚¹æ›¸ã€ãƒ©ã‚¤ãƒˆãƒãƒ™ãƒ«ã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [],
    },
    {
        id: "ent-comedy",
        name: "ãŠç¬‘ã„",
        description: "èŠ¸äººã€ãƒãƒ©ã‚¨ãƒ†ã‚£ã€è³ãƒ¬ãƒ¼ã‚¹ã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [],
    },
    {
        id: "ent-idol",
        name: "ã‚¢ã‚¤ãƒ‰ãƒ«ç·åˆ",
        description: "ã‚¢ã‚¤ãƒ‰ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã€æ¨ã—æ´»ã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [],
    },
    {
        id: "ent-kpop",
        name: "K-POP",
        description: "éŸ“å›½ã‚¢ã‚¤ãƒ‰ãƒ«ã€éŸ³æ¥½ã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [],
    },
    {
        id: "ent-hello",
        name: "ãƒãƒ­ãƒ—ãƒ­",
        description: "ãƒãƒ­ãƒ¼ï¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [],
    },
    {
        id: "ent-celeb",
        name: "èŠ¸èƒ½",
        description: "èŠ¸èƒ½äººã€ã‚´ã‚·ãƒƒãƒ—ã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [],
    },
    {
        id: "ent-tokusatsu",
        name: "ç‰¹æ’®",
        description: "ä»®é¢ãƒ©ã‚¤ãƒ€ãƒ¼ã€æˆ¦éšŠã€ã‚¦ãƒ«ãƒˆãƒ©ãƒãƒ³ã€‚",
        category: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡",
        threads: [],
    },

    // --- ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ– ---
    {
        id: "create-illust",
        name: "ã‚¤ãƒ©ã‚¹ãƒˆ",
        description: "çµµæãã€ã‚¤ãƒ©ã‚¹ãƒˆåˆ¶ä½œã€‚",
        category: "ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–",
        threads: [],
    },
    {
        id: "create-design",
        name: "ãƒ‡ã‚¶ã‚¤ãƒ³",
        description: "ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã€Webãƒ‡ã‚¶ã‚¤ãƒ³ã€‚",
        category: "ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–",
        threads: [
            {
                id: "thread-design-1",
                title: "ã€æ‚²å ±ã€‘ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€Œãƒ­ã‚´ã€ã‚‚ã†ã¡ã‚‡ã£ã¨ãƒãƒƒãƒ—ã«ã§ãã‚‹ï¼Ÿã€",
                lastUpdated: "2026-02-15T16:00:00",
                postCount: 42,
                views: 2100,
                tags: ["Design", "Work"],
                createdAt: "2026-02-15T09:00:00",
                momentum: 100,
                status: 'active',
                posts: [
                    {
                        id: "post-design-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ãƒãƒƒãƒ—ã£ã¦ä½•ã ã‚ˆ...æŠ½è±¡çš„ã™ãã‚‹ã ã‚",
                        createdAt: "2026-02-15T09:00:00",
                        likes: 15,
                    }
                ],
            }
        ],
    },
    {
        id: "create-3dcg",
        name: "3DCG",
        description: "Blender, Maya, modelingã€‚",
        category: "ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–",
        threads: [],
    },
    {
        id: "create-3dprint",
        name: "3Dãƒ—ãƒªãƒ³ãƒˆ",
        description: "3Dãƒ—ãƒªãƒ³ã‚¿ãƒ¼ã€é€ å½¢ã€‚",
        category: "ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–",
        threads: [],
    },
    {
        id: "create-dtm",
        name: "DTM",
        description: "ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ã€ä½œæ›²ã€‚",
        category: "ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–",
        threads: [],
    },
    {
        id: "create-tanka",
        name: "çŸ­æ­Œãƒ»å·æŸ³",
        description: "äº”ä¸ƒäº”ã€å®šå‹è©©ã€‚",
        category: "ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–",
        threads: [],
    },
    {
        id: "create-arch",
        name: "å»ºç¯‰",
        description: "å»ºç¯‰ãƒ‡ã‚¶ã‚¤ãƒ³ã€å»ºç‰©ã€‚",
        category: "ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–",
        threads: [],
    },

    // --- å­¦å• ---
    {
        id: "acad-natural",
        name: "è‡ªç„¶ç§‘å­¦",
        description: "ç‰©ç†ã€åŒ–å­¦ã€ç”Ÿç‰©ã€åœ°å­¦ã€‚",
        category: "å­¦å•",
        threads: [
            {
                id: "thread-sci-1",
                title: "ã€Œãƒ•ã‚§ãƒ«ãƒŸã®ãƒ‘ãƒ©ãƒ‰ãƒƒã‚¯ã‚¹ã€ã«å¯¾ã™ã‚‹ä¸€ç•ªèª¬å¾—åŠ›ã®ã‚ã‚‹è§£ã£ã¦ä½•ï¼Ÿ",
                lastUpdated: "2026-02-13T20:00:00",
                postCount: 210,
                views: 4500,
                tags: ["Space", "Philosophy"],
                aiSummary: "ã€Œã‚°ãƒ¬ãƒ¼ãƒˆãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼èª¬ã€ã¨ã€Œå‹•ç‰©åœ’ä»®èª¬ã€ãŒäººæ°—ã€‚æœ€è¿‘ã¯ã€Œã™ã§ã«AIåŒ–ã—ã¦ãƒ‡ã‚¸ã‚¿ãƒ«å®‡å®™ã«ç§»è¡Œã—ãŸã€èª¬ã‚‚æœ‰åŠ›ã€‚",
                createdAt: "2026-02-10T20:00:00",
                momentum: 52,
                status: 'active',
                posts: [],
            },
        ],
    },
    {
        id: "acad-human",
        name: "äººæ–‡ãƒ»ç¤¾ä¼šç§‘å­¦",
        description: "æ­´å²ã€å¿ƒç†ã€ç¤¾ä¼šã€æ•™è‚²ã€‚",
        category: "å­¦å•",
        threads: [],
    },
    {
        id: "acad-math",
        name: "æ•°å­¦",
        description: "æ•°å­¦ã€çµ±è¨ˆå­¦ã€‚",
        category: "å­¦å•",
        threads: [],
    },
    {
        id: "acad-philo",
        name: "å“²å­¦ãƒ»æ€æƒ³",
        description: "å“²å­¦ã€å€«ç†ã€æ€æƒ³ã€‚",
        category: "å­¦å•",
        threads: [
            {
                id: "thread-philo-1",
                title: "äººç”Ÿã®æ„å‘³ã«ã¤ã„ã¦çœŸé¢ç›®ã«èªã‚‹ã‚¹ãƒ¬",
                lastUpdated: "2026-02-14T23:00:00",
                postCount: 156,
                views: 4000,
                tags: ["Philosophy", "Life"],
                createdAt: "2026-02-10T22:00:00",
                momentum: 30,
                status: 'active',
                posts: [
                    {
                        id: "post-philo-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "æ­»ã‚“ã ã‚‰ç„¡ã«ãªã‚‹ãªã‚‰ã€ç”Ÿãã‚‹æ„å‘³ãªã‚“ã¦ãªãã­ï¼Ÿ",
                        createdAt: "2026-02-10T22:00:00",
                        likes: 8,
                    }
                ],
            }
        ],
    },
    {
        id: "acad-eng",
        name: "æ©Ÿæ¢°ãƒ»å·¥å­¦",
        description: "å·¥å­¦ã€æŠ€è¡“ç ”ç©¶ã€‚",
        category: "å­¦å•",
        threads: [],
    },

    // --- ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ»ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ« ---
    {
        id: "mys-occult",
        name: "ã‚ªã‚«ãƒ«ãƒˆãƒ»æ€ªè«‡",
        description: "å¿ƒéœŠã€ä¸æ€è­°ãªä½“é¨“ã€‚",
        category: "ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ»ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«",
        threads: [
            {
                id: "thread-occult-1",
                title: "ã€æ´’è½æ€–ã€‘ä»Šã¾ã§ã§ä¸€ç•ªæ€–ã‹ã£ãŸä½“é¨“æ›¸ã„ã¦ã‘",
                lastUpdated: "2026-02-15T23:55:00",
                postCount: 666,
                views: 13000,
                tags: ["Occult", "Horror"],
                createdAt: "2026-02-13T00:00:00",
                momentum: 999,
                status: 'active',
                posts: [
                    {
                        id: "post-occult-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "æ·±å¤œã®å±±é“ã§ç™½ã„ç€ç‰©ã®å¥³ã‚’è¦‹ãŸè©±ã™ã‚‹",
                        createdAt: "2026-02-13T00:00:00",
                        likes: 66,
                    }
                ],
            }
        ],
    },
    {
        id: "mys-urban",
        name: "éƒ½å¸‚ä¼èª¬ãƒ»é™°è¬€è«–",
        description: "éƒ½å¸‚ä¼èª¬ã€æœªè§£æ±ºäº‹ä»¶ã€‚",
        category: "ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ»ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«",
        threads: [],
    },
    {
        id: "mys-spirit",
        name: "ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«",
        description: "ç²¾ç¥ä¸–ç•Œã€å ã„ã€ãƒ‘ãƒ¯ãƒ¼ã‚¹ãƒãƒƒãƒˆã€‚",
        category: "ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ»ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«",
        threads: [],
    },
    {
        id: "mys-religion",
        name: "å®—æ•™",
        description: "å®—æ•™ã€ä¿¡ä»°ã€‚",
        category: "ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ»ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«",
        threads: [],
    },

    // --- ã‚¹ãƒãƒ¼ãƒ„ãƒ»ã‚®ãƒ£ãƒ³ãƒ–ãƒ« ---
    {
        id: "sports-baseball",
        name: "é‡çƒ",
        description: "ãƒ—ãƒ­é‡çƒã€ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒªãƒ¼ã‚°ã€é«˜æ ¡é‡çƒã€‚",
        category: "ã‚¹ãƒãƒ¼ãƒ„ãƒ»ã‚®ãƒ£ãƒ³ãƒ–ãƒ«",
        threads: [
            {
                id: "thread-baseball-1",
                title: "å¤§è°·ç¿”å¹³ã€æœ¬æ—¥ã‚‚ãƒ›ãƒ¼ãƒ ãƒ©ãƒ³ç¢ºå®Ÿã‹",
                lastUpdated: "2026-02-15T11:00:00",
                postCount: 890,
                views: 22000,
                tags: ["Baseball", "MLB"],
                createdAt: "2026-02-15T08:00:00",
                momentum: 2500,
                status: 'active',
                posts: [
                    {
                        id: "post-bb-1",
                        author: "åç„¡ã—ã•ã‚“",
                        content: "ãªãŠã‚¨",
                        createdAt: "2026-02-15T08:00:00",
                        likes: 100,
                    }
                ],
            }
        ],
    },
    {
        id: "sports-soccer",
        name: "ã‚µãƒƒã‚«ãƒ¼",
        description: "Jãƒªãƒ¼ã‚°ã€æµ·å¤–ã‚µãƒƒã‚«ãƒ¼ã€ä»£è¡¨ã€‚",
        category: "ã‚¹ãƒãƒ¼ãƒ„ãƒ»ã‚®ãƒ£ãƒ³ãƒ–ãƒ«",
        threads: [],
    },
    {
        id: "sports-sumo",
        name: "ç›¸æ’²",
        description: "å¤§ç›¸æ’²ã€åŠ›å£«ã€‚",
        category: "ã‚¹ãƒãƒ¼ãƒ„ãƒ»ã‚®ãƒ£ãƒ³ãƒ–ãƒ«",
        threads: [],
    },
    {
        id: "sports-fight",
        name: "ã‚¹ãƒãƒ¼ãƒ„ãƒ»æ ¼é—˜æŠ€",
        description: "ãã®ä»–ã‚¹ãƒãƒ¼ãƒ„ã€æ ¼é—˜æŠ€ã€‚",
        category: "ã‚¹ãƒãƒ¼ãƒ„ãƒ»ã‚®ãƒ£ãƒ³ãƒ–ãƒ«",
        threads: [],
    },
    {
        id: "sports-gamble",
        name: "ã‚®ãƒ£ãƒ³ãƒ–ãƒ«",
        description: "ç«¶é¦¬ã€ç«¶è‰‡ã€ãƒ‘ãƒãƒ³ã‚³ã€‚",
        category: "ã‚¹ãƒãƒ¼ãƒ„ãƒ»ã‚®ãƒ£ãƒ³ãƒ–ãƒ«",
        threads: [],
    },
];

export const getBoards = async (): Promise<Board[]> => {
    return MOCK_BOARDS;
};

export const getBoard = async (boardId: string): Promise<Board | undefined> => {
    return MOCK_BOARDS.find((b) => b.id === boardId);
};

// --- Logic for Growth & Selection ---

function calculateMomentum(thread: Thread): number {
    const now = new Date();
    const created = new Date(thread.createdAt);

    // Safety check for invalid dates
    if (isNaN(created.getTime())) return 0;

    const diffMs = now.getTime() - created.getTime();
    const daysSinceCreation = Math.max(diffMs / (1000 * 60 * 60 * 24), 0.001); // Min 0.001 days to avoid div/0

    // Momentum = Posts / Days
    // (Example: 10 posts in 1 day = 10 momentum. 1 post in 10 days = 0.1 momentum)
    return Math.floor(thread.postCount / daysSinceCreation);
}

function checkSelectionStatus(thread: Thread): 'active' | 'archived' {
    const now = new Date();
    const created = new Date(thread.createdAt);
    const lastUpdated = new Date(thread.lastUpdated);

    const hoursSinceCreation = (now.getTime() - created.getTime()) / (1000 * 60 * 60);
    const daysSinceLastUpdate = (now.getTime() - lastUpdated.getTime()) / (1000 * 60 * 60 * 24);

    // 1. Culling Rule: "No Engagement" (Initial Culling)
    // If >24h old AND <5 posts -> Archive.
    // (Strict for AI threads could be implemented here if we track 'isAi')
    if (hoursSinceCreation > 24 && thread.postCount < 5) {
        return 'archived';
    }

    // 2. Culling Rule: "Time Decay" (Natural Death)
    // If no updates for 7 days -> Archive.
    if (daysSinceLastUpdate > 7) {
        return 'archived';
    }

    return 'active';
}

export const getThreads = async (boardId: string): Promise<Thread[]> => {
    const board = MOCK_BOARDS.find((b) => b.id === boardId);
    if (!board) return [];

    // Apply Growth & Selection logic on read
    // In a real app, this would be a background job or DB query
    board.threads = board.threads.map(t => {
        const momentum = calculateMomentum(t);
        const status = checkSelectionStatus(t);
        return { ...t, momentum, status };
    });

    // Filter out archived threads for main view (or handle in UI)
    // For now, let's return ALL, but UI will hide archived or show differently
    // Actually, createThread adds to this array. 
    // Let's filter here to simulate "Disappearing" threads if they are culled.
    // Spec says "Archived (Hidden from main list)".

    // Sort by Momentum (Heat) Descending
    return board.threads
        .filter(t => t.status === 'active')
        .sort((a, b) => b.momentum - a.momentum);
};

export const getThread = async (boardId: string, threadId: string): Promise<Thread | undefined> => {
    // For getThread, we might want to return even if archived?
    // Using simple lookup for now.
    const board = MOCK_BOARDS.find((b) => b.id === boardId);
    return board?.threads.find((t) => t.id === threadId);
};


export const addPost = async (boardId: string, threadId: string, post: Omit<Post, 'id' | 'createdAt' | 'likes'>): Promise<Post | undefined> => {
    const thread = await getThread(boardId, threadId);
    if (!thread) return undefined;

    const newPost: Post = {
        id: `post-${Date.now()}`,
        ...post,
        createdAt: new Date().toISOString(),
        likes: 0,
    };

    thread.posts.push(newPost);
    thread.postCount++;
    thread.lastUpdated = newPost.createdAt;
    // Momentum / Status will be updated on next getThreads call
    return newPost;
};

export const createThread = async (boardId: string, title: string, firstPostContent: string, userId?: string): Promise<Thread | undefined> => {
    const board = await getBoard(boardId);
    if (!board) return undefined;

    const now = new Date().toISOString();
    const newThread: Thread = {
        id: `thread-${Date.now()}`,
        title,
        lastUpdated: now,
        postCount: 1,
        views: 0, // Init views
        tags: [],
        posts: [],
        createdAt: now,
        momentum: 1000,
        status: 'active',
    };

    const firstPost: Post = {
        id: `post-${Date.now()}`,
        author: "åç„¡ã—ã•ã‚“",
        content: firstPostContent,
        createdAt: newThread.lastUpdated,
        userId: userId,
        likes: 0,
    };

    newThread.posts.push(firstPost);
    board.threads.unshift(newThread); // Add to top

    return newThread;
};

================
File: src/app/[boardId]/[threadId]/page.tsx
================
import Link from 'next/link';
import { notFound } from 'next/navigation';
import { getThread } from '@/data/db-actions';
import { SourceCard } from '@/components/SourceCard';
import ThreadInteractiveView from '@/components/ThreadInteractiveView';
import styles from './page.module.css';
import { Metadata } from 'next';

interface PageProps {
    params: Promise<{
        boardId: string;
        threadId: string;
    }>;
    searchParams: Promise<{
        admin?: string;
    }>;
}

export async function generateMetadata({ params }: PageProps): Promise<Metadata> {
    const paramsPromise = params;
    const { boardId, threadId } = await paramsPromise;
    const thread = await getThread(boardId, threadId);

    if (!thread) {
        return {
            title: 'Thread Not Found - NWWW',
        };
    }

    const title = thread.title;
    const boardName = thread.board?.name || boardId;

    const ogUrl = new URL(`${process.env.NEXTAUTH_URL || 'http://localhost:3000'}/api/og`);
    ogUrl.searchParams.set('title', title);
    ogUrl.searchParams.set('boardName', boardName);

    return {
        title: `${title} - ${boardName} | NWWW`,
        description: thread.aiAnalysis || thread.title,
        openGraph: {
            title: title,
            images: [
                {
                    url: ogUrl.toString(),
                    width: 1200,
                    height: 630,
                    alt: title,
                },
            ],
        },
        twitter: {
            card: 'summary_large_image',
            title: title,
            images: [ogUrl.toString()],
        },
    };
}

import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";

export default async function ThreadPage({ params }: PageProps) {
    const paramsPromise = params;

    const { boardId, threadId } = await paramsPromise;
    const thread = await getThread(boardId, threadId);
    const session = await getServerSession(authOptions);
    const isAdmin = !!session;

    if (!thread) {
        notFound();
    }

    return (
        <div className={styles.container}>
            <div className={styles.nav}>
                <Link href={`/${boardId}`} className={styles.backLink}>
                    &lt; æ¿ã«æˆ»ã‚‹
                </Link>
            </div>

            <header className={styles.header}>
                <h1 className={styles.title}>{thread.title}</h1>
                <div className={styles.meta}>
                    <span>Res: {thread.postCount}</span>
                    <span>Updated: {new Date(thread.lastUpdated).toLocaleString()}</span>
                </div>
            </header>

            <SourceCard
                sourceUrl={thread.sourceUrl}
                sourceTitle={thread.sourceTitle}
                sourcePlatform={thread.sourcePlatform}
            />

            <ThreadInteractiveView
                boardId={boardId}
                thread={{
                    id: thread.id,
                    title: thread.title,
                    postCount: thread.postCount,
                    status: thread.status,
                    aiSummary: thread.aiSummary,
                    posts: thread.posts.map((p: any) => ({
                        id: p.id,
                        author: p.author,
                        content: p.content,
                        createdAt: p.createdAt,
                        userId: p.userId,
                        status: p.status
                    }))
                } as any}
                isAdmin={isAdmin}
            />
        </div>
    );
}

================
File: src/app/admin/page.tsx
================
import { getReports, getBoards, getDailyStats } from '@/data/db-actions';
import ReportBoard from '@/components/ReportBoard';
import AdminAnalytics from '@/components/AdminAnalytics';
import BoardStatusManager from '@/components/BoardStatusManager';
import Link from 'next/link';
import { notFound } from 'next/navigation';
import styles from './page.module.css';

import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { redirect } from "next/navigation";

export default async function AdminPage() {
    const session = await getServerSession(authOptions);

    // Middleware already protects this path, but double-check for safety
    if (!session) {
        redirect("/api/auth/signin");
    }

    const reports = await getReports();
    const allBoards = await getBoards(true); // Include locked boards for admin
    const stats = await getDailyStats();

    return (
        <div className={styles.container}>
            <div className={styles.nav}>
                <Link href="/" className={styles.backLink}>â† æ²ç¤ºæ¿ã«æˆ»ã‚‹</Link>
            </div>

            <header className={styles.header}>
                <div className={styles.adminBadge}>ADMIN DASHBOARD</div>
                <h1>é€šå ±ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†</h1>
            </header>

            <section className={styles.section}>
                <AdminAnalytics stats={stats} />
            </section>

            <section className={styles.section}>
                <BoardStatusManager initialBoards={allBoards as any} />
            </section>

            <section className={styles.section}>
                <ReportBoard initialReports={reports} />
            </section>
        </div>
    );
}

================
File: src/app/actions.ts
================
'use server';

import { headers } from 'next/headers';
import crypto from 'crypto';
import { addPost, createThread, updatePostStatus, updateThreadStatus } from '@/data/db-actions';
import { revalidatePath } from 'next/cache';
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";

import { checkRateLimit } from '@/lib/rate-limit';

function generateDailyId(ip: string): string {
    const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
    const salt = "NWWW_SECRET_SALT_V1"; // In real app, env var
    const raw = `${ip}-${today}-${salt}`;

    // Create SHA-256 hash
    const hash = crypto.createHash('sha256').update(raw).digest('base64');

    // Take first 9 chars and make it URL safe-ish or just alphanumeric
    return hash.substring(0, 9);
}

export async function submitPost(formData: FormData) {
    const boardId = formData.get('boardId') as string;
    const threadId = formData.get('threadId') as string;
    const content = formData.get('content') as string;
    const author = (formData.get('author') as string) || "åç„¡ã—ã•ã‚“@ãƒ‹ãƒ¥ã€œ";
    const honeypot = formData.get('website_url_verification') as string;

    if (honeypot) {
        return { success: false, message: 'Spam detected' };
    }

    if (!boardId || !threadId || !content) {
        return { success: false, message: 'Missing required fields' };
    }

    // Get IP
    const headersList = await headers();
    const forwardedFor = headersList.get('x-forwarded-for');
    const ip = forwardedFor ? forwardedFor.split(',')[0] : '127.0.0.1';

    // Rate Limit Check (5 seconds per post)
    const canPost = await checkRateLimit(`post:${ip}`, 1, 5000);
    if (!canPost) {
        return { success: false, message: 'æŠ•ç¨¿é–“éš”ãŒçŸ­ã™ãã¾ã™ã€‚å°‘ã—å¾…ã£ã¦ã‹ã‚‰å†åº¦æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚' };
    }

    // Generate ID
    const userId = generateDailyId(ip);

    await addPost(boardId, threadId, { author, content, userId });

    // Revalidate the thread page to show the new post
    revalidatePath(`/${boardId}/${threadId}`);
    return { success: true };
}

export async function createNewThread(formData: FormData) {
    const boardId = formData.get('boardId') as string;
    const title = formData.get('title') as string;
    const content = formData.get('content') as string;
    const honeypot = formData.get('website_url_verification') as string;

    if (honeypot) {
        return { success: false, message: 'Spam detected' };
    }

    if (!boardId || !title || !content) {
        return { success: false, message: 'Missing required fields' };
    }

    // Get IP for thread creator too
    const headersList = await headers();
    const forwardedFor = headersList.get('x-forwarded-for');
    const ip = forwardedFor ? forwardedFor.split(',')[0] : '127.0.0.1';

    // Rate Limit Check (60 seconds per thread)
    const canCreate = await checkRateLimit(`thread:${ip}`, 1, 60000);
    if (!canCreate) {
        return { success: false, message: 'æ¬¡ã®æ–¹ã®ãŸã‚ã«ã€ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆã¯1åˆ†é–“ã«1å›ã¾ã§ã¨ã—ã¦ã„ã¾ã™ã€‚' };
    }

    const userId = generateDailyId(ip);

    const newThread = await createThread(boardId, title, content, userId);

    if (newThread) {
        revalidatePath(`/${boardId}`);
        return { success: true, threadId: newThread.id };
    }

    return { success: false, message: 'Failed to create thread' };
}

export async function reportPost(formData: FormData) {
    const postId = formData.get('postId') as string;
    const reason = formData.get('reason') as string;
    const detail = (formData.get('detail') as string) || null;

    if (!postId || !reason) {
        return { success: false, message: 'Missing required fields' };
    }

    const headersList = await headers();
    const forwardedFor = headersList.get('x-forwarded-for');
    const ip = forwardedFor ? forwardedFor.split(',')[0] : '127.0.0.1';

    // Rate Limit Check (10 seconds per report)
    const canReport = await checkRateLimit(`report:${ip}`, 1, 10000);
    if (!canReport) {
        return { success: false, message: 'é€šå ±ã¯10ç§’é–“ã«1å›ã¾ã§ã¨ã—ã¦ã„ã¾ã™ã€‚' };
    }

    const hashedIp = crypto.createHash('sha256').update(ip).digest('hex').substring(0, 16);

    const { default: prisma } = await import('@/lib/prisma');
    await prisma.report.create({
        data: {
            postId,
            reason,
            detail,
            reporterIp: hashedIp,
        }
    });

    return { success: true, message: 'é€šå ±ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸ' };
}

export async function deletePostAction(formData: FormData) {
    const session = await getServerSession(authOptions);
    if (!session) {
        return { success: false, message: 'Unauthorized' };
    }

    const postId = formData.get('postId') as string;
    const boardId = formData.get('boardId') as string;
    const threadId = formData.get('threadId') as string;

    await updatePostStatus(postId, 'deleted');
    revalidatePath(`/${boardId}/${threadId}`);
    return { success: true };
}

export async function restorePostAction(formData: FormData) {
    const session = await getServerSession(authOptions);
    if (!session) {
        return { success: false, message: 'Unauthorized' };
    }

    const postId = formData.get('postId') as string;
    const boardId = formData.get('boardId') as string;
    const threadId = formData.get('threadId') as string;

    await updatePostStatus(postId, 'active');
    revalidatePath(`/${boardId}/${threadId}`);
    return { success: true };
}

export async function deleteThreadAction(formData: FormData) {
    const session = await getServerSession(authOptions);
    if (!session) {
        return { success: false, message: 'Unauthorized' };
    }

    const threadId = formData.get('threadId') as string;
    const boardId = formData.get('boardId') as string;

    await updateThreadStatus(threadId, 'deleted');
    revalidatePath(`/${boardId}`);
    return { success: true };
}

export async function updateReportStatus(formData: FormData) {
    const session = await getServerSession(authOptions);
    if (!session) {
        return { success: false, message: 'Unauthorized' };
    }

    const reportId = formData.get('reportId') as string;
    const status = formData.get('status') as 'pending' | 'resolved' | 'dismissed';

    const { updateReportStatus: dbUpdateReportStatus } = await import('@/data/db-actions');
    await dbUpdateReportStatus(reportId, status);

    revalidatePath('/admin');
    return { success: true };
}

export async function toggleBoardStatusAction(formData: FormData) {
    const session = await getServerSession(authOptions);
    if (!session) {
        return { success: false, message: 'Unauthorized' };
    }

    const boardId = formData.get('boardId') as string;
    const status = formData.get('status') as 'active' | 'locked';

    const { updateBoardStatus } = await import('@/data/db-actions');
    await updateBoardStatus(boardId, status);

    revalidatePath('/');
    revalidatePath('/admin');
    return { success: true };
}

================
File: src/app/layout.tsx
================
import type { Metadata } from "next";
import Link from 'next/link';
import Image from 'next/image';
import { Search } from 'lucide-react';
import { Noto_Sans_JP } from 'next/font/google';
import { getBoards } from '@/data/db-actions';
import BoardList from '@/components/BoardList';
import AIInsights from '@/components/AIInsights';
import SparkAdmin from '@/components/SparkAdmin';
import ThemeToggle from '@/components/ThemeToggle';
import MobileHeader from '@/components/MobileHeader';
import Providers from '@/components/Providers';
import "./globals.css";
import styles from './layout.module.css';

const notoSansJP = Noto_Sans_JP({
  subsets: ['latin'],
  weight: ['400', '500', '700', '900'],
  variable: '--font-noto',
  display: 'swap',
});

export const metadata: Metadata = {
  title: {
    template: '%s | NWWW - The New World Wide Web',
    default: 'NWWW - The New World Wide Web (Beta)',
  },
  description: "AIæ™‚ä»£ã®ç¾ä»£ç‰ˆåŒ¿åæ²ç¤ºæ¿ã€‚AIãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã€Œãƒ‹ãƒ¥ã€œãã‚“ã€ã«ã‚ˆã‚‹æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®ã‚¹ãƒ¬ãƒƒãƒ‰ç”Ÿæˆã‚„ã€AIã«ã‚ˆã‚‹è¦ç´„æ©Ÿèƒ½ã‚’å‚™ãˆãŸã€çŸ¥ã®äº¤å·®ç‚¹ã¨ãªã‚‹æ¬¡ä¸–ä»£ã®BBSã€‚",
  metadataBase: new URL(process.env.NEXTAUTH_URL || 'http://localhost:3000'),
  openGraph: {
    title: 'NWWW - The New World Wide Web',
    description: "AIæ™‚ä»£ã®ç¾ä»£ç‰ˆåŒ¿åæ²ç¤ºæ¿ã€‚çŸ¥ã®äº¤å·®ç‚¹ã€‚",
    siteName: 'NWWW',
    locale: 'ja_JP',
    type: 'website',
  },
  twitter: {
    card: 'summary_large_image',
    title: 'NWWW - The New World Wide Web',
    description: "AIæ™‚ä»£ã®ç¾ä»£ç‰ˆåŒ¿åæ²ç¤ºæ¿ã€‚çŸ¥ã®äº¤å·®ç‚¹ã€‚",
  },
};

// Inline script to prevent flash of wrong theme
const themeScript = `
  (function() {
    var t = localStorage.getItem('theme');
    if (t === 'dark' || (!t && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.setAttribute('data-theme', 'dark');
    }
  })();
`;

export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  const boards = await getBoards();

  return (
    <html lang="ja" className={notoSansJP.variable} suppressHydrationWarning>
      <head>
        <script dangerouslySetInnerHTML={{ __html: themeScript }} />
      </head>
      <body>
        <MobileHeader boards={boards} />
        <div className={styles.container}>
          <main className={styles.main}>
            <aside className={styles.sidebar}>
              <div className={styles.sidebarLogo}>
                <Link href="/" className={styles.logo}>
                  <Image
                    src="/nwww_logo.png?v=2"
                    alt="NWWW (Î²)"
                    width={112}
                    height={37}
                    className={styles.logoLight}
                    style={{ objectFit: 'contain', width: 'auto', height: 'auto', maxWidth: '100%' }}
                    priority
                    unoptimized
                  />
                  <Image
                    src="/nwww_logo_w.png"
                    alt="NWWW (Î²)"
                    width={112}
                    height={37}
                    className={styles.logoDark}
                    style={{ objectFit: 'contain', width: 'auto', height: 'auto', maxWidth: '100%' }}
                    priority
                    unoptimized
                  />
                </Link>
              </div>
              <div className={styles.sidebarNav}>
                <BoardList boards={boards} />
              </div>
              <div className={styles.sidebarFooter}>
                <div className={styles.legalLinks}>
                  <Link href="/tos" className={styles.legalLink}>åˆ©ç”¨è¦ç´„</Link>
                  <Link href="/privacy" className={styles.legalLink}>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</Link>
                </div>
                <ThemeToggle />
              </div>
            </aside>
            <div className={styles.content}>
              <div className={styles.topBar}>
                <form action="/search" method="get" className={styles.searchWrapper}>
                  <Search className={styles.searchIcon} size={18} />
                  <input
                    type="text"
                    name="q"
                    placeholder="ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’æ¤œç´¢"
                    className={styles.searchInput}
                  />
                </form>
              </div>
              <Providers>{children}</Providers>
            </div>
          </main>
        </div>
      </body>
    </html>
  );
}

================
File: src/app/[boardId]/page.tsx
================
import { Metadata } from 'next';
import Link from 'next/link';
import { notFound } from 'next/navigation';
import { Suspense } from 'react';
import { getBoard } from '@/data/db-actions';
import NewThreadForm from '@/components/NewThreadForm';
import { ArrowLeft, Eye, MessageCircle, Clock, Archive, ChevronLeft, ChevronRight } from 'lucide-react';
import styles from './page.module.css';
import Loading from './loading';

// Force dynamic rendering to ensure UI updates aren't stuck in stale static generation,
// while relying on unstable_cache for data performance.
export const dynamic = 'force-dynamic';

interface PageProps {
    params: Promise<{
        boardId: string;
    }>;
    searchParams: Promise<{
        page?: string;
    }>;
}

export async function generateMetadata({ params }: PageProps): Promise<Metadata> {
    const { boardId } = await params;
    const board = await getBoard(boardId);

    if (!board) {
        return {
            title: 'æ¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
        };
    }

    return {
        title: board.name,
        description: `${board.name}æ¿ã®å…¬å¼ã‚¹ãƒ¬ãƒƒãƒ‰ä¸€è¦§ã€‚${board.description}`,
    };
}



export default function BoardPageWrapper({ params, searchParams }: PageProps) {
    return (
        <Suspense fallback={<Loading />}>
            <BoardContent params={params} searchParams={searchParams} />
        </Suspense>
    );
}

async function BoardContent({ params, searchParams }: PageProps) {
    const paramsPromise = params;
    const searchParamsPromise = searchParams;

    const { boardId } = await paramsPromise;
    const { page: pageStr } = await searchParamsPromise;

    const page = Math.max(1, parseInt(pageStr || '1', 10));
    // Use smaller sleep to simulate network if needed for testing, but remove for prod

    const board = await getBoard(boardId, page);

    if (!board) {
        notFound();
    }

    return (
        <div className={styles.pageContainer}>
            {/* Sticky Header */}
            <header className={styles.stickyHeader}>
                <div className={styles.headerInner}>
                    <div className={styles.headerLeft}>
                        <Link href="/" className={styles.backButton}>
                            <ArrowLeft size={16} />
                        </Link>
                        <div className={styles.boardInfo}>
                            <h2 className={styles.boardTitle}>{board.name}</h2>
                            <p className={styles.boardDesc}>{board.description}</p>
                        </div>
                    </div>
                </div>
            </header>

            {/* Content Area */}
            <main className={styles.contentArea}>
                {/* Sub Header: Category & New Thread Button */}
                <div className={styles.listHeader}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                        <span className={styles.categoryBadge}>{board.category}</span>
                        <Link href={`/${boardId}/archive`} style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '0.25rem',
                            fontSize: '0.8rem',
                            color: 'var(--muted-foreground)',
                            textDecoration: 'none'
                        }}>
                            <Archive size={14} />
                            ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
                        </Link>
                    </div>
                    <NewThreadForm boardId={boardId} />
                </div>

                <div className={styles.threadList}>
                    {board.threads.length === 0 ? (
                        <div className={styles.emptyState}>
                            <div className={styles.emptyContent}>
                                <div className={styles.emptyIconWrapper}>
                                    <MessageCircle size={48} strokeWidth={1.5} />
                                </div>
                                <h3 className={styles.emptyTitle}>ã¾ã ã‚¹ãƒ¬ãƒƒãƒ‰ãŒãªã„ã‚ˆ</h3>
                                <p className={styles.emptyDescription}>
                                    ã‚¹ãƒ¬ç«‹ã¦ã—ã¦ã­ã€‚<br />
                                    æ°—ã«ãªã‚‹è¨˜äº‹ã‚„Xã®æŠ•ç¨¿ã®URLã‹ã‚‰ã‚‚è‡ªå‹•ã§ä½œã‚Œã‚‹ã‚ˆã€‚
                                </p>
                                <div className={styles.emptyAction}>
                                    <NewThreadForm boardId={boardId} variant="primary" />
                                </div>
                            </div>
                        </div>
                    ) : (
                        board.threads.map((thread) => (
                            <Link href={`/${boardId}/${thread.id}`} key={thread.id} className={styles.cardLink}>
                                <article className={styles.threadCard}>
                                    <div className={styles.cardHeader}>
                                        <h3 className={styles.threadTitle}>{thread.title}</h3>
                                    </div>
                                    <div className={styles.cardFooter}>
                                        <div className={styles.metaData}>
                                            <span className={styles.timestamp}>
                                                <Clock size={14} />
                                                {new Date(thread.lastUpdated).toLocaleString('en-US', { hour12: true })}
                                            </span>
                                            <div className={styles.stats}>
                                                <span className={styles.statItem}>
                                                    <Eye size={14} />
                                                    {thread.views}
                                                </span>
                                                <span className={styles.statItem}>
                                                    <MessageCircle size={14} />
                                                    {thread.postCount}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </article>
                            </Link>
                        ))
                    )}
                </div>

                {/* Pagination */}
                {board.totalPages > 1 && (
                    <nav className={styles.pagination}>
                        {page > 1 ? (
                            <Link href={`/${boardId}?page=${page - 1}`} className={styles.pageButton}>
                                <ChevronLeft size={16} />
                                å‰ã¸
                            </Link>
                        ) : (
                            <span className={`${styles.pageButton} ${styles.pageButtonDisabled}`}>
                                <ChevronLeft size={16} />
                                å‰ã¸
                            </span>
                        )}

                        <span className={styles.pageInfo}>
                            {board.currentPage} / {board.totalPages}
                        </span>

                        {page < board.totalPages ? (
                            <Link href={`/${boardId}?page=${page + 1}`} className={styles.pageButton}>
                                æ¬¡ã¸
                                <ChevronRight size={16} />
                            </Link>
                        ) : (
                            <span className={`${styles.pageButton} ${styles.pageButtonDisabled}`}>
                                æ¬¡ã¸
                                <ChevronRight size={16} />
                            </span>
                        )}
                    </nav>
                )}
            </main>
        </div>
    );
}

================
File: src/components/ThreadInteractiveView.tsx
================
'use client';

import { useState, useEffect } from 'react';
import { Thread, Post } from '@/data/mockBBS';
import PostBar from './PostBar';
import ThreadSummarizer from './ThreadSummarizer';
import PostContent from './PostContent';
import ReportButton from './ReportButton';
import { recordBoardVisit } from './DiscoverSection';
import Link from 'next/link';
import styles from '@/app/[boardId]/[threadId]/page.module.css';
import { MessageSquareReply } from 'lucide-react';
import { deletePostAction, restorePostAction } from '@/app/actions';

interface ThreadInteractiveViewProps {
    boardId: string;
    thread: Thread;
    isAdmin?: boolean;
}

export default function ThreadInteractiveView({ boardId, thread, isAdmin }: ThreadInteractiveViewProps) {
    const [replyTarget, setReplyTarget] = useState<number | null>(null);
    const [isWriteBarExpanded, setIsWriteBarExpanded] = useState(false);

    // Record board visit for recommendation engine
    useEffect(() => {
        recordBoardVisit(boardId);
    }, [boardId]);

    const handleReply = (index: number) => {
        setReplyTarget(index);
        setIsWriteBarExpanded(true);
    };

    return (
        <>
            <div
                className={styles.postList}
                style={{
                    transition: 'margin-right 0.3s cubic-bezier(0.16, 1, 0.3, 1)',
                    marginRight: isWriteBarExpanded ? 'var(--panel-width, 0px)' : '0',
                }}
            >
                {/* We use a specific variable for panel width that effectively is 0 on mobile/tablet and 400px on xl */}
                <style jsx global>{`
                    @media (min-width: 1280px) {
                        :root {
                            --panel-width: 400px;
                        }
                    }
                    @media (max-width: 1279px) {
                        :root {
                            --panel-width: 0px;
                        }
                    }
                `}</style>

                <ThreadSummarizer threadId={thread.id} initialSummary={thread.aiSummary} postCount={thread.postCount} />

                {isAdmin && (
                    <div style={{
                        padding: '1rem',
                        backgroundColor: 'rgba(255, 0, 0, 0.1)',
                        border: '1px solid rgba(255, 0, 0, 0.2)',
                        borderRadius: '0.5rem',
                        marginBottom: '1rem',
                        color: '#ef4444',
                        fontSize: '0.8rem',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'space-between',
                        gap: '0.5rem'
                    }}>
                        <span><strong>ADMIN MODE ACTIVE:</strong> Moderation tools are visible.</span>
                        <Link
                            href="/admin"
                            style={{
                                backgroundColor: '#ef4444',
                                color: 'white',
                                padding: '4px 12px',
                                borderRadius: '4px',
                                textDecoration: 'none',
                                fontWeight: 'bold'
                            }}
                        >
                            é€šå ±ã‚’ç¢ºèªã™ã‚‹
                        </Link>
                    </div>
                )}

                {thread.posts.length === 0 ? (
                    <p className={styles.empty}>ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                ) : (
                    thread.posts.map((post: any, index: number) => (
                        <article key={post.id} className={`${styles.post} ${post.status === 'deleted' ? styles.deleted : ''}`} id={`post-${index + 1}`}
                            style={post.status === 'deleted' ? { opacity: 0.6 } : {}}
                        >
                            <div className={styles.postHeader}>
                                <span className={styles.postIndex}>{index + 1}</span>
                                <span className={styles.author}>{post.author}</span>
                                <span className={styles.date} suppressHydrationWarning>{new Date(post.createdAt).toLocaleString()}</span>
                                <span className={styles.id}>ID: {post.userId || '???'}</span>

                                {/* Admin Menu */}
                                {isAdmin && (
                                    <div style={{ marginLeft: 'auto', display: 'flex', gap: '0.5rem' }}>
                                        <form action={async (formData) => {
                                            if (post.status === 'deleted') {
                                                await restorePostAction(formData);
                                            } else {
                                                await deletePostAction(formData);
                                            }
                                        }}>
                                            <input type="hidden" name="postId" value={post.id} />
                                            <input type="hidden" name="boardId" value={boardId} />
                                            <input type="hidden" name="threadId" value={thread.id} />
                                            <button type="submit" style={{
                                                fontSize: '0.7rem',
                                                padding: '2px 8px',
                                                borderRadius: '4px',
                                                border: '1px solid #ef4444',
                                                background: post.status === 'deleted' ? '#ef4444' : 'transparent',
                                                color: post.status === 'deleted' ? 'white' : '#ef4444',
                                                cursor: 'pointer'
                                            }}>
                                                {post.status === 'deleted' ? 'RESTORE' : 'DELETE'}
                                            </button>
                                        </form>
                                    </div>
                                )}

                                {/* Reply Button */}
                                {!isAdmin && thread.postCount < 1000 && thread.status !== 'filled' && post.status !== 'deleted' && (
                                    <button
                                        onClick={() => handleReply(index + 1)}
                                        className="ml-auto text-muted-foreground hover:text-foreground flex items-center gap-1 text-xs transition-colors"
                                        title={`>>${index + 1} ã«è¿”ä¿¡`}
                                        style={{
                                            marginLeft: 'auto',
                                            background: 'transparent',
                                            border: 'none',
                                            cursor: 'pointer',
                                            fontSize: '0.8rem',
                                            padding: '0.25rem 0.5rem',
                                            borderRadius: '0.25rem'
                                        }}
                                    >
                                        <MessageSquareReply size={14} />
                                        <span>è¿”ä¿¡</span>
                                    </button>
                                )}
                                {post.status !== 'deleted' && <ReportButton postId={post.id} />}
                            </div>
                            <div className={styles.postContent}>
                                <PostContent content={post.content} posts={thread.posts} isDeleted={post.status === 'deleted'} />
                            </div>
                        </article>
                    ))
                )}
            </div>

            {thread.postCount >= 1000 || thread.status === 'filled' ? (
                <div style={{
                    position: 'fixed',
                    bottom: 0,
                    left: 0,
                    right: 0,
                    padding: '1rem',
                    backgroundColor: 'var(--card)',
                    borderTop: '1px solid rgba(var(--border-rgb), 0.1)',
                    textAlign: 'center',
                    color: 'var(--muted-foreground)',
                    fontSize: '0.9rem',
                    fontWeight: 600,
                    zIndex: 50,
                    boxShadow: '0 -4px 6px -1px rgba(0, 0, 0, 0.1)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '0.5rem'
                }}>
                    <MessageSquareReply size={16} />
                    ã“ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã¯1000ã‚’è¶…ãˆã¾ã—ãŸã€‚æ–°ã—ã„ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ç«‹ã¦ã¦ãã ã•ã„ã€‚
                </div>
            ) : (
                <PostBar
                    boardId={boardId}
                    threadId={thread.id}
                    replyTarget={replyTarget}
                    onReplyHandled={() => setReplyTarget(null)}
                    isOpen={isWriteBarExpanded}
                    onClose={() => setIsWriteBarExpanded(false)}
                    onOpen={() => setIsWriteBarExpanded(true)}
                />
            )}
        </>
    );
}

================
File: package.json
================
{
  "name": "nwww",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint",
    "postinstall": "prisma generate"
  },
  "prisma": {
    "seed": "npx tsx prisma/seed.ts"
  },
  "dependencies": {
    "@google/generative-ai": "^0.24.1",
    "@next/third-parties": "^16.1.6",
    "@prisma/client": "5.10.2",
    "cheerio": "^1.2.0",
    "lucide-react": "^0.564.0",
    "next": "16.1.6",
    "next-auth": "^4.24.10",
    "react": "19.2.3",
    "react-dom": "19.2.3",
    "react-tweet": "^3.3.0"
  },
  "devDependencies": {
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "dotenv": "^17.3.1",
    "eslint": "^9",
    "eslint-config-next": "16.1.6",
    "prisma": "5.10.2",
    "ts-node": "^10.9.2",
    "tsx": "^4.21.0",
    "typescript": "^5"
  }
}

================
File: src/data/db-actions.ts
================
import prisma from '@/lib/prisma';
import { unstable_cache } from 'next/cache'; // DBè² è·è»½æ¸›ã®ãŸã‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã†å ´åˆ

// å‹å®šç¾©ã¯æ—¢å­˜ã®ã‚‚ã®(Mock)ã¨äº’æ›æ€§ã‚’æŒãŸã›ã‚‹ãŸã‚ã€ä¸€æ—¦ã“ã“ã§å®šç¾©ã™ã‚‹ã‹ã€mockBBSã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‹ã€‚
// ä¾å­˜é–¢ä¿‚ã‚’è€ƒãˆã‚‹ã¨ã€mockBBSã‹ã‚‰å‹ã ã‘ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã®ãŒæ¥½ã§ã™ãŒã€DBãƒ¢ãƒ‡ãƒ«ã¨ãšã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã€
// ã“ã“ã§ç‹¬è‡ªã«å®šç¾©ã—ãªãŠã™ã‹ã€Prismaã®å‹ã‚’æ‹¡å¼µã—ã¾ã™ã€‚
// ä»Šå›ã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¤‰æ›´ã‚’æœ€å°é™ã«ã™ã‚‹ãŸã‚ã€æˆ»ã‚Šå€¤ã‚’MockBBSäº’æ›ã«å¤‰æ›ã—ã¾ã™ã€‚

export const getBoards = unstable_cache(
    async (includeLocked = false) => {
        const boards = await prisma.board.findMany({
            where: includeLocked ? {} : { status: 'active' },
            include: {
                threads: {
                    where: { status: 'active' },
                    orderBy: { lastUpdated: 'desc' },
                    take: 5,
                    include: {
                        posts: {
                            take: 1,
                            orderBy: { createdAt: 'desc' }
                        }
                    }
                }
            }
        });

        return boards.map(board => ({
            ...board,
            threads: board.threads.map(convertThread)
        }));
    },
    ['getBoards'],
    { tags: ['boards'], revalidate: 60 }
);

export const getBoard = unstable_cache(
    async (boardId: string, page = 1, perPage = 30) => {
        const board = await prisma.board.findUnique({
            where: { id: boardId },
            include: {
                threads: {
                    where: { status: 'active' },
                    orderBy: { lastUpdated: 'desc' },
                    skip: (page - 1) * perPage,
                    take: perPage,
                    include: {
                        posts: {
                            take: 1,
                            orderBy: { createdAt: 'desc' }
                        }
                    }
                }
            }
        });

        if (!board) return null;

        // Get total active thread count for pagination
        const totalThreads = await prisma.thread.count({
            where: { boardId, status: 'active' }
        });

        return {
            ...board,
            threads: board.threads.map(convertThread),
            totalThreads,
            totalPages: Math.ceil(totalThreads / perPage),
            currentPage: page
        };
    },
    ['getBoard'],
    { tags: ['board-view'], revalidate: 60 } // Dynamic tags are harder in unstable_cache wrapper, so we use a generic tag and cache key. 
    // Actually, we should probably include boardId in the keyParts roughly or relies on the arguments.
    // However, for correct tagging invalidation, we might want specific tags.
    // Next.js 14 unstable_cache passes arguments to the callback.
);

export async function getArchivedThreads(boardId: string) {
    const threads = await prisma.thread.findMany({
        where: {
            boardId: boardId,
            status: { in: ['filled', 'archived'] }
        },
        orderBy: { lastUpdated: 'desc' },
        include: {
            posts: {
                take: 1,
                orderBy: { createdAt: 'desc' }
            },
            board: true
        }
    });

    return threads.map(convertThread);
}

export async function getThread(boardId: string, threadId: string) {
    const thread = await prisma.thread.findUnique({
        where: { id: threadId },
        include: {
            posts: {
                orderBy: { createdAt: 'asc' } // Posts in chronological order
            },
            board: true,
        } // All status allowed (Archive should be readable)
    });

    if (!thread) return null;

    return convertThread(thread);
}

// Prisma types helper
interface PrismaThread {
    id: string;
    title: string;
    lastUpdated: Date;
    postCount: number;
    views: number;
    momentum: number;
    tags: any;
    aiAnalysis: string | null;
    isAiGenerated: boolean;
    sourceUrl: string | null;
    sourceTitle: string | null;
    sourcePlatform: string | null;
    createdAt: Date;
    status: string;
    posts?: PrismaPost[];
    board?: any;
}

interface PrismaPost {
    id: string;
    author: string;
    content: string;
    createdAt: Date;
    status: string;
    likes: number;
}

// Helper to convert Prisma Thread to App Thread (Date -> String, JSON string tags -> Array)
function convertThread(thread: PrismaThread) {
    // With PostgreSQL Json type, tags come directly as an array or object
    const tags = Array.isArray(thread.tags) ? thread.tags : [];

    return {
        ...thread,
        lastUpdated: thread.lastUpdated.toISOString(),
        createdAt: thread.createdAt.toISOString(),
        tags: tags,
        posts: thread.posts ? thread.posts.map((post: PrismaPost) => ({
            ...post,
            createdAt: post.createdAt.toISOString(),
            status: post.status,
            likes: post.likes,
        })) : [],
        // Add AI fields if needed
        isAiGenerated: thread.isAiGenerated,
        sourceUrl: thread.sourceUrl,
        aiAnalysis: thread.aiAnalysis,
        aiSummary: thread.aiAnalysis,
    };
}

// Data Mutation Actions
import { revalidatePath, revalidateTag } from 'next/cache';

export async function addPost(boardId: string, threadId: string, data: { author: string, content: string, userId: string }) {
    // Check limits
    const thread = await prisma.thread.findUnique({
        where: { id: threadId },
        select: { postCount: true, status: true }
    });

    if (!thread) throw new Error('Thread not found');
    if (thread.postCount >= 1000 || thread.status === 'filled') {
        throw new Error('Thread has reached 1000 posts');
    }

    const post = await prisma.post.create({
        data: {
            content: data.content,
            author: data.author, // ãƒˆãƒªãƒƒãƒ—ãªã©ã®å‡¦ç†ã¯ã“ã“ã§
            userId: data.userId,
            threadId: threadId,
            // No boardId in Post model
        }
    });

    // Threadã®çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
    const newPostCount = thread.postCount + 1;
    const newStatus = newPostCount >= 1000 ? 'filled' : 'active';

    const updatedThread = await prisma.thread.update({
        where: { id: threadId },
        data: {
            lastUpdated: new Date(),
            postCount: { increment: 1 },
            momentum: { increment: 10 }, // å‹¢ã„è¨ˆç®—ï¼ˆç°¡æ˜“ï¼‰
            status: newStatus
        }
    });

    // Auto-trigger AI summarization at milestones (fire-and-forget)
    const SUMMARY_THRESHOLDS = [20, 50, 100, 200, 500, 1000];
    if (SUMMARY_THRESHOLDS.includes(updatedThread.postCount)) {
        console.log(`[AutoSummarize] Triggering for thread ${threadId} at ${updatedThread.postCount} posts`);
        // Fire-and-forget: don't await, don't block the response
        const baseUrl = process.env.NEXTAUTH_URL || process.env.VERCEL_URL || 'http://localhost:3000';
        fetch(`${baseUrl}/api/thread/summarize`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ threadId }),
        }).catch(err => console.error('[AutoSummarize] Background call failed:', err));
    }

    // Revalidate cache
    revalidatePath(`/${boardId}/${threadId}`);
    revalidatePath(`/${boardId}`);
    revalidateTag('boards'); // Update top page lists
    revalidateTag('board-view'); // Update board lists

    return post;
}

export async function createThread(boardId: string, title: string, content: string, userId: string) {
    // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æœ€åˆã®Postã¨ã—ã¦ä½œæˆã™ã‚‹ã‹ã€Thread.contentã«å…¥ã‚Œã‚‹ã‹ã€‚
    // ã‚¹ã‚­ãƒ¼ãƒã«ã¯ Thread.content ã¯ç„¡ã„ãŒã€æœ€åˆã®Postã‚’ä½œã‚‹ã®ãŒï¼’ã¡ã‚ƒã‚“ã­ã‚‹æµã€‚
    // ã—ã‹ã—Prismaã®transactionã‚’ä½¿ã†ã¹ãã€‚

    const result = await prisma.$transaction(async (tx) => {
        const thread = await tx.thread.create({
            data: {
                title: title,
                boardId: boardId,
                lastUpdated: new Date(),
                postCount: 1, // First post
                views: 0,
                momentum: 100, // Initial momentum
                tags: [], // Empty tags for new manual thread
            }
        });

        await tx.post.create({
            data: {
                content: content,
                author: 'åç„¡ã—ã•ã‚“', // Default
                userId: userId,
                threadId: thread.id,
            }
        });

        return thread;
    });


    // End of transaction


    // Revalidate cache
    revalidatePath(`/${boardId}/${result.id}`);
    revalidatePath(`/${boardId}`);
    revalidateTag('boards');
    revalidateTag('board-view');

    return result;
}

export async function getAllThreads(limit = 100) {
    const threads = await prisma.thread.findMany({
        orderBy: { lastUpdated: 'desc' },
        take: limit,
        include: {
            board: true,
            posts: {
                take: 1,
                orderBy: { createdAt: 'desc' }
            }
        }
    });

    return threads.map(t => ({
        ...convertThread(t),
        boardName: t.board.name,
        boardId: t.board.id
    }));
}


export async function getAllRecentThreads(limit = 100) {
    const threads = await prisma.thread.findMany({
        orderBy: { lastUpdated: 'desc' },
        take: limit,
        include: {
            board: true
            // posts not needed for list view, but convertThread expects it?
            // convertThread handles missing posts gracefully if posts is optional in type, 
            // but in my implementation it maps over posts. 
            // let's include posts for safety or update convertThread
        }
    });

    // Prisma include posts for convertThread compatibility
    // actually let's just fetch them or make convertThread safe
    // The current convertThread implementation:
    // posts: thread.posts ? thread.posts.map(...) : []
    // So it is safe.

    return threads.map(t => ({
        ...convertThread(t),
        boardName: t.board.name,
        boardId: t.board.id
    }));
}

export async function searchThreads(query: string, boardId?: string) {
    if (!query.trim()) return [];

    const where: Record<string, any> = {
        OR: [
            { title: { contains: query, mode: 'insensitive' } },
            { posts: { some: { content: { contains: query, mode: 'insensitive' } } } }
        ]
    };

    if (boardId) {
        where.boardId = boardId;
    }

    const threads = await prisma.thread.findMany({
        where,
        orderBy: { lastUpdated: 'desc' },
        take: 50,
        include: {
            board: true,
            posts: {
                take: 1,
                orderBy: { createdAt: 'desc' }
            }
        }
    });

    return threads.map(t => ({
        ...convertThread(t),
        boardName: t.board.name,
        boardId: t.board.id
    }));
}

// Administrative Actions
export async function updatePostStatus(postId: string, status: 'active' | 'deleted') {
    const post = await prisma.post.update({
        where: { id: postId },
        data: { status }
    });

    // Recalculate momentum or other stats if needed

    return post;
}

export async function updateThreadStatus(threadId: string, status: 'active' | 'deleted' | 'archived' | 'filled') {
    const thread = await prisma.thread.update({
        where: { id: threadId },
        data: { status }
    });

    return thread;
}

// Reports management
export async function getReports(limit = 100) {
    const reports = await prisma.report.findMany({
        where: {
            status: 'pending'
        },
        orderBy: {
            createdAt: 'desc'
        },
        take: limit,
        include: {
            post: {
                include: {
                    thread: {
                        include: {
                            board: true
                        }
                    }
                }
            }
        }
    });

    return reports.map(report => ({
        ...report,
        createdAt: report.createdAt.toISOString(),
        post: {
            ...report.post,
            createdAt: report.post.createdAt.toISOString(),
            threadTitle: report.post.thread.title,
            boardName: report.post.thread.board.name,
            threadId: report.post.thread.id,
            boardId: report.post.thread.board.id,
        }
    }));
}

export async function updateReportStatus(reportId: string, status: 'pending' | 'resolved' | 'dismissed') {
    const report = await prisma.report.update({
        where: { id: reportId },
        data: { status }
    });

    return report;
}

export async function updateBoardStatus(boardId: string, status: 'active' | 'locked') {
    const board = await prisma.board.update({
        where: { id: boardId },
        data: { status }
    });

    return board;
}
// Analytics
export async function getDailyStats() {
    // 1. Total Counts
    const totalThreads = await prisma.thread.count();
    const totalPosts = await prisma.post.count();
    const totalActiveThreads = await prisma.thread.count({ where: { status: 'active' } });

    // 2. Daily Post Count (Last 7 days)
    const sevenDaysAgo = new Date();
    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 6);
    sevenDaysAgo.setHours(0, 0, 0, 0);

    const postsLast7Days = await prisma.post.groupBy({
        by: ['createdAt'],
        where: {
            createdAt: {
                gte: sevenDaysAgo
            }
        },
        _count: {
            id: true
        }
    });

    // Group by date string (YYYY-MM-DD)
    const dailyPostCounts: Record<string, number> = {};
    for (let i = 0; i < 7; i++) {
        const d = new Date(sevenDaysAgo);
        d.setDate(d.getDate() + i);
        const dateStr = d.toISOString().split('T')[0];
        dailyPostCounts[dateStr] = 0;
    }

    postsLast7Days.forEach((p: { createdAt: Date, _count: { id: number } }) => {
        const dateStr = p.createdAt.toISOString().split('T')[0];
        if (dailyPostCounts[dateStr] !== undefined) {
            dailyPostCounts[dateStr] += p._count.id;
        }
    });

    const dailyChartData = Object.entries(dailyPostCounts).map(([date, count]) => ({ date, count }));

    // 3. AI Generated Content Ratio
    const aiThreadsCount = await prisma.thread.count({ where: { isAiGenerated: true } });
    const aiPostsCount = await prisma.post.count({ where: { isAiGenerated: true } });

    // 4. Momentum Ranking (Top 5 Active Threads)
    const topThreads = await prisma.thread.findMany({
        where: { status: 'active' },
        orderBy: { momentum: 'desc' },
        take: 5,
        select: {
            id: true,
            title: true,
            momentum: true,
            views: true,
            board: { select: { name: true } }
        }
    });

    return {
        totalThreads,
        totalPosts,
        totalActiveThreads,
        dailyChartData,
        aiRatio: {
            threads: aiThreadsCount,
            posts: aiPostsCount
        },
        topMoverThreads: topThreads
    };
}





================================================================
End of Codebase
================================================================
